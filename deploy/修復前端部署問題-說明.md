# ä¿®å¾©å‰ç«¯éƒ¨ç½²å•é¡Œ - èªªæ˜

> æ›´æ–°æ™‚é–“ï¼š2025-12-03

---

## ğŸ”´ ç™¼ç¾çš„å•é¡Œ

æ ¹æ“šæœå‹™å™¨æ—¥èªŒï¼Œç™¼ç¾å…©å€‹å•é¡Œï¼š

### 1. TypeScript æ§‹å»ºéŒ¯èª¤
```
Type error: 'worker.metadata.total_friends' is possibly 'undefined'
```

### 2. å‰ç«¯æœå‹™å•Ÿå‹•å‘½ä»¤ä¸æ­£ç¢º
```
"next start" does not work with "output: standalone" configuration. 
Use "node .next/standalone/server.js" instead.
```

---

## âœ… è§£æ±ºæ–¹æ¡ˆ

### æ–¹å¼ 1ï¼šä½¿ç”¨è‡ªå‹•ä¿®å¾©è…³æœ¬ï¼ˆæ¨è–¦ï¼‰

åœ¨æœå‹™å™¨ SSH çµ‚ç«¯åŸ·è¡Œï¼š

```bash
cd ~/liaotian
chmod +x deploy/ä¿®å¾©å‰ç«¯éƒ¨ç½²å•é¡Œ.sh
./deploy/ä¿®å¾©å‰ç«¯éƒ¨ç½²å•é¡Œ.sh
```

### æ–¹å¼ 2ï¼šæ‰‹å‹•ä¿®å¾©

#### æ­¥é©Ÿ 1: æ‹‰å–æœ€æ–°ä»£ç¢¼

```bash
cd ~/liaotian
git pull origin main
```

#### æ­¥é©Ÿ 2: ä¿®å¾© systemd æœå‹™é…ç½®

```bash
# ç·¨è¼¯æœå‹™æ–‡ä»¶
sudo nano /etc/systemd/system/liaotian-frontend.service
```

**ä¿®æ”¹ ExecStart è¡Œ**ï¼š
```ini
# èˆŠçš„ï¼ˆéŒ¯èª¤ï¼‰
ExecStart=/usr/bin/npm start

# æ–°çš„ï¼ˆæ­£ç¢ºï¼‰
ExecStart=/usr/bin/node /home/ubuntu/liaotian/saas-demo/.next/standalone/server.js
```

**å®Œæ•´æœå‹™æ–‡ä»¶ç¤ºä¾‹**ï¼š
```ini
[Unit]
Description=Liaotian AI Frontend
After=network.target

[Service]
Type=simple
User=ubuntu
Group=ubuntu
WorkingDirectory=/home/ubuntu/liaotian/saas-demo
Environment="NODE_ENV=production"
Environment="PATH=/usr/local/bin:/usr/bin:/bin"
ExecStart=/usr/bin/node /home/ubuntu/liaotian/saas-demo/.next/standalone/server.js
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal
SyslogIdentifier=liaotian-frontend

[Install]
WantedBy=multi-user.target
```

**ä¿å­˜å¾Œé‡æ–°åŠ è¼‰**ï¼š
```bash
sudo systemctl daemon-reload
```

#### æ­¥é©Ÿ 3: é‡æ–°æ§‹å»ºå‰ç«¯

```bash
cd ~/liaotian/saas-demo
npm run build
```

#### æ­¥é©Ÿ 4: é‡å•Ÿæœå‹™

```bash
sudo systemctl restart liaotian-frontend
```

#### æ­¥é©Ÿ 5: æª¢æŸ¥ç‹€æ…‹

```bash
sudo systemctl status liaotian-frontend
sudo journalctl -u liaotian-frontend -n 20 --no-pager
```

---

## ğŸ” é©—è­‰ä¿®å¾©

### æª¢æŸ¥æœå‹™ç‹€æ…‹

```bash
sudo systemctl status liaotian-frontend
```

æ‡‰è©²çœ‹åˆ°ï¼š
- `Active: active (running)`
- æ²’æœ‰éŒ¯èª¤ä¿¡æ¯

### æª¢æŸ¥æ—¥èªŒ

```bash
sudo journalctl -u liaotian-frontend -n 30 --no-pager
```

æ‡‰è©²çœ‹åˆ°ï¼š
- `Ready in XXXms`
- æ²’æœ‰ "next start does not work" è­¦å‘Š
- æ²’æœ‰ TypeScript éŒ¯èª¤

### æ¸¬è©¦è¨ªå•

è¨ªå•ï¼š`https://aikz.usdt2026.cc`

æ‡‰è©²èƒ½æ­£å¸¸æ‰“é–‹ç¶²é ã€‚

---

## ğŸ“ æ³¨æ„äº‹é …

1. **standalone æ¨¡å¼è¦æ±‚**ï¼š
   - å¿…é ˆå…ˆåŸ·è¡Œ `npm run build` ç”Ÿæˆ `.next/standalone` ç›®éŒ„
   - å•Ÿå‹•å‘½ä»¤å¿…é ˆæ˜¯ `node .next/standalone/server.js`
   - ä¸èƒ½ä½¿ç”¨ `npm start` æˆ– `next start`

2. **å·¥ä½œç›®éŒ„**ï¼š
   - ç¢ºä¿ `WorkingDirectory` æŒ‡å‘æ­£ç¢ºçš„å‰ç«¯ç›®éŒ„
   - é€šå¸¸æ˜¯ `/home/ubuntu/liaotian/saas-demo`

3. **æ¬Šé™å•é¡Œ**ï¼š
   - ç¢ºä¿æœå‹™ç”¨æˆ¶ï¼ˆé€šå¸¸æ˜¯ `ubuntu`ï¼‰æœ‰æ¬Šé™è¨ªå• `.next/standalone` ç›®éŒ„
   - å¦‚æœä½¿ç”¨ `www-data`ï¼Œéœ€è¦èª¿æ•´æ¬Šé™

---

## ğŸ› æ•…éšœæ’é™¤

### å•é¡Œ 1: æ‰¾ä¸åˆ° `.next/standalone/server.js`

**åŸå› **ï¼šæ§‹å»ºæœªå®Œæˆæˆ–æ§‹å»ºå¤±æ•—

**è§£æ±º**ï¼š
```bash
cd ~/liaotian/saas-demo
rm -rf .next
npm run build
```

### å•é¡Œ 2: æ¬Šé™è¢«æ‹’çµ•

**åŸå› **ï¼šæœå‹™ç”¨æˆ¶æ²’æœ‰æ¬Šé™è¨ªå•æ–‡ä»¶

**è§£æ±º**ï¼š
```bash
sudo chown -R ubuntu:ubuntu ~/liaotian/saas-demo/.next
```

### å•é¡Œ 3: ç«¯å£å·²è¢«å ç”¨

**åŸå› **ï¼šèˆŠé€²ç¨‹ä»åœ¨é‹è¡Œ

**è§£æ±º**ï¼š
```bash
# æŸ¥æ‰¾å ç”¨ 3000 ç«¯å£çš„é€²ç¨‹
sudo lsof -i :3000

# æ®ºæ­»é€²ç¨‹
sudo kill -9 <PID>

# é‡å•Ÿæœå‹™
sudo systemctl restart liaotian-frontend
```

---

*ä¿®å¾©èªªæ˜ç”Ÿæˆæ™‚é–“ï¼š2025-12-03*
