# 最终修复命令 - 直接复制执行

## 请在服务器上执行以下命令

由于SSH输出被抑制，请在服务器上**直接复制并执行**以下命令：

```bash
cd /home/ubuntu/liaotian/saas-demo

# 1. 检查当前配置
echo "=== 当前配置 ==="
cat /etc/systemd/system/liaotian-frontend.service | grep -E "WorkingDirectory|ExecStart"

# 2. 重新加载systemd配置
echo ""
echo "=== 重新加载配置 ==="
sudo systemctl daemon-reload

# 3. 启动服务
echo ""
echo "=== 启动服务 ==="
sudo systemctl start liaotian-frontend
sleep 5

# 4. 检查服务状态
echo ""
echo "=== 服务状态 ==="
sudo systemctl status liaotian-frontend --no-pager | head -20

# 5. 检查端口监听
echo ""
echo "=== 端口监听 ==="
ss -tlnp | grep ':3000' || echo "端口3000未监听"

# 6. 查看最新日志（如果有错误）
echo ""
echo "=== 最新日志 ==="
sudo journalctl -u liaotian-frontend -n 20 --no-pager

# 7. 测试静态文件访问
echo ""
echo "=== 测试静态文件 ==="
curl -I http://localhost:3000/_next/static/chunks/adc3be135379192a.js 2>&1 | head -5
```

## 预期结果

### 成功的情况：
1. ✅ `WorkingDirectory=/home/ubuntu/liaotian/saas-demo/.next/standalone/liaotian/saas-demo`
2. ✅ `ExecStart=/home/ubuntu/.nvm/versions/node/v20.19.6/bin/node server.js`
3. ✅ 服务状态：`Active: active (running)`
4. ✅ 端口3000被监听
5. ✅ 静态文件返回 `HTTP/1.1 200 OK`

### 如果服务仍然无法启动：

查看日志中的错误信息：
```bash
sudo journalctl -u liaotian-frontend -n 50 --no-pager | grep -i error
```

常见错误：
- `Cannot find module` - 模块缺失
- `EACCES` - 权限问题
- `ENOENT` - 文件不存在
- `EADDRINUSE` - 端口被占用

## 如果配置不正确

如果 `WorkingDirectory` 或 `ExecStart` 不正确，手动修复：

```bash
# 查找standalone目录
STANDALONE_DIR=$(find /home/ubuntu/liaotian/saas-demo/.next/standalone -name 'server.js' -type f | head -1 | xargs dirname)
FULL_STANDALONE_DIR="/home/ubuntu/liaotian/saas-demo/$STANDALONE_DIR"
echo "Standalone目录: $FULL_STANDALONE_DIR"

# 更新配置
sudo sed -i "s|WorkingDirectory=.*|WorkingDirectory=$FULL_STANDALONE_DIR|" /etc/systemd/system/liaotian-frontend.service
sudo sed -i "s|ExecStart=.*node.*|ExecStart=/home/ubuntu/.nvm/versions/node/v20.19.6/bin/node server.js|" /etc/systemd/system/liaotian-frontend.service

# 重新加载并启动
sudo systemctl daemon-reload
sudo systemctl start liaotian-frontend
sleep 5
sudo systemctl status liaotian-frontend --no-pager | head -20
```

## 验证修复成功

修复成功后：
1. ✅ 服务状态为 `active (running)`
2. ✅ 端口3000被监听
3. ✅ 页面不再显示502错误
4. ✅ 浏览器可以正常访问

