# SSH å¯†é’¥é…ç½® - è¯¦ç»†æ­¥éª¤

## ğŸ¯ ç›®æ ‡

é…ç½® SSH å¯†é’¥è®¤è¯ï¼Œè§£å†³æ¯æ¬¡ SSH è¿æ¥éƒ½éœ€è¦è¾“å…¥å¯†ç çš„é—®é¢˜ã€‚

## ğŸ“‹ å®Œæ•´æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ£€æŸ¥æ˜¯å¦å·²æœ‰ SSH å¯†é’¥

åœ¨ PowerShell ä¸­æ‰§è¡Œï¼š
```powershell
Get-Content $env:USERPROFILE\.ssh\id_rsa.pub
```

**ç»“æœï¼š**
- **å¦‚æœæœ‰è¾“å‡º**ï¼ˆä»¥ `ssh-rsa` å¼€å¤´ï¼‰ï¼šè¯´æ˜å·²æœ‰å¯†é’¥ï¼Œè·³åˆ°æ­¥éª¤ 3
- **å¦‚æœæŠ¥é”™æˆ–æ²¡æœ‰è¾“å‡º**ï¼šéœ€è¦ç”Ÿæˆæ–°å¯†é’¥ï¼Œç»§ç»­æ­¥éª¤ 2

---

### æ­¥éª¤ 2ï¼šç”Ÿæˆ SSH å¯†é’¥å¯¹ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰

åœ¨ PowerShell ä¸­æ‰§è¡Œï¼š
```powershell
ssh-keygen -t rsa -b 4096 -f "$env:USERPROFILE\.ssh\id_rsa" -N '""'
```

**æ³¨æ„ï¼š**
- å¦‚æœæç¤º "Overwrite (y/n)"ï¼Œè¾“å…¥ `y` è¦†ç›–
- å¦‚æœæç¤º "Enter passphrase"ï¼Œç›´æ¥æŒ‰ Enterï¼ˆä¸è®¾ç½®å¯†ç ï¼‰

**éªŒè¯ç”ŸæˆæˆåŠŸï¼š**
```powershell
Get-Content $env:USERPROFILE\.ssh\id_rsa.pub
```
åº”è¯¥çœ‹åˆ°ä»¥ `ssh-rsa` å¼€å¤´çš„å…¬é’¥å†…å®¹ã€‚

---

### æ­¥éª¤ 3ï¼šæŸ¥çœ‹å…¬é’¥å†…å®¹

åœ¨ PowerShell ä¸­æ‰§è¡Œï¼š
```powershell
Get-Content $env:USERPROFILE\.ssh\id_rsa.pub
```

**å¤åˆ¶è¾“å‡ºçš„å…¬é’¥å†…å®¹**ï¼ˆæ•´è¡Œï¼Œä»¥ `ssh-rsa` å¼€å¤´ï¼Œä»¥ä½ çš„é‚®ç®±æˆ–ç”¨æˆ·åç»“å°¾ï¼‰

---

### æ­¥éª¤ 4ï¼šå°†å…¬é’¥å¤åˆ¶åˆ°æœåŠ¡å™¨

**æ–¹æ³• Aï¼šä½¿ç”¨å‘½ä»¤è‡ªåŠ¨å¤åˆ¶ï¼ˆæ¨èï¼‰**

åœ¨ PowerShell ä¸­æ‰§è¡Œï¼š
```powershell
type $env:USERPROFILE\.ssh\id_rsa.pub | ssh ubuntu@165.154.233.55 "mkdir -p ~/.ssh && chmod 700 ~/.ssh && cat >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys"
```

**éœ€è¦è¾“å…¥ä¸€æ¬¡æœåŠ¡å™¨å¯†ç **

**æ–¹æ³• Bï¼šæ‰‹åŠ¨å¤åˆ¶ï¼ˆå¦‚æœæ–¹æ³• A å¤±è´¥ï¼‰**

1. **ç™»å½•æœåŠ¡å™¨**ï¼š
   ```powershell
   ssh ubuntu@165.154.233.55
   ```
   ï¼ˆéœ€è¦è¾“å…¥å¯†ç ï¼‰

2. **åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ**ï¼š
   ```bash
   mkdir -p ~/.ssh
   chmod 700 ~/.ssh
   nano ~/.ssh/authorized_keys
   ```

3. **åœ¨ nano ç¼–è¾‘å™¨ä¸­**ï¼š
   - ç²˜è´´ä¹‹å‰å¤åˆ¶çš„å…¬é’¥å†…å®¹ï¼ˆæ•´è¡Œï¼‰
   - å¦‚æœæ–‡ä»¶ä¸­å·²æœ‰å†…å®¹ï¼Œåœ¨æœ€åä¸€è¡ŒåæŒ‰ Enterï¼Œç„¶åç²˜è´´
   - ä¿å­˜ï¼š`Ctrl+O`ï¼Œç„¶å `Enter`
   - é€€å‡ºï¼š`Ctrl+X`

4. **è®¾ç½®æƒé™**ï¼š
   ```bash
   chmod 600 ~/.ssh/authorized_keys
   exit
   ```

---

### æ­¥éª¤ 5ï¼šæµ‹è¯•æ— å¯†ç ç™»å½•

åœ¨ PowerShell ä¸­æ‰§è¡Œï¼š
```powershell
ssh ubuntu@165.154.233.55 "echo 'SSH å¯†é’¥è®¤è¯æµ‹è¯•æˆåŠŸï¼'"
```

**å¦‚æœæˆåŠŸï¼š**
- âœ… **ä¸éœ€è¦è¾“å…¥å¯†ç **
- âœ… ç›´æ¥è¿”å› "SSH å¯†é’¥è®¤è¯æµ‹è¯•æˆåŠŸï¼"

**å¦‚æœå¤±è´¥ï¼š**
- âŒ ä»ç„¶æç¤ºè¾“å…¥å¯†ç 
- éœ€è¦æ£€æŸ¥æœåŠ¡å™¨æƒé™ï¼ˆè§æ•…éšœæ’é™¤ï¼‰

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šä»ç„¶éœ€è¦å¯†ç 

**æ£€æŸ¥æœåŠ¡å™¨æƒé™ï¼š**

1. ç™»å½•æœåŠ¡å™¨ï¼š`ssh ubuntu@165.154.233.55`
2. æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
   ```bash
   ls -la ~/.ssh/
   chmod 700 ~/.ssh
   chmod 600 ~/.ssh/authorized_keys
   ls -la ~/.ssh/
   ```

**åº”è¯¥çœ‹åˆ°ï¼š**
```
drwx------ 2 ubuntu ubuntu 4096 ... .ssh
-rw------- 1 ubuntu ubuntu  400 ... authorized_keys
```

**å…³é”®ï¼š**
- `.ssh` ç›®å½•æƒé™å¿…é¡»æ˜¯ `700`ï¼ˆdrwx------ï¼‰
- `authorized_keys` æ–‡ä»¶æƒé™å¿…é¡»æ˜¯ `600`ï¼ˆ-rw-------ï¼‰

### é—®é¢˜ 2ï¼šå…¬é’¥æœªæ­£ç¡®å¤åˆ¶

**æ£€æŸ¥å…¬é’¥æ˜¯å¦åœ¨æœåŠ¡å™¨ä¸Šï¼š**

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cat ~/.ssh/authorized_keys
```

åº”è¯¥çœ‹åˆ°ä½ çš„å…¬é’¥å†…å®¹ï¼ˆä»¥ `ssh-rsa` å¼€å¤´ï¼‰

### é—®é¢˜ 3ï¼šSSH æœåŠ¡é…ç½®é—®é¢˜

**æ£€æŸ¥æœåŠ¡å™¨ SSH é…ç½®ï¼š**

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
sudo grep -E "PubkeyAuthentication|AuthorizedKeysFile" /etc/ssh/sshd_config
```

**åº”è¯¥çœ‹åˆ°ï¼š**
```
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys
```

å¦‚æœä¸åŒï¼Œéœ€è¦ä¿®æ”¹ï¼š
```bash
sudo nano /etc/ssh/sshd_config
# ç¡®ä¿ä¸Šè¿°é…ç½®æ­£ç¡®
sudo systemctl restart sshd
```

---

## âœ… éªŒè¯é…ç½®æˆåŠŸ

é…ç½®æˆåŠŸåï¼Œä»¥ä¸‹å‘½ä»¤åº”è¯¥**ä¸éœ€è¦å¯†ç **ï¼š

```powershell
ssh ubuntu@165.154.233.55 "whoami"
ssh ubuntu@165.154.233.55 "pwd"
ssh ubuntu@165.154.233.55 "echo 'æµ‹è¯•æˆåŠŸ'"
```

---

## ğŸ¯ é…ç½®æˆåŠŸå

é…ç½®æˆåŠŸåï¼Œå¯ä»¥ï¼š
1. âœ… è¿è¡Œè‡ªåŠ¨åŒ–ä¿®å¤è„šæœ¬ï¼ˆæ— éœ€è¾“å…¥å¯†ç ï¼‰
2. âœ… æ‰§è¡Œè¿œç¨‹æ£€æŸ¥å‘½ä»¤
3. âœ… è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œä¿®å¤

---

## ğŸ“ å¿«é€Ÿå‚è€ƒ

**ä¸€é”®æ‰§è¡Œæ‰€æœ‰æ­¥éª¤ï¼š**

```powershell
# 1. ç”Ÿæˆå¯†é’¥ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
if (!(Test-Path "$env:USERPROFILE\.ssh\id_rsa.pub")) {
    ssh-keygen -t rsa -b 4096 -f "$env:USERPROFILE\.ssh\id_rsa" -N '""'
}

# 2. å¤åˆ¶å…¬é’¥åˆ°æœåŠ¡å™¨ï¼ˆéœ€è¦è¾“å…¥ä¸€æ¬¡å¯†ç ï¼‰
type $env:USERPROFILE\.ssh\id_rsa.pub | ssh ubuntu@165.154.233.55 "mkdir -p ~/.ssh && chmod 700 ~/.ssh && cat >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys"

# 3. æµ‹è¯•
ssh ubuntu@165.154.233.55 "echo 'SSH å¯†é’¥è®¤è¯æˆåŠŸï¼'"
```

