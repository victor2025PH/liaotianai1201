# éƒ¨ç½²é—®é¢˜è¯Šæ–­å’Œè§£å†³æ–¹æ¡ˆ

ç”Ÿæˆæ—¶é—´: 2025-01-23

## ğŸ” é—®é¢˜è¯Šæ–­

### å½“å‰çŠ¶æ€

1. **æ–‡ä»¶ä½ç½®** âœ…
   - å·²ç¡®è®¤æ–‡ä»¶åœ¨æ­£ç¡®ä½ç½®
   - æ´›æ‰çŸ¶/é©¬å°¼æ‹‰ï¼š`/home/ubuntu/`
   - worker-01ï¼š`/opt/group-ai/`

2. **æœåŠ¡å¯åŠ¨** âŒ
   - æœåŠ¡è¿›ç¨‹æœªè¿è¡Œ
   - ç«¯å£æœªç›‘å¬
   - æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨

### å¯èƒ½çš„åŸå› 

1. **ä¾èµ–å®‰è£…å¤±è´¥**
   - uvicorn å’Œ fastapi å¯èƒ½æœªæ­£ç¡®å®‰è£…
   - Python ç¯å¢ƒé—®é¢˜

2. **å¯åŠ¨å‘½ä»¤å¤±è´¥**
   - å¯åŠ¨æ—¶å‡ºç°é”™è¯¯
   - é…ç½®æ–‡ä»¶é—®é¢˜

3. **æƒé™é—®é¢˜**
   - æ–‡ä»¶æƒé™ä¸æ­£ç¡®
   - ç«¯å£ç»‘å®šæƒé™é—®é¢˜

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: æ‰‹åŠ¨ SSH æ‰§è¡Œï¼ˆæ¨èï¼‰

ç›´æ¥ SSH åˆ°æœåŠ¡å™¨æ‰‹åŠ¨æ‰§è¡Œï¼š

```bash
# SSH è¿æ¥åˆ°æœåŠ¡å™¨
ssh ubuntu@165.154.255.48

# è¿›å…¥ç›®å½•
cd /home/ubuntu

# åœæ­¢æ—§æœåŠ¡
pkill -f uvicorn

# å®‰è£…ä¾èµ–
python3 -m pip install uvicorn fastapi --user --upgrade

# éªŒè¯å®‰è£…
python3 -c "import uvicorn; print(uvicorn.__version__)"

# è¿›å…¥ admin-backend
cd admin-backend

# æ£€æŸ¥ .env æ–‡ä»¶
cat .env

# å¦‚æœæ²¡æœ‰ .envï¼Œåˆ›å»ºå®ƒ
cat > .env << EOF
DATABASE_URL=sqlite:///./admin.db
JWT_SECRET=$(python3 -c "import secrets; print(secrets.token_hex(32))")
ADMIN_DEFAULT_EMAIL=admin@example.com
ADMIN_DEFAULT_PASSWORD=changeme123
CORS_ORIGINS=http://localhost:3000,http://localhost:5173
EOF

# å¯åŠ¨æœåŠ¡ï¼ˆå‰å°è¿è¡ŒæŸ¥çœ‹é”™è¯¯ï¼‰
python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000

# å¦‚æœå¯åŠ¨æˆåŠŸï¼ŒæŒ‰ Ctrl+C åœæ­¢ï¼Œç„¶ååå°å¯åŠ¨
nohup python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 > ../logs/backend.log 2>&1 &

# æ£€æŸ¥è¿›ç¨‹å’Œç«¯å£
ps aux | grep uvicorn
ss -tlnp | grep :8000

# æŸ¥çœ‹æ—¥å¿—
tail -f ../logs/backend.log
```

### æ–¹æ¡ˆ 2: ä½¿ç”¨ systemd æœåŠ¡

åˆ›å»º systemd æœåŠ¡æ–‡ä»¶ï¼š

```bash
sudo nano /etc/systemd/system/telegram-ai-backend.service
```

å†…å®¹ï¼š
```ini
[Unit]
Description=Telegram AI Backend Service
After=network.target

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/home/ubuntu/admin-backend
Environment="PATH=/home/ubuntu/.local/bin:/usr/local/bin:/usr/bin:/bin"
ExecStart=/usr/bin/python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl daemon-reload
sudo systemctl enable telegram-ai-backend
sudo systemctl start telegram-ai-backend
sudo systemctl status telegram-ai-backend
```

### æ–¹æ¡ˆ 3: ä½¿ç”¨ screen æˆ– tmux

```bash
# å®‰è£… screen
sudo apt-get install screen -y

# åˆ›å»º screen ä¼šè¯
screen -S telegram-ai

# å¯åŠ¨æœåŠ¡
cd /home/ubuntu/admin-backend
python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000

# æŒ‰ Ctrl+A ç„¶å D åˆ†ç¦»ä¼šè¯
# é‡æ–°è¿æ¥ï¼šscreen -r telegram-ai
```

## ğŸ“ æ£€æŸ¥æ¸…å•

- [ ] Python 3 å·²å®‰è£…
- [ ] pip å·²å®‰è£…
- [ ] uvicorn å’Œ fastapi å·²å®‰è£…
- [ ] .env æ–‡ä»¶å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
- [ ] app/main.py æ–‡ä»¶å­˜åœ¨
- [ ] ç«¯å£ 8000 æœªè¢«å ç”¨
- [ ] é˜²ç«å¢™å…è®¸ç«¯å£ 8000
- [ ] æœåŠ¡è¿›ç¨‹è¿è¡Œä¸­
- [ ] ç«¯å£ç›‘å¬ä¸­
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡

## ğŸ¯ ä¸‹ä¸€æ­¥

1. ä½¿ç”¨æ–¹æ¡ˆ 1 æ‰‹åŠ¨ SSH æ‰§è¡Œï¼ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. æ ¹æ®é”™è¯¯ä¿¡æ¯ä¿®å¤é—®é¢˜
3. éªŒè¯æœåŠ¡æ­£å¸¸è¿è¡Œ
4. å¦‚æœæˆåŠŸï¼Œå¯ä»¥åˆ›å»º systemd æœåŠ¡å®ç°è‡ªåŠ¨å¯åŠ¨

