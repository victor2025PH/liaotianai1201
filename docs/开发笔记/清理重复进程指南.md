# 清理重複進程指南

> **日期**: 2025-12-01  
> **用途**: 清理重複的 uvicorn 進程（可選）

---

## 🔍 檢查重複進程

當前有兩個 uvicorn 進程在運行：
- PID 886205（05:05 啟動）
- PID 887537（05:10 啟動）

---

## 🧹 清理方法

### 方法 1: 保留最新進程（推薦）

```bash
# 查看所有進程的啟動時間
ps -eo pid,lstart,cmd | grep uvicorn | grep -v grep

# 保留最新的進程，停止舊的（根據實際情況調整）
# 如果 887537 是重複的，停止它：
kill 887537

# 或者更安全的方式，等待服務穩定後再清理
```

### 方法 2: 完全重啟（推薦）

```bash
# 停止所有 uvicorn 進程
pkill -9 -f 'uvicorn.*app.main:app'

# 等待 2 秒
sleep 2

# 啟動單個服務
cd ~/liaotian/admin-backend
source .venv/bin/activate
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 > /tmp/backend.log 2>&1 &

# 等待啟動
sleep 5

# 驗證
curl -s http://localhost:8000/health
```

---

## ⚠️ 注意事項

1. **不需要立即清理** - 兩個進程都能正常運行，只是占用更多資源
2. **生產環境建議清理** - 避免資源浪費和潛在衝突
3. **確認服務正常** - 清理前確保至少一個進程正常運行

---

## 🔍 檢查服務狀態

清理後驗證：

```bash
# 檢查進程數（應該只有一個）
ps aux | grep uvicorn | grep -v grep | wc -l

# 測試健康端點
curl -s http://localhost:8000/health

# 檢查端口（應該只有一個進程占用）
lsof -ti:8000 | wc -l
```

---

**注意**: 這是一個可選的優化步驟，不影響服務運行。
