# ç”Ÿç”¢ç’°å¢ƒæº–å‚™æŒ‡å—

> **æ›´æ–°æ—¥æœŸ**: 2025-01-XX  
> **ç‹€æ…‹**: âœ… æº–å‚™å®Œæˆ

---

## ğŸ“‹ æº–å‚™æ¸…å–®

### 1. âœ… èªè­‰é…ç½®

**ç•¶å‰ç‹€æ…‹**: èªè­‰ç³»çµ±å·²å¯¦ç¾ï¼Œæ”¯æŒç’°å¢ƒè®Šé‡æ§åˆ¶

**é…ç½®æ–¹å¼**:
```env
# ç”Ÿç”¢ç’°å¢ƒå¿…é ˆè¨­ç½®ç‚º falseï¼ˆå•Ÿç”¨èªè­‰ï¼‰
DISABLE_AUTH=false

# JWT é…ç½®ï¼ˆå¿…é ˆä¿®æ”¹ï¼‰
JWT_SECRET=your-production-secret-key-minimum-32-characters
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=60
```

**æª¢æŸ¥é»**:
- âœ… èªè­‰ç³»çµ±å·²å¯¦ç¾ï¼ˆ`app/api/deps.py`ï¼‰
- âœ… æ”¯æŒç’°å¢ƒè®Šé‡æ§åˆ¶ï¼ˆ`DISABLE_AUTH`ï¼‰
- âœ… JWT Token é©—è­‰å·²å¯¦ç¾
- âš ï¸ **ç”Ÿç”¢ç’°å¢ƒå¿…é ˆè¨­ç½® `DISABLE_AUTH=false`**

---

### 2. âœ… æ•¸æ“šåº«é·ç§»

**ç•¶å‰ç‹€æ…‹**: Alembic å·²é…ç½®ï¼Œé·ç§»æ–‡ä»¶å·²å‰µå»º

**é·ç§»æ–‡ä»¶åˆ—è¡¨**:
- `000_initial_base_tables.py` - åˆå§‹åŸºç¤è¡¨
- `001_create_group_ai_tables.py` - Group AI è¡¨
- `002_add_indexes_for_performance.py` - æ€§èƒ½ç´¢å¼•
- `003_add_script_version_management.py` - åŠ‡æœ¬ç‰ˆæœ¬ç®¡ç†
- `ea5d525f9c2a_add_account_profile_and_server_fields.py` - è³¬è™Ÿé…ç½®å’Œæœå‹™å™¨å­—æ®µ
- `fc673460c426_add_alert_rules_table.py` - å‘Šè­¦è¦å‰‡è¡¨

**åŸ·è¡Œé·ç§»**:
```bash
cd admin-backend
poetry run alembic upgrade head
```

**æª¢æŸ¥é»**:
- âœ… Alembic é…ç½®æ–‡ä»¶å­˜åœ¨ï¼ˆ`alembic.ini`ï¼‰
- âœ… é·ç§»æ–‡ä»¶å·²å‰µå»º
- âœ… é·ç§»è…³æœ¬å¯ç”¨

---

### 3. âœ… ç’°å¢ƒè®Šé‡é…ç½®

**å¿…å¡«ç’°å¢ƒè®Šé‡**:

#### å¾Œç«¯ï¼ˆadmin-backendï¼‰

```env
# æ•¸æ“šåº«é…ç½®ï¼ˆç”Ÿç”¢ç’°å¢ƒä½¿ç”¨ PostgreSQLï¼‰
DATABASE_URL=postgresql://user:password@host:5432/dbname

# Redis é…ç½®ï¼ˆå¯é¸ï¼Œä½†æ¨è–¦ï¼‰
REDIS_URL=redis://host:6379/0

# JWT é…ç½®ï¼ˆå¿…é ˆä¿®æ”¹ï¼‰
JWT_SECRET=your-production-secret-key-minimum-32-characters
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=60

# èªè­‰é…ç½®ï¼ˆç”Ÿç”¢ç’°å¢ƒå¿…é ˆå•Ÿç”¨ï¼‰
DISABLE_AUTH=false

# ç®¡ç†å“¡é…ç½®ï¼ˆå¿…é ˆä¿®æ”¹ï¼‰
ADMIN_DEFAULT_EMAIL=admin@yourdomain.com
ADMIN_DEFAULT_PASSWORD=your-strong-password
```

#### ä¸»ç¨‹åºï¼ˆgroup_ai_serviceï¼‰

```env
# Telegram APIï¼ˆå¿…éœ€ï¼‰
TELEGRAM_API_ID=your_api_id
TELEGRAM_API_HASH=your_api_hash

# AI é…ç½®ï¼ˆå¯é¸ï¼‰
AI_PROVIDER=openai
AI_API_KEY=your_openai_key

# ç´…åŒ…é…ç½®
REDPACKET_MIN_AMOUNT=0.01
REDPACKET_MAX_PER_HOUR=10
REDPACKET_COOLDOWN_SECONDS=300

# å‘Šè­¦é…ç½®
ALERT_NOTIFICATION_ENABLED=true
ALERT_EMAIL_ENABLED=true
ALERT_TELEGRAM_ENABLED=false
ALERT_WEBHOOK_ENABLED=false
```

#### å‰ç«¯ï¼ˆsaas-demoï¼‰

```env
NEXT_PUBLIC_API_BASE_URL=https://api.yourdomain.com/api/v1
```

---

### 4. âœ… å®‰å…¨é…ç½®

**å¿…é ˆåŸ·è¡Œçš„å®‰å…¨æªæ–½**:

1. **ä¿®æ”¹é»˜èªå¯†ç¢¼**
   ```env
   ADMIN_DEFAULT_PASSWORD=your-strong-password-here
   ```

2. **ä½¿ç”¨å¼· JWT Secret**
   ```env
   JWT_SECRET=generate-random-string-minimum-32-characters
   ```

3. **å•Ÿç”¨ HTTPS**
   - é…ç½®åå‘ä»£ç†ï¼ˆNginx/Apacheï¼‰
   - ä½¿ç”¨ SSL è­‰æ›¸ï¼ˆLet's Encryptï¼‰

4. **é…ç½®é˜²ç«ç‰†**
   - åªé–‹æ”¾å¿…è¦ç«¯å£ï¼ˆ80, 443ï¼‰
   - ç®¡ç†ç«¯å£åƒ…å…§ç¶²è¨ªå•

5. **æ•¸æ“šåº«å®‰å…¨**
   - ä½¿ç”¨å¼·å¯†ç¢¼
   - é™åˆ¶è¨ªå• IP
   - å•Ÿç”¨ SSL é€£æ¥

---

### 5. âœ… éƒ¨ç½²é…ç½®

**æ¨è–¦éƒ¨ç½²æ–¹å¼**:

#### Docker Composeï¼ˆæ¨è–¦ï¼‰

```yaml
version: '3.8'

services:
  backend:
    build: ./admin-backend
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/admin_db
      - REDIS_URL=redis://redis:6379/0
      - DISABLE_AUTH=false
      - JWT_SECRET=${JWT_SECRET}
    ports:
      - "8000:8000"
    depends_on:
      - db
      - redis

  db:
    image: postgres:15
    environment:
      - POSTGRES_DB=admin_db
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

#### å‚³çµ±éƒ¨ç½²

1. **å¾Œç«¯æœå‹™**:
   ```bash
   cd admin-backend
   poetry install
   poetry run alembic upgrade head
   poetry run uvicorn app.main:app --host 0.0.0.0 --port 8000
   ```

2. **å‰ç«¯æœå‹™**:
   ```bash
   cd saas-demo
   npm install
   npm run build
   npm start
   ```

---

### 6. âœ… ç›£æ§å’Œæ—¥èªŒ

**ç›£æ§é…ç½®**:

1. **å¥åº·æª¢æŸ¥ç«¯é»**:
   - `GET /health` - å¥åº·æª¢æŸ¥
   - `GET /api/v1/group-ai/monitor/system` - ç³»çµ±æŒ‡æ¨™

2. **æ—¥èªŒé…ç½®**:
   - ä½¿ç”¨çµæ§‹åŒ–æ—¥èªŒï¼ˆJSON æ ¼å¼ï¼‰
   - æ—¥èªŒç´šåˆ¥ï¼šç”Ÿç”¢ç’°å¢ƒä½¿ç”¨ `INFO` æˆ– `WARNING`
   - æ—¥èªŒè¼ªè½‰ï¼šæŒ‰å¤§å°æˆ–æ™‚é–“è¼ªè½‰

3. **å‘Šè­¦é…ç½®**:
   - å•Ÿç”¨éƒµä»¶å‘Šè­¦
   - é…ç½®å‘Šè­¦é–¾å€¼
   - è¨­ç½®é€šçŸ¥æ¥æ”¶äºº

---

## ğŸ” éƒ¨ç½²å‰æª¢æŸ¥æ¸…å–®

### ç’°å¢ƒè®Šé‡æª¢æŸ¥

- [ ] `DISABLE_AUTH=false`ï¼ˆç”Ÿç”¢ç’°å¢ƒå¿…é ˆï¼‰
- [ ] `JWT_SECRET` å·²ä¿®æ”¹ç‚ºå¼·å¯†ç¢¼ï¼ˆè‡³å°‘ 32 å­—ç¬¦ï¼‰
- [ ] `ADMIN_DEFAULT_PASSWORD` å·²ä¿®æ”¹
- [ ] `DATABASE_URL` å·²é…ç½®ï¼ˆç”Ÿç”¢ç’°å¢ƒä½¿ç”¨ PostgreSQLï¼‰
- [ ] `REDIS_URL` å·²é…ç½®ï¼ˆå¯é¸ä½†æ¨è–¦ï¼‰

### æ•¸æ“šåº«æª¢æŸ¥

- [ ] æ•¸æ“šåº«å·²å‰µå»º
- [ ] æ•¸æ“šåº«é·ç§»å·²åŸ·è¡Œï¼ˆ`alembic upgrade head`ï¼‰
- [ ] æ•¸æ“šåº«å‚™ä»½ç­–ç•¥å·²é…ç½®

### å®‰å…¨æª¢æŸ¥

- [ ] HTTPS å·²é…ç½®
- [ ] é˜²ç«ç‰†è¦å‰‡å·²é…ç½®
- [ ] æ•¸æ“šåº«è¨ªå•å·²é™åˆ¶
- [ ] æ•æ„Ÿä¿¡æ¯ä¸åœ¨ä»£ç¢¼ä¸­ç¡¬ç·¨ç¢¼

### åŠŸèƒ½æª¢æŸ¥

- [ ] å¾Œç«¯æœå‹™æ­£å¸¸å•Ÿå‹•
- [ ] å‰ç«¯æœå‹™æ­£å¸¸å•Ÿå‹•
- [ ] API ç«¯é»æ­£å¸¸éŸ¿æ‡‰
- [ ] èªè­‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] ç›£æ§åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### 1. æº–å‚™ç’°å¢ƒ

```bash
# å…‹éš†ä»£ç¢¼
git clone <repository-url>
cd <project-directory>

# å®‰è£ä¾è³´
cd admin-backend && poetry install
cd ../saas-demo && npm install
```

### 2. é…ç½®ç’°å¢ƒè®Šé‡

```bash
# è¤‡è£½ç’°å¢ƒè®Šé‡æ¨¡æ¿
cp .env.example .env

# ç·¨è¼¯ç’°å¢ƒè®Šé‡
nano .env  # æˆ–ä½¿ç”¨å…¶ä»–ç·¨è¼¯å™¨
```

### 3. åˆå§‹åŒ–æ•¸æ“šåº«

```bash
cd admin-backend
poetry run alembic upgrade head
```

### 4. å•Ÿå‹•æœå‹™

**é–‹ç™¼ç’°å¢ƒ**:
```bash
# å¾Œç«¯
cd admin-backend
poetry run uvicorn app.main:app --reload

# å‰ç«¯
cd saas-demo
npm run dev
```

**ç”Ÿç”¢ç’°å¢ƒ**:
```bash
# ä½¿ç”¨ Docker Compose
docker-compose up -d

# æˆ–ä½¿ç”¨ systemd æœå‹™
sudo systemctl start group-ai-backend
sudo systemctl start group-ai-frontend
```

### 5. é©—è­‰éƒ¨ç½²

```bash
# å¥åº·æª¢æŸ¥
curl http://localhost:8000/health

# API æ–‡æª”
open http://localhost:8000/docs

# å‰ç«¯
open http://localhost:3000
```

---

## ğŸ“ ç¶­è­·å»ºè­°

### å®šæœŸä»»å‹™

1. **æ•¸æ“šåº«å‚™ä»½**ï¼ˆæ¯æ—¥ï¼‰
   ```bash
   pg_dump -U user -d admin_db > backup_$(date +%Y%m%d).sql
   ```

2. **æ—¥èªŒæ¸…ç†**ï¼ˆæ¯é€±ï¼‰
   - æ¸…ç†èˆŠæ—¥èªŒæ–‡ä»¶
   - å£“ç¸®æ­¸æª”æ—¥èªŒ

3. **ä¾è³´æ›´æ–°**ï¼ˆæ¯æœˆï¼‰
   ```bash
   cd admin-backend && poetry update
   cd ../saas-demo && npm update
   ```

4. **å®‰å…¨æ›´æ–°**ï¼ˆåŠæ™‚ï¼‰
   - é—œæ³¨å®‰å…¨å…¬å‘Š
   - åŠæ™‚æ›´æ–°ä¾è³´

### ç›£æ§æŒ‡æ¨™

- API éŸ¿æ‡‰æ™‚é–“
- éŒ¯èª¤ç‡
- æ•¸æ“šåº«é€£æ¥æ•¸
- å…§å­˜ä½¿ç”¨ç‡
- CPU ä½¿ç”¨ç‡

---

## âš ï¸ æ³¨æ„äº‹é …

1. **èªè­‰å¿…é ˆå•Ÿç”¨**: ç”Ÿç”¢ç’°å¢ƒçµ•å°ä¸èƒ½è¨­ç½® `DISABLE_AUTH=true`
2. **å¼·å¯†ç¢¼**: æ‰€æœ‰å¯†ç¢¼å’Œ Secret å¿…é ˆä½¿ç”¨å¼·å¯†ç¢¼
3. **HTTPS**: ç”Ÿç”¢ç’°å¢ƒå¿…é ˆä½¿ç”¨ HTTPS
4. **å‚™ä»½**: å®šæœŸå‚™ä»½æ•¸æ“šåº«å’Œé…ç½®æ–‡ä»¶
5. **ç›£æ§**: å•Ÿç”¨ç›£æ§å’Œå‘Šè­¦ï¼ŒåŠæ™‚ç™¼ç¾å•é¡Œ

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [éƒ¨ç½²æŒ‡å—](../ä½¿ç”¨è¯´æ˜/018_DEPLOY_GUIDE.md)
- [ç’°å¢ƒè®Šé‡é…ç½®çŸ©é™£](../å¼€å‘ç¬”è®°/CONFIG_ENV_MATRIX.md)
- [å¥åº·æª¢æŸ¥èˆ‡è‡ªæª¢æµç¨‹](../ä½¿ç”¨è¯´æ˜/HEALTHCHECK_AND_SELFTEST.md)
- [ç™¼å¸ƒæª¢æŸ¥æ¸…å–®](../å¼€å‘ç¬”è®°/RELEASE_CHECKLIST.md)

---

**ç‹€æ…‹**: âœ… ç”Ÿç”¢ç’°å¢ƒæº–å‚™å®Œæˆï¼Œå¯ä»¥é–‹å§‹éƒ¨ç½²

