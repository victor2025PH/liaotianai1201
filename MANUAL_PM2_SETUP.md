# Manual PM2 Setup Instructions

ç”±äº SSH è¿æ¥é—®é¢˜ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åœ¨æœåŠ¡å™¨ä¸Šæ‰‹åŠ¨æ‰§è¡Œï¼š

## ğŸ“‹ æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤ 1: SSH åˆ°æœåŠ¡å™¨

```bash
ssh ubuntu@165.154.233.55
```

### æ­¥éª¤ 2: è¿›å…¥é¡¹ç›®ç›®å½•

```bash
cd /home/ubuntu/telegram-ai-system
```

### æ­¥éª¤ 3: æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
git pull origin main
```

### æ­¥éª¤ 4: å®‰è£… PM2ï¼ˆä½¿ç”¨ sudoï¼‰

```bash
sudo npm install -g pm2
```

**é‡è¦**: å¿…é¡»ä½¿ç”¨ `sudo`ï¼Œå¦åˆ™ä¼šå› æƒé™ä¸è¶³è€Œå¤±è´¥ã€‚

### æ­¥éª¤ 5: éªŒè¯ PM2 å®‰è£…

```bash
pm2 -v
```

åº”è¯¥çœ‹åˆ°ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ï¼š`5.3.0`

### æ­¥éª¤ 6: è¿è¡Œ PM2 è®¾ç½®è„šæœ¬

```bash
bash scripts/server/setup-pm2.sh
```

æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# åœæ­¢ç°æœ‰è¿›ç¨‹ï¼ˆå¦‚æœæœ‰ï¼‰
pm2 stop all
pm2 delete all

# å¯åŠ¨æœåŠ¡
pm2 start ecosystem.config.js

# ä¿å­˜é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆå¯é€‰ï¼‰
pm2 startup
# æ‰§è¡Œä¸Šé¢å‘½ä»¤è¾“å‡ºçš„å‘½ä»¤ï¼ˆé€šå¸¸éœ€è¦ sudoï¼‰
```

### æ­¥éª¤ 7: éªŒè¯æœåŠ¡çŠ¶æ€

```bash
pm2 status
```

åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id  â”‚ name     â”‚ mode        â”‚ â†º       â”‚ status  â”‚ cpu      â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0   â”‚ backend  â”‚ fork        â”‚ 0       â”‚ online  â”‚ 0%       â”‚
â”‚ 1   â”‚ frontend â”‚ fork        â”‚ 0       â”‚ online  â”‚ 0%       â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ­¥éª¤ 8: éªŒè¯å‰ç«¯å“åº”

```bash
curl -I http://localhost:3000
```

åº”è¯¥çœ‹åˆ° HTTP 200 å“åº”ã€‚

### æ­¥éª¤ 9: éªŒè¯åç«¯å“åº”

```bash
curl -I http://localhost:8000/health
```

åº”è¯¥çœ‹åˆ° HTTP 200 å“åº”ã€‚

## ğŸ”§ æ•…éšœæ’é™¤

### PM2 å®‰è£…å¤±è´¥

å¦‚æœ `sudo npm install -g pm2` å¤±è´¥ï¼š

1. æ£€æŸ¥ Node.js å’Œ npm æ˜¯å¦å·²å®‰è£…ï¼š
   ```bash
   node -v
   npm -v
   ```

2. å¦‚æœæœªå®‰è£…ï¼Œå…ˆå®‰è£… Node.jsï¼š
   ```bash
   curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
   sudo apt-get install -y nodejs
   ```

3. é‡æ–°å°è¯•å®‰è£… PM2ï¼š
   ```bash
   sudo npm install -g pm2
   ```

### è™šæ‹Ÿç¯å¢ƒä¸å­˜åœ¨

å¦‚æœåç«¯å¯åŠ¨å¤±è´¥ï¼Œæ£€æŸ¥è™šæ‹Ÿç¯å¢ƒï¼š

```bash
cd /home/ubuntu/telegram-ai-system/admin-backend
ls -la venv/bin/python

# å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### ç«¯å£è¢«å ç”¨

å¦‚æœç«¯å£è¢«å ç”¨ï¼š

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo lsof -i :8000  # åç«¯
sudo lsof -i :3000  # å‰ç«¯

# åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo kill -9 <PID>
```

### æŸ¥çœ‹æ—¥å¿—

å¦‚æœæœåŠ¡å¯åŠ¨å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
pm2 logs

# æŸ¥çœ‹åç«¯æ—¥å¿—
pm2 logs backend

# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
pm2 logs frontend

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs --err
```

## ğŸ“ å®Œæ•´å‘½ä»¤åºåˆ—ï¼ˆå¤åˆ¶ç²˜è´´ï¼‰

```bash
# 1. SSH åˆ°æœåŠ¡å™¨ï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼‰
ssh ubuntu@165.154.233.55

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/ubuntu/telegram-ai-system

# 3. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 4. å®‰è£… PM2ï¼ˆä½¿ç”¨ sudoï¼‰
sudo npm install -g pm2

# 5. éªŒè¯å®‰è£…
pm2 -v

# 6. è¿è¡Œè®¾ç½®è„šæœ¬
bash scripts/server/setup-pm2.sh

# 7. éªŒè¯çŠ¶æ€
pm2 status

# 8. éªŒè¯å‰ç«¯
curl -I http://localhost:3000

# 9. éªŒè¯åç«¯
curl -I http://localhost:8000/health
```

---

**æ³¨æ„**: å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æˆ–è”ç³»ç³»ç»Ÿç®¡ç†å‘˜ã€‚

