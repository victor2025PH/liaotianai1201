# 角色选择功能说明

## 功能描述

在分配剧本对话框中，当选择了剧本后，可以同时选择角色。角色选择具有以下特性：

1. **角色可点击选择**：每个角色都是一个可点击的按钮
2. **显示已选状态**：已选择的角色会高亮显示，并显示选中图标
3. **显示已被使用状态**：如果角色已被其他账号使用，会显示黄色背景和提示信息
4. **显示使用该角色的账号**：当角色已被使用时，显示"已分配给: 账号名称"
5. **替换确认**：如果尝试选择已被使用的角色，会弹出确认对话框

## 实现细节

### 1. 状态管理

- `formData.role_id`：当前选择的角色ID
- `accountRoleAssignments`：账号ID到角色ID的映射，用于跟踪哪些角色已被分配
- `selectedScriptRoles`：当前剧本的角色列表

### 2. 角色状态检查

```typescript
// 检查角色是否已被其他账号使用
const isRoleAssigned = (roleId: string, currentAccountId?: string): { assigned: boolean; accountId?: string }

// 获取使用该角色的账号名称
const getAccountNameByRole = (roleId: string, currentAccountId?: string): string | null
```

### 3. 角色显示状态

- **已选择**：蓝色背景（primary），显示选中图标
- **已被使用**：黄色背景（yellow-500/10），显示"已分配给: 账号名称"
- **可用**：默认背景，可点击选择

### 4. 分配剧本时的角色分配

当在分配剧本对话框中选择了角色，点击"分配剧本"按钮时：
1. 首先更新账号的剧本ID
2. 如果选择了角色，同时创建角色分配
3. 更新本地角色分配映射
4. 刷新账号列表

## 使用流程

1. 点击账号的"分配剧本"按钮
2. 在对话框中选择剧本
3. 剧本的角色列表会自动显示
4. 点击角色进行选择（可选）
5. 如果角色已被使用，会显示提示信息
6. 点击"分配剧本"完成分配

## 注意事项

- 角色选择是可选的，可以不选择角色只分配剧本
- 如果角色已被使用，可以选择替换（会弹出确认对话框）
- 角色分配信息会实时更新，其他账号选择角色时会看到最新的使用状态

