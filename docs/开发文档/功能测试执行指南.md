# Telegram注册系统 - 功能测试执行指南

## 🎯 测试目标

验证Telegram注册系统的所有功能是否正常工作，包括前端页面、API接口和完整注册流程。

## ✅ 测试前准备

### 1. 确认服务运行

```bash
# 检查后端服务
netstat -ano | findstr :8000

# 检查前端服务
netstat -ano | findstr :3000
```

### 2. 运行系统验证

```bash
cd admin-backend
python test_full_system.py
python verify_registration_integration.py
```

## 🧪 功能测试步骤

### 步骤1: 访问前端页面

1. **打开浏览器**
   - 访问: http://localhost:3000
   - 确认页面正常加载

2. **登录系统**
   - 输入有效的邮箱和密码
   - 点击登录
   - 确认登录成功，跳转到仪表板

### 步骤2: 进入账户中心

**方法1**: 通过菜单
- 点击左侧菜单"账户中心"
- 自动跳转到 `/accounts`

**方法2**: 直接访问URL
- 访问: http://localhost:3000/accounts

**预期结果**:
- ✅ 页面正常显示
- ✅ 显示3个标签页：账户列表、Telegram注册、生成Session
- ✅ 默认显示"账户列表"标签

### 步骤3: 测试Telegram注册功能

#### 3.1 切换到注册标签

1. 点击"Telegram注册"标签页
2. 确认页面正常显示

**检查项**:
- [ ] 步骤指示器显示（3步）
- [ ] 表单字段显示
- [ ] 服务器下拉框显示
- [ ] 无控制台错误

#### 3.2 测试表单验证

**测试手机号格式**:
- [ ] 输入 `1234567890` (缺少+号) → 应显示格式错误
- [ ] 输入 `+123` (太短) → 应显示格式错误
- [ ] 输入 `+1234567890` → 应通过验证

**测试必填字段**:
- [ ] 不填手机号 → 应显示必填提示
- [ ] 不选择服务器 → 应显示必填提示

#### 3.3 测试服务器列表加载

**检查项**:
- [ ] 服务器下拉框有选项
- [ ] 显示服务器信息（node_id, host, status）
- [ ] 可以选择服务器

#### 3.4 测试注册流程

**步骤1: 配置信息**
1. 填写手机号: `+1234567890` (使用真实手机号)
2. 选择国家代码: `+1`
3. 选择服务器: `worker-01`
4. 点击"开始注册"

**预期结果**:
- [ ] 按钮显示加载状态
- [ ] 如果成功: 跳转到步骤2
- [ ] 显示倒计时
- [ ] 显示风险评分
- [ ] 如果失败: 显示错误提示

**步骤2: 验证码输入**
1. 查看手机收到的验证码
2. 在输入框中输入验证码
3. 点击"验证"

**预期结果**:
- [ ] 如果正确: 跳转到步骤3
- [ ] 如果错误: 显示错误提示
- [ ] 如果过期: 显示过期提示

**步骤3: 完成**
**预期结果**:
- [ ] 显示成功消息
- [ ] 显示Session文件信息
- [ ] 显示"注册新的账号"按钮

## 📊 API测试（使用Swagger UI）

### 访问API文档

1. 打开浏览器
2. 访问: http://localhost:8000/docs
3. 找到 `telegram-registration` 标签

### 获取认证Token

1. 找到 `auth` 标签
2. 使用登录接口获取token:
   ```
   POST /api/v1/auth/login
   username: your_email
   password: your_password
   ```
3. 复制返回的 `access_token`
4. 点击右上角"Authorize"按钮
5. 输入: `Bearer <your_token>`
6. 点击"Authorize"

### 测试端点

#### 1. POST /telegram-registration/start

**请求体**:
```json
{
  "phone": "+1234567890",
  "country_code": "+1",
  "node_id": "worker-01"
}
```

**预期响应**:
```json
{
  "registration_id": "uuid-string",
  "status": "code_sent",
  "message": "验证码已发送",
  "phone_code_hash": "hash-string",
  "expires_in": 300,
  "risk_score": 25
}
```

#### 2. POST /telegram-registration/verify

**请求体**:
```json
{
  "registration_id": "从start接口获得",
  "code": "12345"
}
```

#### 3. GET /telegram-registration/status/{registration_id}

**预期响应**:
```json
{
  "registration_id": "uuid-string",
  "status": "code_sent",
  "message": "等待验证码输入",
  "phone": "+1234567890",
  "node_id": "worker-01",
  "expires_at": "2025-11-22T13:25:00",
  "risk_score": 25
}
```

## 🔍 测试检查清单

### 前端测试

- [ ] 页面加载正常
- [ ] 登录功能正常
- [ ] 路由导航正常
- [ ] 账户中心页面正常
- [ ] Telegram注册标签页正常
- [ ] 表单验证正常
- [ ] 服务器列表加载
- [ ] 注册流程正常
- [ ] 错误处理正常
- [ ] 倒计时显示正常
- [ ] 风险评分显示正常

### API测试

- [ ] 服务器列表API正常
- [ ] 开始注册API正常
- [ ] 验证码API正常
- [ ] 状态查询API正常
- [ ] 取消注册API正常

### 集成测试

- [ ] 完整注册流程
- [ ] 异常场景处理
- [ ] 用户体验良好

## ⚠️ 常见问题排查

### 前端页面无法访问

1. **检查服务是否运行**
   ```bash
   netstat -ano | findstr :3000
   ```

2. **检查浏览器控制台**
   - 打开开发者工具（F12）
   - 查看Console标签
   - 查看Network标签

3. **检查API地址配置**
   - 确认 `VITE_API_BASE_URL` 配置正确
   - 默认: `http://localhost:8000/api/v1`

### API返回401错误

**原因**: 需要认证token

**解决**:
1. 在Swagger UI中设置token
2. 或在前端页面中登录（自动处理）

### 服务器列表为空

**检查**:
1. 后端服务是否运行
2. `data/master_config.json` 配置是否正确
3. API端点 `/group-ai/servers` 是否正常

### 注册失败

**可能原因**:
1. 服务器配置不正确
2. SSH连接失败
3. 服务器上缺少pyrogram
4. 手机号格式错误
5. 触发速率限制

**排查**:
1. 查看后端日志
2. 检查服务器配置
3. 测试SSH连接
4. 查看错误消息

## 📝 测试报告模板

```
测试日期: YYYY-MM-DD
测试人员: [姓名]
测试环境: [描述]

=== 前端测试 ===
页面加载: [通过/失败]
登录功能: [通过/失败]
注册页面: [通过/失败]
表单验证: [通过/失败]
注册流程: [通过/失败]

=== API测试 ===
服务器列表: [通过/失败]
开始注册: [通过/失败]
验证码: [通过/失败]
状态查询: [通过/失败]

=== 集成测试 ===
完整流程: [通过/失败]
异常处理: [通过/失败]

=== 发现的问题 ===
1. [问题描述]
2. [问题描述]

=== 建议 ===
1. [建议内容]
2. [建议内容]
```

## ✅ 测试完成标准

### 必须通过的项目

1. ✅ 前端页面可访问
2. ✅ 登录功能正常
3. ✅ 账户中心页面正常
4. ✅ Telegram注册标签页正常
5. ✅ 表单验证正常
6. ✅ API端点可访问

### 功能测试通过标准

1. ✅ 注册流程完整
2. ✅ 错误处理正常
3. ✅ 用户体验良好

## 🎉 测试完成

当所有测试项通过后，系统即可投入使用！

---

**提示**: 测试过程中如发现问题，请及时记录并修复。

