# 502 錯誤 - 完整配置檢查

> **日期**: 2025-12-01  
> **狀態**: Nginx 配置已重載，需要確認路由匹配

---

## 📊 當前狀況

- ✅ Nginx 配置語法正確
- ✅ proxy_pass 指向 `http://127.0.0.1:8000`（正確）
- ✅ Nginx 已重載
- ✅ 後端服務正常運行

---

## 🔍 檢查完整的 Nginx 配置

執行以下命令查看完整的配置文件，確認 location 塊配置：

```bash
echo "=== 檢查完整的 Nginx 配置 ===" && \
echo "" && \
echo "【1】查看完整的配置文件..." && \
sudo cat /etc/nginx/sites-enabled/aikz.usdt2026.cc && \
echo "" && \
echo "【2】檢查 location 塊..." && \
sudo grep -B 2 -A 10 "location" /etc/nginx/sites-enabled/aikz.usdt2026.cc && \
echo "" && \
echo "【3】測試後端連接..." && \
curl -v http://127.0.0.1:8000/health 2>&1 | head -15 && \
echo "" && \
echo "【4】檢查 Nginx 訪問日誌（最近的請求）..." && \
sudo tail -10 /var/log/nginx/access.log
```

---

## 🔧 可能的問題

### 問題 1: location 路由不匹配

如果訪問的是 `/api` 路徑，但 Nginx 配置的 location 不匹配，會導致 502。

### 問題 2: 後端服務在 Nginx 重載時未運行

如果之前後端未運行，現在已修復，需要：
1. 確認後端正在運行
2. 重載 Nginx（已完成）

### 問題 3: 緩存問題

瀏覽器可能緩存了 502 錯誤頁面。

---

## ✅ 驗證步驟

1. **清除瀏覽器緩存** 或使用 **無痕模式** 訪問
2. **測試後端直接訪問**:
   ```bash
   curl http://127.0.0.1:8000/health
   ```
3. **測試通過 Nginx 訪問**:
   ```bash
   curl -H "Host: aikz.usdt2026.cc" http://127.0.0.1/health
   ```

---

**執行上述檢查命令，確認配置是否完全正確！**
