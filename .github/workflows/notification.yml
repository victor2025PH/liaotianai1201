name: CI/CD é€šçŸ¥

on:
  workflow_run:
    workflows: ["CI", "Deploy to Environments"]
    types:
      - completed
  workflow_dispatch:

jobs:
  notify:
    name: ç™¼é€é€šçŸ¥
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion != 'cancelled' }}
    
    steps:
      - name: æª¢æŸ¥å·¥ä½œæµç‹€æ…‹
        id: check-status
        run: |
          STATUS="${{ github.event.workflow_run.conclusion }}"
          WORKFLOW="${{ github.event.workflow_run.name }}"
          echo "status=${STATUS}" >> $GITHUB_OUTPUT
          echo "workflow=${WORKFLOW}" >> $GITHUB_OUTPUT
          echo "ğŸ” å·¥ä½œæµ: ${WORKFLOW}"
          echo "ğŸ“Š ç‹€æ…‹: ${STATUS}"
      
      - name: ç”Ÿæˆé€šçŸ¥æ¶ˆæ¯
        id: generate-message
        run: |
          STATUS="${{ steps.check-status.outputs.status }}"
          WORKFLOW="${{ steps.check-status.outputs.workflow }}"
          BRANCH="${{ github.event.workflow_run.head_branch }}"
          COMMIT="${{ github.event.workflow_run.head_sha }}"
          URL="${{ github.event.workflow_run.html_url }}"
          
          if [ "$STATUS" = "success" ]; then
            EMOJI="âœ…"
            MESSAGE="æˆåŠŸ"
          elif [ "$STATUS" = "failure" ]; then
            EMOJI="âŒ"
            MESSAGE="å¤±æ•—"
          else
            EMOJI="âš ï¸"
            MESSAGE="æœªå®Œæˆ"
          fi
          
          FULL_MESSAGE="${EMOJI} **${WORKFLOW}** ${MESSAGE}

**åˆ†æ”¯**: ${BRANCH}
**æäº¤**: ${COMMIT:0:7}
**è©³æƒ…**: [æŸ¥çœ‹å·¥ä½œæµ](${URL})"
          
          echo "message<<EOF" >> $GITHUB_OUTPUT
          echo "$FULL_MESSAGE" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
      
      - name: è¼¸å‡ºé€šçŸ¥ï¼ˆå¯åœ¨é€™è£¡æ·»åŠ  Telegram/Email/Webhookï¼‰
        run: |
          echo "${{ steps.generate-message.outputs.message }}"
          # å¯ä»¥åœ¨é€™è£¡æ·»åŠ å¯¦éš›çš„é€šçŸ¥é‚è¼¯
          # ä¾‹å¦‚ï¼šç™¼é€ Telegram æ¶ˆæ¯ã€ç™¼é€éƒµä»¶ã€èª¿ç”¨ Webhook ç­‰
