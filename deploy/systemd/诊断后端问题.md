# 诊断后端服务启动失败

## 当前问题
后端服务启动失败：`status=1/FAILURE`

## 诊断步骤

### 1. 退出 less 查看器
如果还在 less 中，按 `q` 退出

### 2. 查看服务日志
```bash
sudo journalctl -u admin-backend -n 50 --no-pager
```

这会显示最近 50 行的日志，帮助我们找出失败原因。

### 3. 手动测试启动
```bash
cd /home/ubuntu/admin-backend
source .venv/bin/activate
python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

这样可以直接看到错误信息。

### 4. 检查常见问题

#### 问题1: 缺少依赖
```bash
cd /home/ubuntu/admin-backend
source .venv/bin/activate
pip install -r requirements.txt
```

#### 问题2: 缺少模块
```bash
# 检查 app 目录是否存在
ls -la /home/ubuntu/admin-backend/app/

# 检查 main.py 是否存在
ls -la /home/ubuntu/admin-backend/app/main.py
```

#### 问题3: 环境变量问题
```bash
# 检查 .env 文件
cat /home/ubuntu/admin-backend/.env

# 检查文件权限
ls -la /home/ubuntu/admin-backend/.env
```

#### 问题4: 端口被占用
```bash
sudo ss -tlnp | grep 8000
# 如果端口被占用，杀死进程或更改端口
```

### 5. 检查 Python 路径
```bash
# 检查虚拟环境中的 Python
ls -la /home/ubuntu/admin-backend/.venv/bin/python3

# 测试 Python 是否可用
/home/ubuntu/admin-backend/.venv/bin/python3 --version
```

## 常见错误和解决方案

### 错误1: ModuleNotFoundError
**原因**: 缺少 Python 模块
**解决**: 
```bash
cd /home/ubuntu/admin-backend
source .venv/bin/activate
pip install <缺失的模块名>
```

### 错误2: 找不到 app.main
**原因**: app 目录结构不正确
**解决**: 检查目录结构
```bash
ls -la /home/ubuntu/admin-backend/
ls -la /home/ubuntu/admin-backend/app/
```

### 错误3: 权限问题
**原因**: 文件权限不正确
**解决**:
```bash
sudo chown -R ubuntu:ubuntu /home/ubuntu/admin-backend
chmod +x /home/ubuntu/admin-backend/.venv/bin/python3
```

### 错误4: 数据库连接问题
**原因**: 数据库配置错误
**解决**: 检查 .env 文件中的 DATABASE_URL

## 修复后的步骤

1. 修复问题后，重新启动服务：
```bash
sudo systemctl restart admin-backend
sudo systemctl status admin-backend
```

2. 如果仍然失败，查看详细日志：
```bash
sudo journalctl -u admin-backend -f
```


