# 后台测试使用说明

> **全自动后台执行 E2E 测试，输出保存到日志文件**

---

## 🚀 快速开始

### 1. 启动后台测试

在服务器上执行：

```bash
cd ~/liaotian/saas-demo
chmod +x 启动后台测试.sh
bash 启动后台测试.sh
```

### 2. 查看实时日志

```bash
# 方法 1: 使用查看脚本（交互式菜单）
bash 查看测试日志.sh

# 方法 2: 直接查看最新日志
tail -f ~/liaotian/test_logs/e2e_test_*.log

# 方法 3: 查看最新日志的最后 50 行
bash 查看测试日志.sh 2
```

---

## 📋 详细说明

### 文件说明

1. **`后台执行测试.sh`** - 实际的测试执行脚本
   - 执行所有测试步骤
   - 将输出保存到日志文件

2. **`启动后台测试.sh`** - 启动脚本
   - 在后台启动测试任务
   - 显示日志文件位置
   - 保存进程 ID

3. **`查看测试日志.sh`** - 日志查看工具
   - 交互式菜单
   - 实时查看日志
   - 查看进程状态
   - 停止测试进程

---

## 🔧 常用命令

### 查看实时日志

```bash
# 使用查看脚本（推荐）
bash 查看测试日志.sh 1

# 或直接 tail
tail -f ~/liaotian/test_logs/e2e_test_*.log
```

### 查看最新日志的最后几行

```bash
bash 查看测试日志.sh 2
# 或
tail -50 ~/liaotian/test_logs/e2e_test_*.log | tail -50
```

### 查看所有日志文件

```bash
bash 查看测试日志.sh 3
# 或
ls -lht ~/liaotian/test_logs/e2e_test_*.log
```

### 查看测试进程状态

```bash
bash 查看测试日志.sh 4
# 或
cat ~/liaotian/test_logs/e2e_test.pid | xargs ps -p
```

### 停止测试进程

```bash
bash 查看测试日志.sh 5
# 或
kill $(cat ~/liaotian/test_logs/e2e_test.pid)
```

---

## 📁 日志文件位置

所有日志文件保存在：

```
~/liaotian/test_logs/e2e_test_YYYYMMDD_HHMMSS.log
```

进程 ID 文件：

```
~/liaotian/test_logs/e2e_test.pid
```

---

## 🔍 快速查看命令

### 查看最新的日志文件

```bash
LATEST_LOG=$(ls -t ~/liaotian/test_logs/e2e_test_*.log | head -1)
tail -f "$LATEST_LOG"
```

### 查看测试是否在运行

```bash
if [ -f ~/liaotian/test_logs/e2e_test.pid ]; then
    PID=$(cat ~/liaotian/test_logs/e2e_test.pid)
    if ps -p "$PID" > /dev/null; then
        echo "✅ 测试正在运行 (PID: $PID)"
    else
        echo "❌ 测试已结束"
    fi
else
    echo "❌ 没有运行中的测试"
fi
```

---

## ✅ 完整流程示例

```bash
# 1. 拉取最新代码
cd ~/liaotian/saas-demo
git pull origin master

# 2. 给脚本添加执行权限
chmod +x *.sh

# 3. 启动后台测试
bash 启动后台测试.sh

# 4. 在另一个终端查看日志
bash 查看测试日志.sh 1

# 5. 测试完成后查看结果
bash 查看测试日志.sh 2
```

---

## 🛠️ 故障排除

### 日志文件不存在

如果日志文件不存在，可能的原因：
- 测试还未开始
- 日志目录创建失败
- 脚本执行失败

检查：
```bash
ls -la ~/liaotian/test_logs/
```

### 进程无法停止

如果进程无法正常停止：
```bash
# 强制停止
kill -9 $(cat ~/liaotian/test_logs/e2e_test.pid)
rm ~/liaotian/test_logs/e2e_test.pid
```

### 查看错误信息

```bash
# 查看最新的日志文件中的错误
LATEST_LOG=$(ls -t ~/liaotian/test_logs/e2e_test_*.log | head -1)
grep -i error "$LATEST_LOG" | tail -20
```

---

**状态**: ✅ 准备就绪  
**下一步**: 执行 `bash 启动后台测试.sh`
