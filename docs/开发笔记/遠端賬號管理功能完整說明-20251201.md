# 遠端賬號管理功能完整說明

> **日期**: 2025-12-01  
> **功能**: 後台管理遠端服務器和其他電腦上的 Telegram 賬號

---

## 📋 功能概述

### 核心功能

1. **遠端賬號自動同步** ✅ 已實現
   - Worker 節點通過心跳上報賬號列表
   - 後台自動同步到數據庫
   - 前端顯示所有賬號（本地+遠端）

2. **劇本傳送** ✅ 基礎已實現
   - 後台推送劇本到遠端節點
   - 通過命令隊列發送推送指令

3. **會話管理** ⏳ 待實現
   - 上傳會話文件到遠端
   - 會話文件同步

---

## 🔧 技術架構

### 工作流程圖

```
┌────────────────────────────────────────┐
│       後台管理系統（主節點）            │
│                                        │
│  ┌──────────────────────────────────┐  │
│  │  Workers API                    │  │
│  │  - 接收心跳                      │  │
│  │  - 同步賬號                      │  │
│  │  - 命令隊列                      │  │
│  └──────────────────────────────────┘  │
│                                        │
│  ┌──────────────────────────────────┐  │
│  │  Script Deployment API           │  │
│  │  - 劇本推送                      │  │
│  └──────────────────────────────────┘  │
│                                        │
│  ┌──────────────────────────────────┐  │
│  │  Accounts API                    │  │
│  │  - 賬號管理                      │  │
│  │  - 顯示所有賬號（本地+遠端）      │  │
│  └──────────────────────────────────┘  │
└──────────────┬─────────────────────────┘
               │
               │ HTTP API + Redis/命令隊列
               │
    ┌──────────┴──────────┐
    │                     │
┌───▼──────┐       ┌──────▼───────┐
│ Worker   │       │   Worker     │
│ 節點 1   │       │   節點 2     │
│          │       │              │
│ 賬號 A   │       │  賬號 B      │
│ 賬號 B   │       │  賬號 C      │
│          │       │              │
│ 發送心跳 │       │  發送心跳    │
│ (每30秒) │       │  (每30秒)    │
└──────────┘       └──────────────┘
```

---

## 📝 使用場景

### 場景 1: 查看遠端賬號運行狀態

**需求**: 在後台查看所有遠端節點的賬號運行狀態

**流程**:
1. Worker 節點每 30 秒發送心跳，包含賬號列表
2. 後台接收心跳，自動同步賬號到數據庫
3. 前端顯示所有賬號，標記來源節點

**實現**:
- ✅ Worker 心跳機制
- ✅ 賬號自動同步
- ⏳ 前端顯示（待增強）

### 場景 2: 推送劇本到遠端節點

**需求**: 從後台推送劇本到遠端 Worker 節點

**流程**:
1. 在後台選擇劇本
2. 選擇目標 Worker 節點
3. 點擊「推送」
4. 後台發送命令到 Worker 節點
5. Worker 節點下載並更新劇本

**實現**:
- ✅ 劇本推送 API
- ⏳ 劇本下載端點（待實現）
- ⏳ 前端 UI（待實現）

### 場景 3: 上傳會話到遠端節點

**需求**: 上傳會話文件到遠端節點並自動加載

**流程**:
1. 在後台上傳 `.session` 文件
2. 選擇目標 Worker 節點
3. 後台通過命令隊列發送傳輸指令
4. Worker 節點接收並保存會話文件

**實現**:
- ✅ 會話上傳已存在
- ⏳ 會話傳輸到遠端（待實現）

---

## 🚀 Worker 節點實現要求

### Worker 節點需要實現的功能

1. **心跳機制** - 每 30 秒發送心跳，包含賬號列表
2. **命令處理** - 從命令隊列獲取並執行命令
3. **劇本下載** - 從後台下載劇本文件
4. **會話管理** - 接收和保存會話文件

---

## 📋 已實現的文件

1. ✅ `admin-backend/app/api/group_ai/remote_account_sync.py` - 賬號同步
2. ✅ `admin-backend/app/api/group_ai/script_deployment.py` - 劇本推送
3. ✅ `admin-backend/app/api/workers.py` - 心跳處理（已增強）

---

**基礎架構已完成，可以開始完整實現和測試！**
