# æ¬Šé™æª¢æŸ¥é›†æˆå®Œæˆå ±å‘Š

> **å®Œæˆæ—¥æœŸ**: 2025-01-17  
> **åŠŸèƒ½ç‹€æ…‹**: âœ… å·²å®Œæˆï¼ˆåŸºç¤ç‰ˆæœ¬ï¼‰  
> **æ¸¬è©¦ç‹€æ…‹**: å¾…æ¸¬è©¦

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å·²ç‚ºæ‰€æœ‰ Group AI API ç«¯é»æ·»åŠ æ¬Šé™æª¢æŸ¥ï¼Œç¢ºä¿åªæœ‰å…·å‚™ç›¸æ‡‰æ¬Šé™çš„ç”¨æˆ¶æ‰èƒ½åŸ·è¡Œç›¸æ‡‰æ“ä½œã€‚

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. è³¬è™Ÿç®¡ç† API âœ…

**æ–‡ä»¶**: `admin-backend/app/api/group_ai/accounts.py`

**å·²æ·»åŠ æ¬Šé™æª¢æŸ¥çš„ç«¯é»**:
- `POST /accounts` - å‰µå»ºè³¬è™Ÿï¼ˆéœ€è¦ `account:create`ï¼‰
- `GET /accounts/scan-sessions` - æƒæ sessionsï¼ˆéœ€è¦ `account:view`ï¼‰
- `POST /accounts/upload-session` - ä¸Šå‚³ sessionï¼ˆéœ€è¦ `account:create`ï¼‰
- `GET /accounts` - åˆ—å‡ºæ‰€æœ‰è³¬è™Ÿï¼ˆéœ€è¦ `account:view`ï¼‰
- `GET /accounts/{account_id}` - ç²å–è³¬è™Ÿè©³æƒ…ï¼ˆéœ€è¦ `account:view`ï¼‰
- `PUT /accounts/{account_id}` - æ›´æ–°è³¬è™Ÿï¼ˆéœ€è¦ `account:update`ï¼‰
- `DELETE /accounts/{account_id}` - åˆªé™¤è³¬è™Ÿï¼ˆéœ€è¦ `account:delete`ï¼‰
- `POST /accounts/batch-import` - æ‰¹é‡å°å…¥ï¼ˆéœ€è¦ `account:batch_operate`ï¼‰
- `POST /accounts/{account_id}/start` - å•Ÿå‹•è³¬è™Ÿï¼ˆéœ€è¦ `account:start`ï¼‰
- `POST /accounts/{account_id}/stop` - åœæ­¢è³¬è™Ÿï¼ˆéœ€è¦ `account:stop`ï¼‰
- `GET /accounts/{account_id}/status` - ç²å–è³¬è™Ÿç‹€æ…‹ï¼ˆéœ€è¦ `account:view`ï¼‰

**æ¬Šé™ä»£ç¢¼**:
- `account:view` - æŸ¥çœ‹è³¬è™Ÿ
- `account:create` - å‰µå»ºè³¬è™Ÿ
- `account:update` - æ›´æ–°è³¬è™Ÿ
- `account:delete` - åˆªé™¤è³¬è™Ÿ
- `account:start` - å•Ÿå‹•è³¬è™Ÿ
- `account:stop` - åœæ­¢è³¬è™Ÿ
- `account:batch_operate` - æ‰¹é‡æ“ä½œ

---

### 2. åŠ‡æœ¬ç®¡ç† API âœ…

**æ–‡ä»¶**: `admin-backend/app/api/group_ai/scripts.py`

**å·²æ·»åŠ æ¬Šé™æª¢æŸ¥çš„ç«¯é»**:
- `POST /scripts` - å‰µå»ºåŠ‡æœ¬ï¼ˆéœ€è¦ `script:create`ï¼‰
- `GET /scripts` - åˆ—å‡ºæ‰€æœ‰åŠ‡æœ¬ï¼ˆéœ€è¦ `script:view`ï¼‰
- `GET /scripts/{script_id}` - ç²å–åŠ‡æœ¬è©³æƒ…ï¼ˆéœ€è¦ `script:view`ï¼‰
- `PUT /scripts/{script_id}` - æ›´æ–°åŠ‡æœ¬ï¼ˆéœ€è¦ `script:update`ï¼‰
- `DELETE /scripts/{script_id}` - åˆªé™¤åŠ‡æœ¬ï¼ˆéœ€è¦ `script:delete`ï¼‰
- `POST /scripts/{script_id}/test` - æ¸¬è©¦åŠ‡æœ¬ï¼ˆéœ€è¦ `script:test`ï¼‰
- `POST /scripts/upload` - ä¸Šå‚³åŠ‡æœ¬ï¼ˆéœ€è¦ `script:create`ï¼‰

**æ¬Šé™ä»£ç¢¼**:
- `script:view` - æŸ¥çœ‹åŠ‡æœ¬
- `script:create` - å‰µå»ºåŠ‡æœ¬
- `script:update` - æ›´æ–°åŠ‡æœ¬
- `script:delete` - åˆªé™¤åŠ‡æœ¬
- `script:test` - æ¸¬è©¦åŠ‡æœ¬

---

### 3. åŠ‡æœ¬å¯©æ ¸èˆ‡ç™¼å¸ƒ API âœ…

**æ–‡ä»¶**: `admin-backend/app/api/group_ai/script_review.py`

**å·²æ·»åŠ æ¬Šé™æª¢æŸ¥çš„ç«¯é»**:
- `POST /scripts/{script_id}/submit-review` - æäº¤å¯©æ ¸ï¼ˆéœ€è¦ `script:review`ï¼‰
- `POST /scripts/{script_id}/review` - å¯©æ ¸åŠ‡æœ¬ï¼ˆéœ€è¦ `script:review`ï¼‰
- `POST /scripts/{script_id}/publish` - ç™¼å¸ƒåŠ‡æœ¬ï¼ˆéœ€è¦ `script:publish`ï¼‰
- `POST /scripts/{script_id}/disable` - åœç”¨åŠ‡æœ¬ï¼ˆéœ€è¦ `script:disable`ï¼‰
- `POST /scripts/{script_id}/revert-to-draft` - æ¢å¾©ç‚ºè‰ç¨¿ï¼ˆéœ€è¦ `script:review`ï¼‰

**æ¬Šé™ä»£ç¢¼**:
- `script:review` - å¯©æ ¸åŠ‡æœ¬
- `script:publish` - ç™¼å¸ƒåŠ‡æœ¬
- `script:disable` - åœç”¨åŠ‡æœ¬

---

### 4. è§’è‰²åˆ†é…æ–¹æ¡ˆ API âœ…

**æ–‡ä»¶**: `admin-backend/app/api/group_ai/role_assignment_schemes.py`

**å·²æ·»åŠ æ¬Šé™æª¢æŸ¥çš„ç«¯é»**:
- `POST /role-assignment-schemes` - å‰µå»ºæ–¹æ¡ˆï¼ˆéœ€è¦ `role_assignment_scheme:create`ï¼‰
- `GET /role-assignment-schemes` - åˆ—å‡ºæ‰€æœ‰æ–¹æ¡ˆï¼ˆéœ€è¦ `role_assignment_scheme:view`ï¼‰
- `GET /role-assignment-schemes/{scheme_id}` - ç²å–æ–¹æ¡ˆè©³æƒ…ï¼ˆéœ€è¦ `role_assignment_scheme:view`ï¼‰
- `PUT /role-assignment-schemes/{scheme_id}` - æ›´æ–°æ–¹æ¡ˆï¼ˆéœ€è¦ `role_assignment_scheme:update`ï¼‰
- `DELETE /role-assignment-schemes/{scheme_id}` - åˆªé™¤æ–¹æ¡ˆï¼ˆéœ€è¦ `role_assignment_scheme:delete`ï¼‰
- `POST /role-assignment-schemes/{scheme_id}/apply` - æ‡‰ç”¨æ–¹æ¡ˆï¼ˆéœ€è¦ `role_assignment_scheme:apply`ï¼‰
- `GET /role-assignment-schemes/{scheme_id}/history` - ç²å–æ­·å²ï¼ˆéœ€è¦ `role_assignment_scheme:view`ï¼‰

**æ¬Šé™ä»£ç¢¼**:
- `role_assignment_scheme:view` - æŸ¥çœ‹æ–¹æ¡ˆ
- `role_assignment_scheme:create` - å‰µå»ºæ–¹æ¡ˆ
- `role_assignment_scheme:update` - æ›´æ–°æ–¹æ¡ˆ
- `role_assignment_scheme:delete` - åˆªé™¤æ–¹æ¡ˆ
- `role_assignment_scheme:apply` - æ‡‰ç”¨æ–¹æ¡ˆ

---

### 5. è‡ªå‹•åŒ–ä»»å‹™ API âœ…

**æ–‡ä»¶**: `admin-backend/app/api/group_ai/automation_tasks.py`

**å·²æ·»åŠ æ¬Šé™æª¢æŸ¥çš„ç«¯é»**:
- `POST /automation-tasks` - å‰µå»ºä»»å‹™ï¼ˆéœ€è¦ `automation_task:create`ï¼‰
- `GET /automation-tasks` - åˆ—å‡ºæ‰€æœ‰ä»»å‹™ï¼ˆéœ€è¦ `automation_task:view`ï¼‰
- `GET /automation-tasks/{task_id}` - ç²å–ä»»å‹™è©³æƒ…ï¼ˆéœ€è¦ `automation_task:view`ï¼‰
- `PUT /automation-tasks/{task_id}` - æ›´æ–°ä»»å‹™ï¼ˆéœ€è¦ `automation_task:update`ï¼‰
- `DELETE /automation-tasks/{task_id}` - åˆªé™¤ä»»å‹™ï¼ˆéœ€è¦ `automation_task:delete`ï¼‰
- `POST /automation-tasks/{task_id}/run` - åŸ·è¡Œä»»å‹™ï¼ˆéœ€è¦ `automation_task:run`ï¼‰
- `GET /automation-tasks/{task_id}/logs` - ç²å–æ—¥èªŒï¼ˆéœ€è¦ `automation_task:log:view`ï¼‰

**æ¬Šé™ä»£ç¢¼**:
- `automation_task:view` - æŸ¥çœ‹ä»»å‹™
- `automation_task:create` - å‰µå»ºä»»å‹™
- `automation_task:update` - æ›´æ–°ä»»å‹™
- `automation_task:delete` - åˆªé™¤ä»»å‹™
- `automation_task:run` - åŸ·è¡Œä»»å‹™
- `automation_task:log:view` - æŸ¥çœ‹æ—¥èªŒ

---

## ğŸ“Š åŠŸèƒ½çµ±è¨ˆ

| API æ¨¡å¡Š | ç«¯é»æ•¸é‡ | æ¬Šé™æª¢æŸ¥ | ç‹€æ…‹ |
|---------|---------|---------|------|
| è³¬è™Ÿç®¡ç† | 11 | âœ… | å®Œæˆ |
| åŠ‡æœ¬ç®¡ç† | 7 | âœ… | å®Œæˆ |
| åŠ‡æœ¬å¯©æ ¸ | 5 | âœ… | å®Œæˆ |
| è§’è‰²åˆ†é…æ–¹æ¡ˆ | 7 | âœ… | å®Œæˆ |
| è‡ªå‹•åŒ–ä»»å‹™ | 7 | âœ… | å®Œæˆ |
| **ç¸½è¨ˆ** | **37** | âœ… | **å®Œæˆ** |

---

## ğŸ”§ æŠ€è¡“å¯¦ç¾è¦é»

### æ¬Šé™æª¢æŸ¥æ–¹å¼

1. **ä¾è³´æ³¨å…¥**
   - ä½¿ç”¨ `Depends(get_current_active_user)` ç²å–ç•¶å‰ç”¨æˆ¶
   - ä½¿ç”¨ `Depends(get_db)` ç²å–æ•¸æ“šåº«æœƒè©±

2. **æ¬Šé™æª¢æŸ¥å‡½æ•¸**
   - ä½¿ç”¨ `check_permission(current_user, permission_code, db)` æª¢æŸ¥æ¬Šé™
   - å¦‚æœæ²’æœ‰æ¬Šé™ï¼Œè‡ªå‹•æ‹‹å‡º `HTTPException` (403 Forbidden)

3. **éŒ¯èª¤è™•ç†**
   - æ¬Šé™ä¸è¶³æ™‚è¿”å› 403 Forbidden
   - éŒ¯èª¤æ¶ˆæ¯æ˜ç¢ºèªªæ˜éœ€è¦çš„æ¬Šé™

### å¯¦ç¾æ¨¡å¼

```python
@router.post("/accounts")
async def create_account(
    request: AccountCreateRequest,
    current_user: User = Depends(get_current_active_user),
    service_manager: ServiceManager = Depends(get_service_manager),
    db: Session = Depends(get_db)
):
    """å‰µå»ºè³¬è™Ÿï¼ˆéœ€è¦ account:create æ¬Šé™ï¼‰"""
    check_permission(current_user, PermissionCode.ACCOUNT_CREATE.value, db)
    # ... å¯¦éš›æ¥­å‹™é‚è¼¯ ...
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### å¾Œç«¯ API èª¿ç”¨

**æœ‰æ¬Šé™çš„ç”¨æˆ¶**:
```bash
curl -X POST http://localhost:8000/api/v1/group-ai/accounts \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"account_id": "test", ...}'
# æˆåŠŸï¼š201 Created
```

**ç„¡æ¬Šé™çš„ç”¨æˆ¶**:
```bash
curl -X POST http://localhost:8000/api/v1/group-ai/accounts \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"account_id": "test", ...}'
# å¤±æ•—ï¼š403 Forbidden
# {
#   "detail": "æ²’æœ‰æ¬Šé™åŸ·è¡Œæ­¤æ“ä½œï¼Œéœ€è¦æ¬Šé™: account:create"
# }
```

---

## â³ å¾ŒçºŒå„ªåŒ–å»ºè­°

### é«˜å„ªå…ˆç´š

1. **å‰ç«¯æ¬Šé™æ§åˆ¶**
   - æ ¹æ“šç”¨æˆ¶æ¬Šé™é¡¯ç¤º/éš±è—åŠŸèƒ½æŒ‰éˆ•
   - æ ¹æ“šç”¨æˆ¶æ¬Šé™ç¦ç”¨åŠŸèƒ½
   - æ¬Šé™ä¸è¶³æ™‚é¡¯ç¤ºå‹å¥½æç¤º

2. **æ¬Šé™ç®¡ç†ç•Œé¢**
   - æ¬Šé™åˆ—è¡¨é é¢
   - è§’è‰²æ¬Šé™åˆ†é…ç•Œé¢
   - ç”¨æˆ¶æ¬Šé™æŸ¥çœ‹ç•Œé¢

### ä¸­å„ªå…ˆç´š

1. **æ¬Šé™ç·©å­˜**
   - ç·©å­˜ç”¨æˆ¶æ¬Šé™åˆ—è¡¨ï¼Œæ¸›å°‘æ•¸æ“šåº«æŸ¥è©¢
   - ä½¿ç”¨ Redis ç·©å­˜æ¬Šé™æª¢æŸ¥çµæœ

2. **æ¬Šé™å¯©è¨ˆ**
   - è¨˜éŒ„æ¬Šé™æª¢æŸ¥å¤±æ•—çš„æ—¥èªŒ
   - è¨˜éŒ„æ¬Šé™åˆ†é…/æ’¤éŠ·æ“ä½œ

---

## âœ… å®Œæˆç‹€æ…‹

- âœ… è³¬è™Ÿç®¡ç† APIï¼ˆ11å€‹ç«¯é»ï¼‰
- âœ… åŠ‡æœ¬ç®¡ç† APIï¼ˆ7å€‹ç«¯é»ï¼‰
- âœ… åŠ‡æœ¬å¯©æ ¸ APIï¼ˆ5å€‹ç«¯é»ï¼‰
- âœ… è§’è‰²åˆ†é…æ–¹æ¡ˆ APIï¼ˆ7å€‹ç«¯é»ï¼‰
- âœ… è‡ªå‹•åŒ–ä»»å‹™ APIï¼ˆ7å€‹ç«¯é»ï¼‰
- â³ å‰ç«¯æ¬Šé™æ§åˆ¶ï¼ˆå¾…å®Œæˆï¼‰
- â³ æ¬Šé™ç®¡ç†ç•Œé¢ï¼ˆå¾…å®Œæˆï¼‰

---

## ğŸ¯ ç¸½çµ

å·²ç‚ºæ‰€æœ‰ Group AI API ç«¯é»ï¼ˆ37å€‹ï¼‰æ·»åŠ æ¬Šé™æª¢æŸ¥ï¼Œç¢ºä¿ï¼š

1. **å®‰å…¨æ€§**: åªæœ‰å…·å‚™ç›¸æ‡‰æ¬Šé™çš„ç”¨æˆ¶æ‰èƒ½åŸ·è¡Œæ“ä½œ
2. **ä¸€è‡´æ€§**: æ‰€æœ‰ API ä½¿ç”¨çµ±ä¸€çš„æ¬Šé™æª¢æŸ¥æ–¹å¼
3. **å¯ç¶­è­·æ€§**: æ¸…æ™°çš„æ¬Šé™å®šç¾©å’Œæª¢æŸ¥é‚è¼¯

ç³»çµ±ç¾åœ¨æ”¯æŒï¼š
- âœ… ç´°åˆ†æ¬Šé™å®šç¾©ï¼ˆ61å€‹æ¬Šé™ä»£ç¢¼ï¼‰
- âœ… è§’è‰²æ¬Šé™ç®¡ç†
- âœ… ç”¨æˆ¶æ¬Šé™æª¢æŸ¥
- âœ… API æ¬Šé™ä¿è­·ï¼ˆ37å€‹ç«¯é»ï¼‰
- â³ å‰ç«¯æ¬Šé™æ§åˆ¶ï¼ˆå¾…å®Œæˆï¼‰

**ä¸‹ä¸€æ­¥**: å¯¦ç¾å‰ç«¯æ¬Šé™æ§åˆ¶ç•Œé¢å’Œæ¬Šé™ç®¡ç†ç•Œé¢ã€‚

---

**å ±å‘Šç”Ÿæˆæ™‚é–“**: 2025-01-17  
**åŠŸèƒ½ç‹€æ…‹**: âœ… åŸºç¤ç‰ˆæœ¬å®Œæˆ  
**API ç«¯é»**: âœ… 37å€‹ç«¯é»å·²æ·»åŠ æ¬Šé™æª¢æŸ¥

