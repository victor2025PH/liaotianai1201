# 测试开始指南

## 当前状态

### ✅ 已完成
1. **新的API端点代码已创建**
   - 文件：`admin-backend/app/api/group_ai/groups.py`
   - 端点：`POST /api/v1/group-ai/groups/send-test-message`
   - 功能：发送测试消息到群组并检测自动回复

2. **前端API客户端已更新**
   - 文件：`saas-demo/src/lib/api/group-ai.ts`
   - 添加了 `sendTestMessage()` 函数

3. **测试脚本已准备**
   - `验证新API端点.ps1` - 验证API端点是否加载
   - `测试按剧本聊天功能（完整版）.ps1` - 完整测试脚本

### ❌ 当前问题
- **新的API端点返回404**
- **后端服务需要重启以加载新的API端点**

## 必须操作：重启后端服务

### 步骤1：停止当前后端服务

1. **找到运行后端服务的终端窗口**
   - 在Cursor中查看所有终端标签页
   - 找到显示 `uvicorn` 或 `Starting backend server` 的终端

2. **停止服务**
   - 在该终端中按 `Ctrl+C`
   - 等待服务完全停止（看到提示符）

### 步骤2：重新启动后端服务

在停止服务的终端中运行：

```bash
cd admin-backend
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

**或者使用启动脚本**：
```bash
.\admin-backend\start_server.bat
```

### 步骤3：验证服务启动

等待看到以下信息：
```
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

## 验证和测试

### 步骤1：验证新API端点

重启后端服务后，运行：

```powershell
pwsh -File "验证新API端点.ps1"
```

**预期结果**：
- ✅ 如果看到 `✅ API端点已加载！`：成功，可以继续测试
- ❌ 如果看到 `❌ API端点不存在（404）`：需要检查后端日志

### 步骤2：运行完整测试

验证成功后，运行：

```powershell
pwsh -File "测试按剧本聊天功能（完整版）.ps1"
```

**测试脚本将自动**：
1. 登录获取token
2. 查找在线账号
3. 如果没有群组，自动创建群组
4. 发送测试消息（"你好"、"新人"、"欢迎"）
5. 检测账号是否按照剧本自动回复
6. 显示测试结果

## 测试预期结果

### 成功情况
- ✅ 测试消息发送成功
- ✅ 检测到账号自动回复
- ✅ 回复数增加
- ✅ 回复内容符合剧本设定

### 可能的问题

1. **未检测到回复**
   - 检查账号状态是否为 `online`
   - 检查账号是否在监听该群组
   - 检查剧本触发条件是否匹配
   - 检查账号配置（回复率、回复间隔）

2. **API端点返回404**
   - 确认后端服务已重启
   - 检查后端日志是否有错误
   - 验证 `groups.py` 文件是否正确

3. **认证失败**
   - 检查token是否有效
   - 确认登录信息正确

## 相关文件

- `admin-backend/app/api/group_ai/groups.py` - 后端API端点
- `saas-demo/src/lib/api/group-ai.ts` - 前端API客户端
- `验证新API端点.ps1` - 验证脚本
- `测试按剧本聊天功能（完整版）.ps1` - 完整测试脚本
- `问题分析和解决方案总结.md` - 详细技术分析

## 下一步

1. **重启后端服务**（必须）
2. **验证新API端点**
3. **运行完整测试**
4. **查看测试结果**

所有准备工作已完成，等待后端服务重启后即可开始测试！

