# 完整修复流程 - 502 和 401 错误

## 当前状态

✅ **502 Bad Gateway** - 已修复  
✅ **前端服务** - 正常运行 (端口 3000)  
✅ **后端服务** - 正常运行 (端口 8000)  
❌ **401 Unauthorized** - 需要登录

## 问题

页面可以加载，但所有API请求返回 401，因为缺少有效的JWT token。

## 完整修复步骤

### 步骤1：确保服务运行

```bash
# 检查后端
curl http://localhost:8000/health
# 应该返回: {"status":"ok"}

# 检查前端
curl http://localhost:3000
# 应该返回HTML内容
```

### 步骤2：获取登录Token

**在浏览器控制台执行** (F12):

```javascript
fetch('http://aikz.usdt2026.cc/api/v1/auth/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded',
  },
  body: new URLSearchParams({
    username: 'admin@example.com',
    password: 'changeme123'
  })
})
.then(res => res.json())
.then(data => {
  localStorage.setItem('access_token', data.access_token)
  console.log('✅ Token已保存！')
  location.reload()
})
.catch(err => {
  console.error('登录失败:', err)
})
```

### 步骤3：验证

刷新页面后，应该：
- ✅ 不再显示 401 错误
- ✅ API请求正常工作
- ✅ 可以正常分配剧本

## 或者访问登录页面

直接访问：
```
http://aikz.usdt2026.cc/login
```

使用默认账号登录：
- 邮箱: `admin@example.com`
- 密码: `changeme123`

## 默认管理员账号

- **邮箱**: `admin@example.com`
- **密码**: `changeme123`

## 如果登录失败

### 检查后端用户

```bash
cd ~/liaotian/admin-backend
source .venv/bin/activate
python3 << 'EOF'
from app.db import get_db
from app.crud.user import get_user_by_email, create_user
from app.schemas.user import UserCreate
from app.core.security import get_password_hash

db = next(get_db())
admin_email = 'admin@example.com'
user = get_user_by_email(db, admin_email)

if not user:
    print('创建管理员用户...')
    create_user(db, UserCreate(
        email=admin_email,
        password=get_password_hash('changeme123'),
        is_superuser=True,
        is_active=True
    ))
    print('✓ 用户已创建')
else:
    print(f'✓ 用户存在: {user.email}')
EOF
```

## 完成

登录成功后，所有功能应该正常工作！

---

**快速修复：在浏览器控制台执行登录代码即可！**
