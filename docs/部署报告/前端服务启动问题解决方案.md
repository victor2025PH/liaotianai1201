# 前端服务启动问题解决方案

## 问题描述

前端服务（Next.js）在后台任务中启动后，虽然日志显示 "Ready"，但端口 3000 无法访问，出现 `ERR_CONNECTION_REFUSED` 错误。

## 原因分析

1. **后台任务限制**: PowerShell 的 `Start-Job` 可能无法正确保持 Node.js 进程运行
2. **进程管理**: 后台任务中的进程可能在启动后立即退出
3. **端口绑定**: 服务可能启动失败，但日志没有显示错误

## 解决方案

### 方法 1: 使用批处理文件启动（推荐）

**优点**: 简单、可靠、独立窗口运行

1. 双击运行 `scripts\start_frontend.bat`
2. 会打开一个新的命令窗口
3. 等待看到 "Ready" 消息
4. 在浏览器中访问 http://localhost:3000

### 方法 2: 在新的 PowerShell 窗口中运行

**优点**: 可以查看实时日志

1. 打开新的 PowerShell 窗口
2. 运行以下命令：
   ```powershell
   cd 'E:\002-工作文件\重要程序\聊天AI群聊程序\saas-demo'
   npm run dev
   ```
3. 等待看到 "Ready" 消息
4. 在浏览器中访问 http://localhost:3000

### 方法 3: 在 Cursor 的新终端中运行

**优点**: 在开发环境中直接运行

1. 在 Cursor 中按 `Ctrl+`` 打开新终端
2. 运行：
   ```powershell
   cd saas-demo
   npm run dev
   ```
3. 等待看到 "Ready" 消息
4. 在浏览器中访问 http://localhost:3000

## 验证服务是否运行

### 检查端口监听

在 PowerShell 中运行：
```powershell
Get-NetTCPConnection -LocalPort 3000 -ErrorAction SilentlyContinue
```

如果返回结果，说明服务正在运行。

### 检查进程

在 PowerShell 中运行：
```powershell
Get-Process -Name "node" | Where-Object { $_.CommandLine -like "*next dev*" }
```

### 测试连接

在浏览器中访问：
- http://localhost:3000
- http://localhost:3000/group-ai/servers
- http://localhost:3000/group-ai/accounts

## 常见问题

### Q: 服务启动后立即退出

**A**: 检查是否有错误信息，常见原因：
- Node.js 版本不兼容
- 依赖包未安装（运行 `npm install`）
- 端口被占用（检查并停止占用进程）

### Q: 端口 3000 被占用

**A**: 停止占用端口的进程：
```powershell
# 查找占用端口的进程
$port = Get-NetTCPConnection -LocalPort 3000
$process = Get-Process -Id $port.OwningProcess
# 停止进程
Stop-Process -Id $process.Id -Force
```

### Q: 服务运行但无法访问

**A**: 检查：
1. 防火墙是否阻止了端口 3000
2. 浏览器是否使用了代理
3. 清除浏览器缓存并强制刷新（Ctrl+F5）

## 服务状态检查脚本

可以运行以下脚本检查服务状态：

```powershell
# 检查后端服务
$port8000 = Get-NetTCPConnection -LocalPort 8000 -ErrorAction SilentlyContinue
if ($port8000) {
    Write-Host "✓ 后端服务 (8000) 正常运行" -ForegroundColor Green
} else {
    Write-Host "✗ 后端服务 (8000) 未运行" -ForegroundColor Red
}

# 检查前端服务
$port3000 = Get-NetTCPConnection -LocalPort 3000 -ErrorAction SilentlyContinue
if ($port3000) {
    Write-Host "✓ 前端服务 (3000) 正常运行" -ForegroundColor Green
} else {
    Write-Host "✗ 前端服务 (3000) 未运行" -ForegroundColor Red
}
```

## 最佳实践

1. **使用独立窗口**: 推荐使用批处理文件或新窗口启动服务，便于查看日志和管理
2. **保持服务运行**: 不要关闭运行服务的窗口，直到不再需要服务
3. **定期检查**: 如果服务意外停止，使用检查脚本验证状态
4. **日志查看**: 如果出现问题，查看 `logs\frontend-*.log` 文件获取详细错误信息

