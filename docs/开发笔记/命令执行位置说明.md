# 命令执行位置说明

## 重要提示

**所有修复命令都需要在远程服务器上执行，而不是在本地Windows电脑上！**

## 执行位置

### ✅ 远程服务器
- **服务器地址**: `ubuntu@165.154.233.55`
- **服务器路径**: `~/liaotian/admin-backend`
- **后端服务端口**: `8000`
- **日志文件位置**: `/tmp/backend_final.log`

### ❌ 本地Windows电脑
- **本地路径**: `e:\002-工作文件\重要程序\聊天AI群聊程序`
- **注意**: 这些修复命令不应该在本地执行

## 如何连接远程服务器

### 方法1: 使用SSH（推荐）

从本地Windows PowerShell或CMD执行：

```powershell
ssh ubuntu@165.154.233.55
```

连接成功后，你会看到类似这样的提示：
```
Welcome to Ubuntu 24.04 LTS (GNU/Linux 6.8.0-31-generic x86_64)
...
ubuntu@10-56-130-4:~$
```

### 方法2: 使用一键执行脚本

我们已经创建了一个完整的脚本，可以直接执行：

```bash
# 在远程服务器上执行
bash ~/liaotian/deploy/404错误-修复步骤-远程服务器执行.sh
```

## 命令说明

### 1. 强制重启后端服务

**执行位置**: 远程服务器 `ubuntu@165.154.233.55`

```bash
# 先连接到远程服务器
ssh ubuntu@165.154.233.55

# 然后在远程服务器上执行以下命令
cd ~/liaotian/admin-backend
source .venv/bin/activate
pkill -9 -f 'uvicorn.*app.main:app'
sleep 3
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload > /tmp/backend_final.log 2>&1 &
sleep 5
curl http://localhost:8000/health
```

### 2. 测试PUT请求

**执行位置**: 远程服务器 `ubuntu@165.154.233.55`

```bash
# 在远程服务器上执行
TOKEN=$(curl -s -X POST 'http://localhost:8000/api/v1/auth/login' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -d 'username=admin@example.com&password=changeme123' | \
  python3 -c 'import sys, json; print(json.load(sys.stdin)["access_token"])')

curl -X PUT "http://localhost:8000/api/v1/group-ai/accounts/639277358115" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"script_id":"test-script","server_id":"computer_001"}' \
  -v
```

### 3. 查看日志

**执行位置**: 远程服务器 `ubuntu@165.154.233.55`

```bash
# 在远程服务器上执行
tail -100 /tmp/backend_final.log | grep -E "UPDATE_ACCOUNT|MIDDLEWARE|PUT|404|639277358115"
```

## 如何确认你在正确的位置

### 检查1: 查看当前目录

```bash
pwd
```

如果显示 `/home/ubuntu/liaotian/admin-backend`，说明你在正确的位置。

### 检查2: 查看服务器IP

```bash
hostname -I
```

如果显示 `10.56.130.4` 或包含 `165.154.233.55`，说明你在远程服务器上。

### 检查3: 查看后端服务

```bash
ps aux | grep uvicorn
```

如果能看到 `uvicorn app.main:app` 进程，说明后端服务正在运行。

## 常见错误

### 错误1: "cd: no such file or directory"

**原因**: 在本地Windows电脑上执行了命令

**解决**: 先通过SSH连接到远程服务器，然后再执行命令

### 错误2: "command not found: uvicorn"

**原因**: 没有激活Python虚拟环境

**解决**: 执行 `source .venv/bin/activate` 激活虚拟环境

### 错误3: "Connection refused" 或 "无法连接"

**原因**: 后端服务没有运行

**解决**: 先启动后端服务

## 快速参考

| 操作 | 执行位置 | 命令 |
|------|---------|------|
| 连接服务器 | 本地Windows | `ssh ubuntu@165.154.233.55` |
| 重启后端 | 远程服务器 | `bash ~/liaotian/deploy/404错误-修复步骤-远程服务器执行.sh` |
| 查看日志 | 远程服务器 | `tail -f /tmp/backend_final.log` |
| 测试API | 远程服务器 | `curl http://localhost:8000/health` |

---

**记住**: 所有后端相关的命令都在远程服务器 `ubuntu@165.154.233.55` 上执行！
