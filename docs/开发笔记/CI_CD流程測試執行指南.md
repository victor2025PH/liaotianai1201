# CI/CD 流程測試執行指南

> **日期**: 2025-11-30  
> **目標**: 測試新完善的 CI/CD 流程

---

## ✅ 配置驗證完成

### 已驗證的工作流文件（11個）

| # | 工作流文件 | 狀態 | 說明 |
|---|-----------|------|------|
| 1 | `ci.yml` | ✅ | 主 CI 工作流 |
| 2 | `test-coverage.yml` | ✅ | 測試覆蓋率 |
| 3 | `code-quality.yml` | ✅ | 代碼質量檢查 |
| 4 | `deploy.yml` | ✅ | 部署工作流 |
| 5 | `release.yml` | ✅ | 發布流程 |
| 6 | `notification.yml` | ✅ | **新增** - 通知機制 |
| 7 | `performance-test.yml` | ✅ | **新增** - 性能測試 |
| 8 | `lint-and-fix.yml` | ✅ | **新增** - 自動修復 |
| 9 | `dependency-review.yml` | ✅ | 依賴審查 |
| 10 | `docker-compose-deploy.yml` | ✅ | Docker Compose 部署 |
| 11 | `group-ai-ci.yml` | ✅ | Group AI CI |

**配置狀態**: ✅ **全部驗證通過**

---

## 🚀 快速測試方法

### 方法 1: 創建測試提交（推薦）⭐

這是最簡單的方法，會自動觸發所有相關的 CI 工作流。

#### 步驟 1: 創建測試分支

```bash
cd "e:\002-工作文件\重要程序\聊天AI群聊程序"
git checkout -b test/cicd-validation-$(date +%Y%m%d)
```

#### 步驟 2: 做一個小的代碼變更

```bash
# 添加一個測試文件
echo "# CI/CD 測試 - $(date)" >> test-cicd.md

# 或者修改現有文件（添加註釋）
# 在 README.md 中添加一行註釋
```

#### 步驟 3: 提交並推送

```bash
git add .
git commit -m "test: CI/CD 流程驗證測試"
git push origin test/cicd-validation-$(date +%Y%m%d)
```

#### 步驟 4: 查看結果

1. **訪問 GitHub**
   - 打開 GitHub 倉庫頁面
   - 點擊 "Actions" 標籤

2. **查看工作流運行**
   - 找到 "CI" 工作流
   - 點擊查看運行詳情
   - 等待完成（約 5-10 分鐘）

3. **檢查結果**
   - ✅ 所有任務應該顯示綠色 ✓
   - ✅ 查看 "綜合檢查" job 的報告
   - ✅ 下載覆蓋率報告（如果有）

---

### 方法 2: 手動觸發工作流

如果不想提交代碼，可以手動觸發：

#### 手動觸發測試覆蓋率工作流

1. 訪問 GitHub 倉庫
2. 點擊 "Actions" 標籤
3. 在左側選擇 "Test Coverage" 工作流
4. 點擊 "Run workflow" 按鈕
5. 選擇分支（main 或 develop）
6. 點擊綠色的 "Run workflow" 按鈕

#### 手動觸發性能測試工作流

1. 訪問 GitHub Actions 頁面
2. 選擇 "性能測試" 工作流
3. 點擊 "Run workflow"
4. 選擇分支並運行

---

## 📊 驗證檢查清單

### 需要驗證的功能

#### 1. 測試覆蓋率閾值檢查 ✅

**要驗證**:
- [ ] CI 工作流包含覆蓋率檢查步驟
- [ ] 覆蓋率 < 70% 時 CI 失敗
- [ ] 覆蓋率 >= 70% 時 CI 通過

**查看位置**:
- GitHub Actions → CI 工作流 → "後端測試" job → "檢查覆蓋率閾值" 步驟

---

#### 2. 綜合檢查報告 ✅

**要驗證**:
- [ ] "綜合檢查" job 運行
- [ ] 生成詳細報告
- [ ] GitHub Actions 摘要中顯示結果

**查看位置**:
- GitHub Actions → CI 工作流 → "綜合檢查" job → "生成 CI 報告" 步驟
- 點擊工作流運行頁面的 "Summary" 標籤

---

#### 3. 通知機制 ✅

**要驗證**:
- [ ] CI 工作流完成後觸發通知工作流
- [ ] 通知消息生成（如果配置了實際通知）

**查看位置**:
- GitHub Actions → "CI/CD 通知" 工作流

---

#### 4. 自動修復功能 ✅

**測試方法**:
1. 創建一個 Pull Request
2. 在代碼中添加格式問題（例如：多餘空格）
3. 觀察 `lint-and-fix` 工作流是否自動運行
4. 檢查是否有自動提交的修復

---

## 🔍 查看測試結果

### 在 GitHub Actions 頁面查看

1. **訪問工作流運行頁面**
   ```
   https://github.com/<你的用戶名>/<倉庫名>/actions
   ```

2. **查看具體工作流**
   - 點擊工作流名稱（如 "CI"）
   - 點擊最新的運行
   - 查看每個 job 的狀態

3. **查看詳細日誌**
   - 點擊失敗的 job
   - 展開失敗的步驟
   - 查看錯誤日誌

### 下載報告和產物

1. **覆蓋率報告**
   - 在 "後端測試" job 底部
   - 找到 "上傳覆蓋率報告（HTML）" artifact
   - 點擊下載

2. **測試結果**
   - 在 "前端 E2E 測試" job 底部
   - 找到 "playwright-report" artifact
   - 下載並查看

---

## ✅ 預期結果

### 成功的標誌

當 CI/CD 流程正常工作時：

1. **所有檢查通過**
   - ✅ 後端代碼檢查 - 通過
   - ✅ 後端測試 - 通過（覆蓋率 >= 70%）
   - ✅ 前端代碼檢查 - 通過
   - ✅ 前端構建 - 通過
   - ✅ 綜合檢查 - 通過

2. **報告生成**
   - ✅ 覆蓋率報告可供下載
   - ✅ GitHub Actions 摘要中有詳細報告

3. **工作流完整運行**
   - ✅ 所有 job 完成
   - ✅ 沒有錯誤

---

## ❌ 問題排查

### 如果 CI 失敗

1. **查看失敗的 job**
   - 點擊紅色 × 標記的 job
   - 查看錯誤日誌

2. **常見問題**:
   - **覆蓋率不足**: 添加更多測試用例
   - **代碼格式問題**: 運行 `black` 和 `ruff` 修復
   - **依賴問題**: 檢查 `requirements.txt` 和 `package.json`

3. **修復後重新測試**:
   ```bash
   git add .
   git commit -m "fix: 修復 CI 問題"
   git push
   ```

---

## 📝 測試記錄模板

```
測試日期: ___________
測試人員: ___________
測試方式: [提交代碼 / 手動觸發 / PR]

測試結果:
  - CI 工作流: ✅ / ❌
  - 覆蓋率檢查: ✅ / ❌
  - 綜合檢查: ✅ / ❌
  - 通知工作流: ✅ / ❌
  - 自動修復: ✅ / ❌

發現的問題:
  - 問題1: ...
  - 問題2: ...

下一步:
  - ...
```

---

## 🎯 立即開始測試

### 快速命令

```bash
# 在項目根目錄執行
cd "e:\002-工作文件\重要程序\聊天AI群聊程序"

# 創建測試分支
git checkout -b test/cicd-$(date +%Y%m%d-%H%M%S)

# 做一個小的變更
echo "# CI/CD 測試 - $(date)" >> test-cicd.md

# 提交並推送
git add test-cicd.md
git commit -m "test: CI/CD 流程驗證"
git push origin test/cicd-$(date +%Y%m%d-%H%M%S)

# 然後訪問 GitHub Actions 頁面查看結果
```

---

**準備好開始測試了！** 🚀

**測試方法**: 創建測試提交或手動觸發工作流  
**查看結果**: GitHub Actions 頁面
