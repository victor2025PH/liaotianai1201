# 修复节点统计逻辑说明

## 问题描述

用户报告节点管理页面统计数据显示不正确：
- 总资产显示"2"但"0在线"
- 本地电脑显示"0"但"0在线"
- 但节点列表中显示"计算机_001"和"计算机_002"都是"在线"状态

## 问题原因

1. **节点识别逻辑不完善**：原代码只检查`!id.startsWith("server_")`，但节点ID可能是"计算机_001"、"computer_001"等格式
2. **统计逻辑不准确**：在线节点数量计算可能有问题
3. **文本显示不一致**：代码中显示"總节点"，但用户看到的是"总资产"

## 修复内容

### 1. 改进节点识别逻辑

```typescript
// 识别本地电脑：不是以"server_"开头的都是本地电脑
// 包括：computer_xxx, 计算机_xxx, computer-xxx 等格式
const localNodes = workerList.filter(([id]) => {
  const lowerId = id.toLowerCase()
  return !lowerId.startsWith("server_") && !lowerId.startsWith("server-")
})
```

### 2. 优化统计计算

```typescript
const onlineNodes = workerList.filter(([, w]) => w.status === "online").length
const onlineLocalNodes = localNodes.filter(([, w]) => w.status === "online").length
const onlineServerNodes = serverNodes.filter(([, w]) => w.status === "online").length
const onlineAccounts = workerList.reduce((sum, [, w]) => {
  if (w.status === "online" && w.accounts) {
    return sum + w.accounts.filter((acc: any) => acc.status === "online").length
  }
  return sum
}, 0)
```

### 3. 使用i18n翻译

- 将硬编码的文本替换为i18n翻译
- 添加"总资产"翻译以兼容旧版本显示

### 4. 改进账号统计显示

- 显示在线账号数量：`{onlineAccounts} 在线 / 分布 {onlineNodes} 节点`

## 修复后的效果

- ✅ 正确识别本地电脑（包括"计算机_001"、"computer_001"等格式）
- ✅ 正确统计在线节点数量
- ✅ 正确统计在线账号数量
- ✅ 使用i18n翻译，支持多语言

## 部署步骤

1. 上传修改后的文件到服务器
2. 重新构建前端
3. 重启前端服务
4. 验证统计数据显示是否正确

