# 401 è®¤è¯ä¿®å¤æˆåŠŸæŠ¥å‘Š

## âœ… ä¿®å¤çŠ¶æ€ï¼šæˆåŠŸ

### ä¿®å¤æ‰§è¡Œç»“æœ

1. **CORS é…ç½®å·²åˆ›å»º**
   ```
   CORS_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:5173,http://localhost:8080,http://aikz.usdt2026.cc
   ```
   âœ… é…ç½®æ–‡ä»¶ä½ç½®ï¼š`/home/ubuntu/admin-backend/.env`
   âœ… åŒ…å«ç”Ÿäº§åŸŸåï¼š`http://aikz.usdt2026.cc`

2. **åç«¯æœåŠ¡å·²é‡å¯**
   ```
   â— liaotian-backend.service - Liaotian Backend API
      Loaded: loaded (/etc/systemd/system/liaotian-backend.service; enabled; preset: enabled)
      Active: active (running) since Fri 2025-11-28 06:22:10 PST
   ```
   âœ… æœåŠ¡çŠ¶æ€ï¼š`active (running)`
   âœ… è¿›ç¨‹ IDï¼š190773
   âœ… ç›‘å¬ç«¯å£ï¼š8000

3. **ç™»å½• API æµ‹è¯•æˆåŠŸ**
   ```json
   {
     "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
     "token_type": "bearer"
   }
   ```
   âœ… API æ­£å¸¸å·¥ä½œ
   âœ… è¿”å›æœ‰æ•ˆçš„ JWT token

## ğŸ¯ ä¸‹ä¸€æ­¥ï¼šæµè§ˆå™¨ç«¯éªŒè¯

### æ­¥éª¤ 1ï¼šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶é‡æ–°ç™»å½•

1. **æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·**ï¼ˆF12ï¼‰
2. **æ¸…é™¤ localStorage**ï¼ˆå¯é€‰ï¼‰ï¼š
   ```javascript
   localStorage.clear()
   ```
3. **è®¿é—®ç™»å½•é¡µé¢**ï¼š
   ```
   http://aikz.usdt2026.cc/login
   ```
4. **ä½¿ç”¨é»˜è®¤è´¦å·ç™»å½•**ï¼š
   - é‚®ç®±ï¼š`admin@example.com`
   - å¯†ç ï¼š`changeme123`

### æ­¥éª¤ 2ï¼šéªŒè¯ API è¯·æ±‚

1. **è®¿é—®è´¦å·ç®¡ç†é¡µé¢**ï¼š
   ```
   http://aikz.usdt2026.cc/group-ai/accounts
   ```

2. **æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°**ï¼ˆF12 â†’ Consoleï¼‰ï¼š
   - âœ… åº”è¯¥æ²¡æœ‰ 401 é”™è¯¯
   - âœ… API è¯·æ±‚åº”è¯¥è¿”å› 200
   - âœ… åº”è¯¥èƒ½çœ‹åˆ°æ•°æ®åŠ è½½

3. **æ£€æŸ¥ç½‘ç»œè¯·æ±‚**ï¼ˆF12 â†’ Networkï¼‰ï¼š
   - æ‰¾åˆ° `/api/v1/group-ai/accounts` è¯·æ±‚
   - **Request Headers** åº”è¯¥åŒ…å«ï¼š
     ```
     Authorization: Bearer <token>
     ```
   - **Response** åº”è¯¥æ˜¯ 200ï¼Œè¿”å› JSON æ•°æ®ï¼ˆä¸æ˜¯ HTMLï¼‰

### æ­¥éª¤ 3ï¼šéªŒè¯æ•°æ®åŠ è½½

- âœ… é¡µé¢åº”è¯¥æ­£å¸¸æ˜¾ç¤º
- âœ… è´¦å·åˆ—è¡¨åº”è¯¥èƒ½åŠ è½½ï¼ˆä¸æ˜¯å…¨ 0ï¼‰
- âœ… æŒ‡æ ‡å¡ç‰‡åº”è¯¥æ˜¾ç¤ºå®é™…æ•°æ®ï¼ˆä¸æ˜¯å…¨ 0ï¼‰

## ğŸ” å¦‚æœä»æœ‰é—®é¢˜

### æ£€æŸ¥åç«¯æ—¥å¿—

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
sudo journalctl -u liaotian-backend -n 50 | grep -i "cors\|401\|unauthorized"

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u liaotian-backend -f
```

### æ£€æŸ¥ CORS é…ç½®æ˜¯å¦ç”Ÿæ•ˆ

```bash
# æ£€æŸ¥é…ç½®
sudo grep CORS_ORIGINS /home/ubuntu/admin-backend/.env

# æ£€æŸ¥åç«¯æ˜¯å¦è¯»å–äº†é…ç½®
sudo journalctl -u liaotian-backend -n 100 | grep -i cors
```

### æµ‹è¯•å¸¦ token çš„ API è¯·æ±‚

```bash
# 1. å…ˆè·å– token
TOKEN=$(curl -s -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin@example.com&password=changeme123" | jq -r '.access_token')

# 2. ä½¿ç”¨ token æµ‹è¯• API
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8000/api/v1/group-ai/accounts?page_size=10
```

## ğŸ“Š ä¿®å¤æ€»ç»“

### é—®é¢˜åŸå› 
- **CORS é…ç½®ç¼ºå¤±**ï¼šåç«¯ CORS é…ç½®ä¸­æ²¡æœ‰åŒ…å«ç”Ÿäº§åŸŸå `http://aikz.usdt2026.cc`
- **é…ç½®æ–‡ä»¶è·¯å¾„**ï¼šsystemd é…ç½®çš„ `.env` æ–‡ä»¶ä¸å­˜åœ¨

### ä¿®å¤æ–¹æ¡ˆ
1. âœ… åˆ›å»º `/home/ubuntu/admin-backend/.env` æ–‡ä»¶
2. âœ… æ·»åŠ  `CORS_ORIGINS` é…ç½®ï¼ŒåŒ…å«ç”Ÿäº§åŸŸå
3. âœ… é‡å¯ `liaotian-backend` æœåŠ¡

### ä¿®å¤ç»“æœ
- âœ… CORS é…ç½®å·²æ­£ç¡®è®¾ç½®
- âœ… åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- âœ… ç™»å½• API æµ‹è¯•æˆåŠŸ
- âœ… è¿”å›æœ‰æ•ˆçš„ JWT token

## ğŸ‰ é¢„æœŸç»“æœ

ä¿®å¤åï¼Œæµè§ˆå™¨è®¿é—®åº”è¯¥ï¼š
- âœ… ä¸å†å‡ºç° 401 Unauthorized é”™è¯¯
- âœ… API è¯·æ±‚è¿”å› 200 å’Œ JSON æ•°æ®
- âœ… é¡µé¢æ•°æ®æ­£å¸¸æ˜¾ç¤º
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å¦‚æœæµè§ˆå™¨ä»æ˜¾ç¤º 401**ï¼š
   - æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
   - é‡æ–°ç™»å½•è·å–æ–°çš„ token
   - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

2. **å¦‚æœæ•°æ®ä»æ˜¾ç¤ºä¸º 0**ï¼š
   - æ£€æŸ¥æ˜¯å¦æœ‰å®é™…çš„è´¦å·æ•°æ®
   - æ£€æŸ¥æƒé™é…ç½®
   - æŸ¥çœ‹åç«¯æ—¥å¿—æ˜¯å¦æœ‰å…¶ä»–é”™è¯¯

3. **WebSocket è¿æ¥é—®é¢˜**ï¼š
   - è¿™æ˜¯å¦ä¸€ä¸ªé—®é¢˜ï¼Œä¸å½±å“ API è¯·æ±‚
   - å¦‚æœéœ€è¦ä¿®å¤ WebSocketï¼Œå¯ä»¥å•ç‹¬å¤„ç†

