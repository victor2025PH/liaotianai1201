# 服务重启执行报告

## 执行时间
2025-01-28

## 执行步骤

### 1. 停止所有进程
✅ 已执行：
```bash
pkill -f 'next.*dev|node.*3000|uvicorn.*8000|python.*uvicorn'
```

### 2. 清理端口占用
✅ 已执行：
```bash
# 清理端口3000
sudo lsof -i :3000 | grep LISTEN | awk '{print $2}' | xargs kill -9

# 清理端口8000
sudo lsof -i :8000 | grep LISTEN | awk '{print $2}' | xargs kill -9
```

### 3. 启动后端服务
✅ 已执行：
```bash
cd ~/liaotian/admin-backend
source .venv/bin/activate
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 > /tmp/backend_restart.log 2>&1 &
```

**日志位置**: `/tmp/backend_restart.log`

### 4. 启动前端服务
✅ 已执行：
```bash
cd ~/liaotian/saas-demo
nohup npm run dev > /tmp/frontend_restart.log 2>&1 &
```

**日志位置**: `/tmp/frontend_restart.log`

### 5. 重载 Nginx
✅ 已执行：
```bash
sudo systemctl reload nginx
```

## 验证命令

### 检查进程状态
```bash
ps aux | grep -E 'next.*dev|uvicorn.*8000' | grep -v grep
```

### 检查端口监听
```bash
sudo ss -tlnp | grep -E '3000|8000'
```

### 检查 HTTP 状态
```bash
# 后端健康检查
curl http://localhost:8000/health

# 前端访问
curl http://localhost:3000

# 域名访问
curl http://aikz.usdt2026.cc/group-ai/accounts
```

### 查看启动日志
```bash
# 后端日志
tail -f /tmp/backend_restart.log

# 前端日志
tail -f /tmp/frontend_restart.log
```

## 服务状态

由于 SSH 输出缓冲限制，无法实时看到服务状态。建议在服务器上手动验证：

```bash
ssh ubuntu@165.154.233.55

# 验证进程
ps aux | grep -E 'next|uvicorn'

# 验证端口
sudo ss -tlnp | grep -E '3000|8000'

# 验证 HTTP
curl -I http://localhost:8000/health
curl -I http://localhost:3000
curl -I http://aikz.usdt2026.cc/group-ai/accounts
```

## 如果服务未正常启动

### 后端问题排查
1. 查看后端日志：`tail -50 /tmp/backend_restart.log`
2. 检查虚拟环境：`source ~/liaotian/admin-backend/.venv/bin/activate`
3. 手动启动：`uvicorn app.main:app --host 0.0.0.0 --port 8000`

### 前端问题排查
1. 查看前端日志：`tail -50 /tmp/frontend_restart.log`
2. 检查依赖：`cd ~/liaotian/saas-demo && ls -la node_modules/.bin/next`
3. 手动启动：`npm run dev`

## 快速重启脚本

可以在服务器上创建快速重启脚本：

```bash
cd ~/liaotian
cat > restart_services.sh << 'EOF'
#!/bin/bash
# 停止所有服务
pkill -f 'next.*dev|node.*3000|uvicorn.*8000' || true
sleep 2

# 清理端口
sudo lsof -i :3000 2>/dev/null | grep LISTEN | awk '{print $2}' | xargs kill -9 2>/dev/null || true
sudo lsof -i :8000 2>/dev/null | grep LISTEN | awk '{print $2}' | xargs kill -9 2>/dev/null || true
sleep 2

# 启动后端
cd ~/liaotian/admin-backend
source .venv/bin/activate
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 > /tmp/backend.log 2>&1 &
echo "后端已启动"

# 启动前端
cd ~/liaotian/saas-demo
nohup npm run dev > /tmp/frontend.log 2>&1 &
echo "前端已启动"

# 重载 Nginx
sudo systemctl reload nginx
echo "Nginx 已重载"

sleep 5
echo "服务重启完成"
EOF

chmod +x restart_services.sh
```

## 总结

所有服务重启步骤已执行完成。建议等待1-2分钟后手动验证服务状态。
