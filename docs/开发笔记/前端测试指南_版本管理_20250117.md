# 前端版本管理功能測試指南

> **日期**: 2025-01-17  
> **功能**: 劇本版本管理系統前端測試

---

## 📋 測試環境

- **前端服務**: http://localhost:3000
- **後端服務**: http://localhost:8000
- **測試頁面**: http://localhost:3000/group-ai/scripts

---

## 🔍 測試前準備

### 1. 確認服務運行狀態

```bash
# 檢查前端服務
curl http://localhost:3000

# 檢查後端服務
curl http://localhost:8000/health
```

### 2. 準備測試數據

由於目前暫時移除了後端認證，前端應該可以直接訪問API。

**注意**: 如果前端API調用失敗（401錯誤），可能需要：
1. 暫時移除前端的認證要求
2. 或者添加一個測試token到localStorage

---

## 🧪 測試步驟

### 測試 1: 訪問劇本管理頁面

1. **打開瀏覽器**訪問：http://localhost:3000/group-ai/scripts
2. **預期結果**：
   - 頁面正常加載
   - 劇本列表顯示（可能為空）
   - 沒有JavaScript錯誤

### 測試 2: 查看版本歷史按鈕

1. **確認按鈕存在**：
   - 在劇本列表中，每個劇本行應該有「版本」按鈕
   - 按鈕圖標：`History` 圖標
2. **預期結果**：
   - 按鈕可見且可點擊
   - 點擊後打開版本歷史對話框

### 測試 3: 版本歷史對話框

1. **點擊「版本」按鈕**（如果有測試劇本）
2. **預期結果**：
   - 對話框打開
   - 顯示劇本ID
   - 顯示版本對比工具（兩個下拉選擇框 + 對比按鈕）
   - 顯示版本列表

### 測試 4: 獲取版本列表

1. **打開版本歷史對話框**
2. **預期結果**：
   - 顯示加載狀態（如果正在加載）
   - 版本列表正確顯示
   - 每個版本顯示：
     - 版本號（badge）
     - 創建時間
     - 變更說明（如果有）
     - 描述（如果有）
     - 創建者（如果有）
     - 「查看詳情」和「恢復」按鈕

### 測試 5: 版本對比功能

1. **選擇兩個版本**：
   - 在「版本 1」下拉框選擇一個版本（例如：1.0）
   - 在「版本 2」下拉框選擇另一個版本（例如：1.1）
2. **點擊「對比版本」按鈕**
3. **預期結果**：
   - 打開版本對比對話框
   - 顯示兩個版本的詳細信息
   - 顯示差異列表（例如："YAML內容已變更"）

### 測試 6: 查看版本詳情

1. **點擊版本列表中的「查看詳情」按鈕**
2. **預期結果**：
   - 打開版本詳情對話框
   - 顯示版本基本信息（版本號、創建時間、變更說明）
   - 顯示完整的YAML內容（只讀文本框）

### 測試 7: 版本恢復功能

1. **點擊版本列表中的「恢復」按鈕**
2. **預期結果**：
   - 顯示確認對話框
   - 確認後執行恢復操作
   - 顯示成功提示
   - 版本歷史列表刷新

---

## 🔧 如果遇到問題

### 問題 1: API 調用返回 401 錯誤

**原因**: 前端API調用未包含認證頭，而後端需要認證

**解決方案**:

#### 方案 A: 暫時禁用前端認證檢查（僅用於測試）

在前端API函數中添加錯誤處理，忽略401錯誤：

```typescript
// saas-demo/src/lib/api/group-ai.ts
export async function listScriptVersions(...) {
  try {
    const response = await fetch(`${API_BASE}/scripts/${scriptId}/versions?${params}`)
    if (!response.ok) {
      // 如果是401錯誤，可能是認證問題，暫時允許
      if (response.status === 401) {
        console.warn('認證錯誤，但繼續執行（測試模式）')
        // 可以返回空數組或繼續執行
      }
      const error = await response.json()
      throw new Error(error.detail || `HTTP ${response.status}`)
    }
    return response.json()
  } catch (error) {
    console.error('API調用失敗:', error)
    throw error
  }
}
```

#### 方案 B: 添加測試Token

如果後端仍需要認證，可以手動添加token到localStorage：

```javascript
// 在瀏覽器控制台執行
localStorage.setItem('auth_token', 'your_test_token_here')
```

然後修改API函數自動添加認證頭：

```typescript
export async function listScriptVersions(...) {
  const token = localStorage.getItem('auth_token')
  const headers: HeadersInit = {
    'Content-Type': 'application/json',
  }
  if (token) {
    headers['Authorization'] = `Bearer ${token}`
  }
  
  const response = await fetch(`${API_BASE}/scripts/${scriptId}/versions?${params}`, {
    headers,
  })
  // ...
}
```

### 問題 2: 版本列表為空

**原因**: 測試劇本沒有版本歷史記錄

**解決方案**:
1. 創建一個新劇本
2. 更新該劇本（修改版本號或內容）
3. 這樣會自動創建版本歷史記錄

### 問題 3: 版本對比無法打開

**可能原因**:
- 路由匹配問題（已修復，但需確認後端服務重新加載）
- API調用失敗

**解決方案**:
1. 檢查瀏覽器控制台錯誤
2. 確認後端服務已重新加載最新代碼
3. 檢查API響應是否正確

---

## 📝 測試檢查清單

- [ ] 前端頁面正常加載
- [ ] 版本歷史按鈕可見且可點擊
- [ ] 版本歷史對話框正常打開
- [ ] 版本列表正確加載和顯示
- [ ] 版本對比功能正常工作
- [ ] 版本詳情對話框正常顯示
- [ ] 版本恢復功能正常工作
- [ ] 錯誤處理正確（顯示友好的錯誤提示）
- [ ] 加載狀態正確顯示
- [ ] UI樣式正常（無佈局問題）

---

## 🎯 測試重點

### 1. 用戶體驗
- 操作流程是否順暢
- 錯誤提示是否友好
- 加載狀態是否清晰

### 2. 功能完整性
- 所有功能是否可用
- 數據顯示是否正確
- 操作結果是否符合預期

### 3. 錯誤處理
- API錯誤是否正確處理
- 網絡錯誤是否有友好提示
- 異常情況是否不會導致頁面崩潰

---

## ✅ 預期測試結果

### 成功場景

1. **查看版本歷史**：
   - 點擊「版本」按鈕 → 對話框打開 → 版本列表顯示

2. **版本對比**：
   - 選擇兩個版本 → 點擊對比 → 顯示對比結果

3. **查看版本詳情**：
   - 點擊「查看詳情」 → 顯示版本完整信息

4. **恢復版本**：
   - 點擊「恢復」 → 確認 → 成功提示 → 列表刷新

### 異常場景

1. **無版本歷史**：
   - 顯示「暫無版本歷史」提示

2. **API調用失敗**：
   - 顯示錯誤對話框，不影響其他功能

3. **網絡錯誤**：
   - 顯示友好錯誤提示

---

**測試時間**: 2025-01-17  
**測試人員**: 待完成  
**狀態**: ⏳ 待測試

