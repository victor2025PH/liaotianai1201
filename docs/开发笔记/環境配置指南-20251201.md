# ç’°å¢ƒé…ç½®æŒ‡å—

> **æ—¥æœŸ**: 2025-12-01  
> **ç›®æ¨™**: é…ç½®å¿…è¦çš„ç’°å¢ƒè®Šé‡

---

## ğŸ“‹ ç’°å¢ƒè®Šé‡åˆ†é¡

### 1. å¾Œç«¯æœå‹™ï¼ˆadmin-backendï¼‰ç’°å¢ƒè®Šé‡

é€™äº›è®Šé‡é€šé `app/core/config.py` çš„ `Settings` é¡è®€å–ã€‚

#### å¿…å¡«ç’°å¢ƒè®Šé‡

| è®Šé‡å | èªªæ˜ | é»˜èªå€¼ | å‚™è¨» |
|--------|------|--------|------|
| `JWT_SECRET` | JWT ç°½åå¯†é‘° | `change_me` | âš ï¸ **ç”Ÿç”¢ç’°å¢ƒå¿…é ˆä¿®æ”¹ï¼** |
| `ADMIN_DEFAULT_PASSWORD` | ç®¡ç†å“¡é»˜èªå¯†ç¢¼ | `changeme123` | âš ï¸ **ç”Ÿç”¢ç’°å¢ƒå¿…é ˆä¿®æ”¹ï¼** |

#### å¯é¸ç’°å¢ƒè®Šé‡ï¼ˆæœ‰é»˜èªå€¼ï¼‰

| è®Šé‡å | èªªæ˜ | é»˜èªå€¼ |
|--------|------|--------|
| `DATABASE_URL` | æ•¸æ“šåº«é€£æ¥ URL | `sqlite:///./admin.db` |
| `REDIS_URL` | Redis é€£æ¥ URL | `redis://localhost:6379/0` |
| `JWT_ALGORITHM` | JWT ç®—æ³• | `HS256` |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | Token éæœŸæ™‚é–“ï¼ˆåˆ†é˜ï¼‰ | `60` |
| `ADMIN_DEFAULT_EMAIL` | ç®¡ç†å“¡é»˜èªéƒµç®± | `admin@example.com` |
| `CORS_ORIGINS` | CORS å…è¨±çš„æº | `http://localhost:3000,...` |

#### å¯é¸ç’°å¢ƒè®Šé‡ï¼ˆåŠŸèƒ½ç›¸é—œï¼‰

| è®Šé‡å | èªªæ˜ | é»˜èªå€¼ |
|--------|------|--------|
| `TELEGRAM_BOT_TOKEN` | Telegram Bot Tokenï¼ˆç”¨æ–¼ç™¼é€é€šçŸ¥ï¼‰ | `""` |
| `TELEGRAM_CHAT_ID` | Telegram Chat IDï¼ˆç”¨æ–¼æ¥æ”¶å‘Šè­¦é€šçŸ¥ï¼‰ | `""` |
| `DISABLE_AUTH` | æ˜¯å¦ç¦ç”¨èªè­‰ï¼ˆåƒ…é–‹ç™¼/æ¸¬è©¦ï¼‰ | `false` |
| `DEBUG_AUTH_LOGS` | æ˜¯å¦å•Ÿç”¨èªè­‰èª¿è©¦æ—¥èªŒ | `false` |

### 2. AI æœå‹™ï¼ˆgroup_ai_serviceï¼‰ç’°å¢ƒè®Šé‡

é€™äº›è®Šé‡å¾é …ç›®æ ¹ç›®éŒ„çš„ `.env` æ–‡ä»¶è®€å–ï¼ˆé€šé `config.py`ï¼‰ã€‚

#### å¿…å¡«ç’°å¢ƒè®Šé‡

| è®Šé‡å | èªªæ˜ | ç²å–æ–¹å¼ |
|--------|------|----------|
| `TELEGRAM_API_ID` | Telegram é–‹ç™¼è€… API IDï¼ˆæ•´å‹ï¼‰ | https://my.telegram.org |
| `TELEGRAM_API_HASH` | Telegram API Hash | https://my.telegram.org |
| `TELEGRAM_SESSION_NAME` | Pyrogram Session åç¨± | è‡ªå®šç¾© |
| `OPENAI_API_KEY` | OpenAI API Key | https://platform.openai.com/api-keys |

#### å¯é¸ç’°å¢ƒè®Šé‡

| è®Šé‡å | èªªæ˜ | é»˜èªå€¼ |
|--------|------|--------|
| `OPENAI_MODEL` | OpenAI é»˜èªæ¨¡å‹ | `gpt-4` |
| `OPENAI_VISION_MODEL` | OpenAI Vision æ¨¡å‹ | `gpt-4o-mini` |
| `TELEGRAM_SESSION_STRING` | å·²ç”Ÿæˆçš„ Session å­—ä¸² | `""` |
| `TELEGRAM_SESSION_FILE` | Session æ–‡ä»¶è·¯å¾‘ | `""` |

---

## ğŸ” æª¢æŸ¥ç•¶å‰ç’°å¢ƒè®Šé‡é…ç½®

### åœ¨æœå‹™å™¨ä¸Šæª¢æŸ¥

```bash
cd /home/ubuntu/liaotian/deployment-package && \
echo "=== æª¢æŸ¥ç’°å¢ƒè®Šé‡ ===" && \
echo "ã€å¾Œç«¯æœå‹™ç’°å¢ƒè®Šé‡ã€‘" && \
echo "JWT_SECRET: ${JWT_SECRET:-æœªè¨­ç½®}" && \
echo "DATABASE_URL: ${DATABASE_URL:-æœªè¨­ç½®ï¼ˆä½¿ç”¨é»˜èªå€¼ï¼‰}" && \
echo "ADMIN_DEFAULT_PASSWORD: ${ADMIN_DEFAULT_PASSWORD:-æœªè¨­ç½®ï¼ˆä½¿ç”¨é»˜èªå€¼ï¼‰}" && \
echo "" && \
echo "ã€AI æœå‹™ç’°å¢ƒè®Šé‡ã€‘" && \
if [ -f ".env" ]; then
    echo "âœ… .env æ–‡ä»¶å­˜åœ¨"
    echo "æª¢æŸ¥é—œéµè®Šé‡:"
    grep -E "^(TELEGRAM_API_ID|TELEGRAM_API_HASH|OPENAI_API_KEY)=" .env 2>/dev/null | sed 's/=.*/=***/' || echo "  æœªæ‰¾åˆ°é—œéµè®Šé‡"
else
    echo "âŒ .env æ–‡ä»¶ä¸å­˜åœ¨"
fi && \
echo "" && \
echo "ã€ç•¶å‰é…ç½®ï¼ˆå¾ä»£ç¢¼è®€å–ï¼‰ã€‘" && \
cd admin-backend && \
source /home/ubuntu/liaotian/admin-backend/.venv/bin/activate && \
export PYTHONPATH=/home/ubuntu/liaotian/deployment-package && \
python3 << 'PYEOF'
from app.core.config import get_settings
settings = get_settings()
print(f"æ•¸æ“šåº« URL: {settings.database_url}")
print(f"JWT Secret: {'å·²è¨­ç½®' if settings.jwt_secret != 'change_me' else 'âš ï¸ ä½¿ç”¨é»˜èªå€¼ï¼ˆä¸å®‰å…¨ï¼‰'}")
print(f"ç®¡ç†å“¡éƒµç®±: {settings.admin_default_email}")
print(f"ç®¡ç†å“¡å¯†ç¢¼: {'å·²è¨­ç½®' if settings.admin_default_password != 'changeme123' else 'âš ï¸ ä½¿ç”¨é»˜èªå€¼ï¼ˆä¸å®‰å…¨ï¼‰'}")
PYEOF
```

---

## ğŸ”§ é…ç½®ç’°å¢ƒè®Šé‡

### æ–¹æ³• 1: ä½¿ç”¨ç’°å¢ƒè®Šé‡ï¼ˆæ¨è–¦ç”¨æ–¼ç”Ÿç”¢ç’°å¢ƒï¼‰

#### åœ¨ systemd æœå‹™ä¸­é…ç½®

å¦‚æœä½¿ç”¨ systemd ç®¡ç†æœå‹™ï¼Œåœ¨æœå‹™æ–‡ä»¶ä¸­è¨­ç½®ï¼š

```ini
[Service]
Environment="JWT_SECRET=your_secure_jwt_secret_here"
Environment="DATABASE_URL=sqlite:///./admin.db"
Environment="ADMIN_DEFAULT_PASSWORD=your_secure_password"
```

#### åœ¨å•Ÿå‹•è…³æœ¬ä¸­é…ç½®

```bash
export JWT_SECRET="your_secure_jwt_secret_here"
export DATABASE_URL="sqlite:///./admin.db"
export ADMIN_DEFAULT_PASSWORD="your_secure_password"
```

### æ–¹æ³• 2: ä½¿ç”¨ .env æ–‡ä»¶ï¼ˆç”¨æ–¼ AI æœå‹™ï¼‰

AI æœå‹™å¾é …ç›®æ ¹ç›®éŒ„çš„ `.env` æ–‡ä»¶è®€å–é…ç½®ã€‚

#### å‰µå»º .env æ–‡ä»¶

```bash
cd /home/ubuntu/liaotian/deployment-package && \
if [ ! -f ".env" ]; then
    echo "å‰µå»º .env æ–‡ä»¶..."
    cat > .env << 'ENVEOF'
# ========== Telegram API é…ç½® [å¿…å¡«] ==========
TELEGRAM_API_ID=your_api_id
TELEGRAM_API_HASH=your_api_hash
TELEGRAM_SESSION_NAME=your_session_name

# ========== OpenAI API é…ç½® [å¿…å¡«] ==========
OPENAI_API_KEY=your_openai_api_key

# ========== å¯é¸é…ç½® ==========
OPENAI_MODEL=gpt-4
OPENAI_VISION_MODEL=gpt-4o-mini
ENVEOF
    echo "âœ… .env æ–‡ä»¶å·²å‰µå»ºï¼Œè«‹ç·¨è¼¯ä¸¦å¡«å…¥å¯¦éš›å€¼"
else
    echo "âœ… .env æ–‡ä»¶å·²å­˜åœ¨"
fi
```

---

## âœ… é©—è­‰ç’°å¢ƒè®Šé‡é…ç½®

### é©—è­‰è…³æœ¬

```bash
cd /home/ubuntu/liaotian/deployment-package && \
echo "=== é©—è­‰ç’°å¢ƒè®Šé‡é…ç½® ===" && \
echo "" && \
echo "ã€1. æª¢æŸ¥ .env æ–‡ä»¶ã€‘" && \
if [ -f ".env" ]; then
    echo "âœ… .env æ–‡ä»¶å­˜åœ¨"
    missing_vars=()
    if ! grep -q "^TELEGRAM_API_ID=" .env 2>/dev/null; then
        missing_vars+=("TELEGRAM_API_ID")
    fi
    if ! grep -q "^TELEGRAM_API_HASH=" .env 2>/dev/null; then
        missing_vars+=("TELEGRAM_API_HASH")
    fi
    if ! grep -q "^OPENAI_API_KEY=" .env 2>/dev/null; then
        missing_vars+=("OPENAI_API_KEY")
    fi
    if [ ${#missing_vars[@]} -eq 0 ]; then
        echo "âœ… æ‰€æœ‰å¿…å¡«è®Šé‡å·²è¨­ç½®"
    else
        echo "âŒ ç¼ºå°‘å¿…å¡«è®Šé‡: ${missing_vars[*]}"
    fi
else
    echo "âŒ .env æ–‡ä»¶ä¸å­˜åœ¨"
fi && \
echo "" && \
echo "ã€2. æª¢æŸ¥å¾Œç«¯é…ç½®ã€‘" && \
cd admin-backend && \
source /home/ubuntu/liaotian/admin-backend/.venv/bin/activate && \
export PYTHONPATH=/home/ubuntu/liaotian/deployment-package && \
python3 << 'PYEOF'
from app.core.config import get_settings
settings = get_settings()

warnings = []
if settings.jwt_secret == 'change_me':
    warnings.append("âš ï¸ JWT_SECRET ä½¿ç”¨é»˜èªå€¼ï¼ˆä¸å®‰å…¨ï¼‰")
if settings.admin_default_password == 'changeme123':
    warnings.append("âš ï¸ ADMIN_DEFAULT_PASSWORD ä½¿ç”¨é»˜èªå€¼ï¼ˆä¸å®‰å…¨ï¼‰")

if warnings:
    print("\n".join(warnings))
else:
    print("âœ… å¾Œç«¯é…ç½®å®‰å…¨ï¼ˆå·²ä¿®æ”¹é»˜èªå€¼ï¼‰")
PYEOF
```

---

## ğŸš€ å¿«é€Ÿé…ç½®è…³æœ¬

åŸ·è¡Œä»¥ä¸‹è…³æœ¬é€²è¡Œå¿«é€Ÿé…ç½®ï¼š

```bash
cd /home/ubuntu/liaotian/deployment-package && \
echo "=== ç’°å¢ƒè®Šé‡é…ç½®åŠ©æ‰‹ ===" && \
echo "" && \
echo "ã€æ­¥é©Ÿ 1ã€‘æª¢æŸ¥ç•¶å‰é…ç½®..." && \
if [ -f ".env" ]; then
    echo "âœ… .env æ–‡ä»¶å·²å­˜åœ¨"
    echo "ç•¶å‰é…ç½®:"
    grep -E "^(TELEGRAM_API_ID|TELEGRAM_API_HASH|OPENAI_API_KEY)=" .env 2>/dev/null | sed 's/=.*/=***/' || echo "  æœªæ‰¾åˆ°é—œéµè®Šé‡"
else
    echo "âŒ .env æ–‡ä»¶ä¸å­˜åœ¨ï¼Œéœ€è¦å‰µå»º"
    echo ""
    echo "è«‹æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š"
    echo "1. TELEGRAM_API_IDï¼ˆå¾ https://my.telegram.org ç²å–ï¼‰"
    echo "2. TELEGRAM_API_HASHï¼ˆå¾ https://my.telegram.org ç²å–ï¼‰"
    echo "3. OPENAI_API_KEYï¼ˆå¾ https://platform.openai.com/api-keys ç²å–ï¼‰"
    echo ""
    echo "å‰µå»º .env æ–‡ä»¶æ¨¡æ¿..."
    cp docs/env.example .env 2>/dev/null || echo "# è«‹æ‰‹å‹•å‰µå»º .env æ–‡ä»¶ä¸¦å¡«å…¥é…ç½®" > .env
    echo "âœ… .env æ–‡ä»¶æ¨¡æ¿å·²å‰µå»ºï¼Œè«‹ç·¨è¼¯ä¸¦å¡«å…¥å¯¦éš›å€¼"
fi && \
echo "" && \
echo "ã€æ­¥é©Ÿ 2ã€‘æª¢æŸ¥å¾Œç«¯é…ç½®..." && \
cd admin-backend && \
source /home/ubuntu/liaotian/admin-backend/.venv/bin/activate && \
export PYTHONPATH=/home/ubuntu/liaotian/deployment-package && \
python3 << 'PYEOF'
from app.core.config import get_settings
settings = get_settings()

print(f"æ•¸æ“šåº« URL: {settings.database_url}")
if settings.jwt_secret == 'change_me':
    print("âš ï¸ JWT_SECRET: ä½¿ç”¨é»˜èªå€¼ï¼ˆå»ºè­°ä¿®æ”¹ï¼‰")
else:
    print("âœ… JWT_SECRET: å·²è¨­ç½®")
if settings.admin_default_password == 'changeme123':
    print("âš ï¸ ADMIN_DEFAULT_PASSWORD: ä½¿ç”¨é»˜èªå€¼ï¼ˆå»ºè­°ä¿®æ”¹ï¼‰")
else:
    print("âœ… ADMIN_DEFAULT_PASSWORD: å·²è¨­ç½®")
PYEOF
```

---

## ğŸ“ é…ç½®å»ºè­°

### ç”Ÿç”¢ç’°å¢ƒå¿…é ˆé…ç½®

1. **JWT_SECRET** - ä½¿ç”¨å¼·éš¨æ©Ÿå­—ç¬¦ä¸²
   ```bash
   # ç”Ÿæˆéš¨æ©Ÿ JWT Secret
   python3 -c "import secrets; print(secrets.token_urlsafe(32))"
   ```

2. **ADMIN_DEFAULT_PASSWORD** - ä½¿ç”¨å¼·å¯†ç¢¼

3. **TELEGRAM_API_ID / TELEGRAM_API_HASH** - å¾ Telegram ç²å–

4. **OPENAI_API_KEY** - å¾ OpenAI ç²å–

### é–‹ç™¼/æ¸¬è©¦ç’°å¢ƒ

å¯ä»¥ä½¿ç”¨é»˜èªå€¼ï¼Œä½†å»ºè­°è‡³å°‘ä¿®æ”¹ `JWT_SECRET`ã€‚

---

## ğŸ”— ç›¸é—œæ–‡æª”

- [ç’°å¢ƒè®Šé‡ç¤ºä¾‹æ–‡ä»¶](../env.example)
- [å¾Œç«¯é…ç½®èªªæ˜](../admin-backend/app/core/config.py)
- [éƒ¨ç½²æŒ‡å—](../docs/ä½¿ç”¨è¯´æ˜/DEPLOYMENT_GUIDE.md)

---

**é…ç½®å®Œæˆå¾Œï¼Œè«‹åŸ·è¡Œé©—è­‰è…³æœ¬ç¢ºèªï¼**
