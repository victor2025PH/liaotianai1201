# 简化测试方案

## 当前问题
- API认证问题（401 Unauthorized）
- PowerShell脚本无法通过认证

## 推荐测试方案

### 方案1：浏览器控制台测试（最简单）

**步骤**：
1. 在浏览器中打开：http://localhost:3000/group-ai/accounts
2. 确保已登录（如果没有，先登录）
3. 按 F12 打开开发者工具
4. 切换到 Console 标签
5. 复制并运行以下代码：

```javascript
// 测试服务器账号启动
(async function() {
    const token = localStorage.getItem('access_token');
    if (!token) {
        console.error("❌ 未找到token，请先登录");
        return;
    }
    
    const baseUrl = "http://localhost:8000/api/v1";
    const headers = {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
    };
    
    // 获取账号列表
    const accountsResponse = await fetch(`${baseUrl}/group-ai/accounts?page=1&page_size=100`, { headers });
    const accountsData = await accountsResponse.json();
    const accounts = accountsData.items || accountsData;
    
    // 查找已分配到服务器的账号
    const serverAccounts = accounts.filter(acc => acc.server_id && acc.server_id !== "");
    console.log(`找到 ${serverAccounts.length} 个已分配服务器的账号`);
    
    if (serverAccounts.length === 0) {
        console.warn("没有已分配到服务器的账号");
        return;
    }
    
    const testAccount = serverAccounts[0];
    console.log(`测试账号: ${testAccount.account_id}, 服务器: ${testAccount.server_id}`);
    
    // 启动账号
    const startResponse = await fetch(`${baseUrl}/group-ai/accounts/${testAccount.account_id}/start`, {
        method: 'POST',
        headers: headers
    });
    
    if (!startResponse.ok) {
        const error = await startResponse.json();
        console.error(`启动失败: ${error.detail}`);
        return;
    }
    
    const startResult = await startResponse.json();
    console.log(`✅ 启动成功: ${startResult.message}`);
    
    // 等待并检查状态
    await new Promise(resolve => setTimeout(resolve, 5000));
    const accountResponse = await fetch(`${baseUrl}/group-ai/accounts/${testAccount.account_id}`, { headers });
    const account = await accountResponse.json();
    console.log(`账号状态: ${account.status}`);
})();
```

### 方案2：前端界面手动测试

**步骤**：
1. 打开：http://localhost:3000/group-ai/accounts
2. 登录（如果需要）
3. 在账号列表中查找有 `server_id` 的账号
4. 点击"啟動"按钮
5. 观察启动结果

### 方案3：检查后端日志

**步骤**：
1. 查看后端日志：`logs/backend.log`
2. 查找以下信息：
   - "账号 {account_id} 已分配到服务器 {server_id}，嘗試在服務器上啟動"
   - "賬號 {account_id} 已在服務器 {server_id} 上啟動"

## 验证方法

### 1. 检查账号状态
- 账号状态应为 `online`
- `server_id` 应该存在

### 2. 检查后端日志
- 查看是否有服务器启动的相关日志

### 3. 检查服务器日志
- 通过SSH连接到服务器
- 查看 `logs/account_{account_id}.log`

## 相关文件

- `浏览器测试服务器账号启动.js` - 完整的浏览器测试脚本
- `全自动测试服务器账号启动.ps1` - PowerShell测试脚本（需要修复认证）

