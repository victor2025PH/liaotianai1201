# 重启后端服务说明

## 当前状态

- ✅ 后端服务正在运行（PID: 12412）
- ❌ 新的API端点未加载（返回404）
- ⚠️  需要重启后端服务

## 重启步骤

### 方法1：在Cursor终端中重启（推荐）

1. **找到运行后端服务的终端窗口**
   - 查看Cursor的终端标签页
   - 找到显示 `uvicorn` 或 `Starting backend server` 的终端

2. **停止服务**
   - 在该终端中按 `Ctrl+C`
   - 等待服务完全停止

3. **重新启动服务**
   ```bash
   cd admin-backend
   python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
   ```

4. **验证服务启动**
   - 看到 `Application startup complete` 表示启动成功
   - 新的API端点将自动加载

### 方法2：使用启动脚本

```bash
.\admin-backend\start_server.bat
```

### 方法3：如果使用PowerShell脚本

```powershell
.\scripts\start_backend.ps1
```

## 验证新API端点

重启后，运行以下命令验证：

```powershell
# 登录获取token
$loginBody = @{ username = "admin@example.com"; password = "changeme123" }
$loginResponse = Invoke-WebRequest -Uri "http://localhost:8000/api/v1/auth/login" -Method POST -ContentType "application/x-www-form-urlencoded" -Body $loginBody
$token = ($loginResponse.Content | ConvertFrom-Json).access_token

# 测试新API端点（应该返回422验证错误，而不是404）
$testResponse = Invoke-WebRequest -Uri "http://localhost:8000/api/v1/group-ai/groups/send-test-message" -Method POST -ContentType "application/json" -Headers @{ "Authorization" = "Bearer $token" } -Body '{"account_id":"test","group_id":-1,"message":"test"}'
```

**预期结果**：
- ✅ 如果返回422或400：API端点已加载（验证错误是正常的）
- ❌ 如果返回404：API端点未加载，需要再次重启

## 重启后测试

重启完成后，运行测试脚本：

```powershell
pwsh -File "测试按剧本聊天功能（完整版）.ps1"
```

## 注意事项

1. **如果后端服务使用 `--reload` 参数**：
   - 理论上应该自动重载代码更改
   - 但如果新文件未被检测到，仍需要手动重启

2. **检查后端日志**：
   - 查看是否有导入错误
   - 确认 `groups.py` 模块已正确加载

3. **端口占用**：
   - 如果8000端口被占用，先停止旧进程
   - 使用 `Get-NetTCPConnection -LocalPort 8000` 查看占用进程

