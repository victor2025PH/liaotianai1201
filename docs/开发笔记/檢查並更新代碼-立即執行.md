# 檢查並更新代碼 - 立即執行

> **日期**: 2025-12-01  
> **問題**: 測試返回 404，需要檢查並更新服務器代碼

---

## 🔍 立即檢查

### 步驟 1: 找出實際運行的後端目錄

```bash
# 查看運行中的後端進程
ps aux | grep uvicorn | grep app.main

# 查看進程的工作目錄（如果能查看）
ps -p $(pgrep -f "uvicorn.*app.main:app") -o cwd=
```

---

### 步驟 2: 檢查代碼是否包含修復

```bash
# 檢查所有可能的後端目錄
echo "檢查代碼是否包含修復..."
for dir in /home/ubuntu/liaotian/admin-backend /home/ubuntu/admin-backend /home/ubuntu/liaotian/deployment-package/admin-backend; do
    if [ -f "$dir/app/api/group_ai/accounts.py" ]; then
        echo "檢查: $dir"
        if grep -q "檢查數據庫（包含遠程服務器賬號）" "$dir/app/api/group_ai/accounts.py" 2>/dev/null; then
            echo "  ✅ 包含修復"
        else
            echo "  ❌ 不包含修復（舊代碼）"
        fi
    fi
done
```

---

### 步驟 3: 如果代碼已更新，重啟服務

如果檢查結果顯示代碼已包含修復，重啟服務：

```bash
# 停止服務
pkill -f "uvicorn.*app.main:app"
sleep 3

# 進入後端目錄（選擇包含修復的目錄）
cd /home/ubuntu/liaotian/admin-backend  # 或包含修復的目錄

# 啟動服務
source ../.venv/bin/activate 2>/dev/null || source .venv/bin/activate 2>/dev/null
nohup python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 > /tmp/backend.log 2>&1 &
sleep 5

# 驗證
curl http://localhost:8000/health
```

---

### 步驟 4: 如果代碼未更新，需要部署

如果檢查結果顯示代碼不包含修復，需要：

1. **從本地推送代碼到 Git**（如果使用 Git）
2. **或手動上傳修復的文件到服務器**

---

## 🚀 一鍵檢查

執行以下命令進行完整檢查：

```bash
echo "=== 檢查後端代碼狀態 ===" && \
echo "" && \
echo "【1】運行中的後端進程:" && \
ps aux | grep uvicorn | grep app.main | grep -v grep && \
echo "" && \
echo "【2】檢查代碼是否包含修復:" && \
for dir in /home/ubuntu/liaotian/admin-backend /home/ubuntu/admin-backend; do
    if [ -f "$dir/app/api/group_ai/accounts.py" ]; then
        echo "檢查: $dir"
        grep -q "檢查數據庫（包含遠程服務器賬號）" "$dir/app/api/group_ai/accounts.py" 2>/dev/null && \
        echo "  ✅ 包含修復" || echo "  ❌ 不包含修復"
    fi
done
```

---

**執行檢查命令，告訴我結果！**
