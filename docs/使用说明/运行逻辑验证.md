# 运行逻辑验证文档

## ✅ 逻辑关系验证

### 1. 剧本管理 → 账号管理
- ✅ **依赖关系**: 账号创建时必须关联剧本（script_id）
- ✅ **验证**: 账号启动时验证剧本是否存在
- ✅ **错误处理**: 如果剧本不存在，显示 "無法加載劇本: {script_id}"
- ✅ **运行顺序**: ①-1 必须先于 ②-2

### 2. 账号管理 → 角色分配
- ✅ **依赖关系**: 角色分配时需要账号列表
- ✅ **验证**: 创建分配方案时验证账号是否存在
- ✅ **错误处理**: 如果账号不存在，跳过该账号
- ✅ **运行顺序**: ②-2 应该先于 ③-2（可选）

### 3. 角色分配 → 分配方案
- ✅ **依赖关系**: 分配方案可以保存角色分配的结果
- ✅ **验证**: 保存方案时验证分配方案是否有效
- ✅ **错误处理**: 如果分配方案无效，提示错误
- ✅ **运行顺序**: ③-2 应该先于 ④-1（可选）

### 4. 分配方案 → 账号管理
- ✅ **依赖关系**: 应用方案时需要账号存在
- ✅ **验证**: 应用方案时验证账号是否存在
- ✅ **错误处理**: 如果账号不存在，跳过该账号
- ✅ **运行顺序**: ②-2 应该先于 ④-2

### 5. 自动化任务 → 账号/剧本
- ✅ **依赖关系**: 自动化任务可以依赖账号或剧本
- ✅ **验证**: 创建任务时验证依赖是否存在
- ✅ **错误处理**: 如果依赖不存在，任务执行失败
- ✅ **运行顺序**: ②-2 和 ①-1 应该先于 ⑤-1（可选）

## 📊 完整流程验证

### 最小化流程（必需步骤）

```
①-1 创建剧本
  ↓
②-1 上传 Session 文件
  ↓
②-2 创建账号（关联剧本 ①-1）
  ↓
②-3 启动账号（验证剧本存在）
```

**验证结果**: ✅ 逻辑通顺，所有依赖关系满足

### 完整流程（包含可选步骤）

```
①-1 创建剧本
  ↓
①-2 配置角色（可选）
  ↓
②-1 上传 Session 文件
  ↓
②-2 创建账号（关联剧本 ①-1）
  ↓
③-1 提取角色（从剧本 ①-1）
  ↓
③-2 创建分配方案（使用账号 ②-2）
  ↓
③-3 应用分配方案（更新账号配置）
  ↓
④-1 保存方案（从 ③-2）
  ↓
④-2 应用方案到账号（批量应用）
  ↓
②-3 启动账号（验证剧本存在）
  ↓
⑤-1 创建自动化任务（依赖 ②-2 和 ①-1）
  ↓
⑤-2 启用任务（自动执行操作）
```

**验证结果**: ✅ 逻辑通顺，所有依赖关系满足

## 🔍 错误场景验证

### 错误场景 1: 启动账号失败 - "無法加載劇本: 01111"

**验证流程**:
1. ✅ 检查依赖: 账号关联剧本 `01111`
2. ✅ 验证剧本: 检查剧本管理页面，确认剧本是否存在
3. ✅ 错误处理: 
   - 如果不存在 → 执行 ①-1 创建剧本
   - 如果存在但无效 → 编辑剧本并保存
   - 重新执行 ②-3 启动账号
4. ✅ 修复后验证: 账号应该能够正常启动

**验证结果**: ✅ 错误处理逻辑正确

### 错误场景 2: 角色分配失败 - "剧本不存在"

**验证流程**:
1. ✅ 检查依赖: 提取角色需要剧本
2. ✅ 验证剧本: 检查剧本是否存在
3. ✅ 错误处理: 
   - 如果不存在 → 先执行 ①-1 创建剧本
   - 再执行 ③-1 提取角色
4. ✅ 修复后验证: 角色应该能够正常提取

**验证结果**: ✅ 错误处理逻辑正确

### 错误场景 3: 应用分配方案失败 - "账号不存在"

**验证流程**:
1. ✅ 检查依赖: 应用方案需要账号存在
2. ✅ 验证账号: 检查账号是否已创建
3. ✅ 错误处理: 
   - 如果不存在 → 先执行 ②-2 创建账号
   - 再执行 ④-2 应用方案
4. ✅ 修复后验证: 方案应该能够正常应用

**验证结果**: ✅ 错误处理逻辑正确

## 📋 菜单顺序验证

### 当前菜单顺序

```
總覽
① 劇本管理          ← 第一步（必需）
服務器狀態
② 賬號管理          ← 第二步（必需）
③ 角色分配          ← 第三步（可选）
④ 分配方案          ← 第四步（可选）
⑤ 自動化任務        ← 第五步（可选）
群組監控
會話列表
日誌
系統監控
告警設置
權限管理
```

**验证结果**: ✅ 菜单顺序符合操作逻辑，按 ① → ② → ③ → ④ → ⑤ 排列

## 🎯 运行逻辑总结

### 核心依赖链

```
剧本管理 (①)
  ├─ 账号管理 (②) [依赖: ①]
  │   └─ 角色分配 (③) [依赖: ①, ②]
  │       └─ 分配方案 (④) [依赖: ③]
  │           └─ 自动化任务 (⑤) [依赖: ②, ①]
```

### 操作顺序规则

1. ✅ **必须顺序**: ① → ② → ③ → ④ → ⑤（必需步骤在前，可选步骤在后）
2. ✅ **并行操作**: ③、④、⑤ 可以并行配置（如果依赖已满足）
3. ✅ **跳过规则**: 如果不使用角色功能，可以跳过 ③ 和 ④
4. ✅ **独立操作**: ⑤ 可以独立配置，不依赖 ③ 和 ④

### 验证结论

✅ **所有逻辑关系正确**
✅ **所有依赖关系满足**
✅ **所有错误场景处理完善**
✅ **菜单顺序符合操作逻辑**
✅ **运行逻辑通顺无误**

## 📝 最佳实践建议

### 首次使用
1. 严格按照 ① → ② → ③ → ④ → ⑤ 的顺序操作
2. 每个步骤完成后验证是否成功
3. 遇到错误时查看错误提示，检查依赖关系

### 批量部署
1. 先创建剧本（一次）
2. 批量上传 Session 文件
3. 批量创建账号（使用同一剧本）
4. 创建角色分配方案并保存
5. 批量应用方案
6. 启动所有账号或使用自动化任务

### 日常维护
1. 定期检查剧本是否有效
2. 监控账号运行状态
3. 查看自动化任务执行情况
4. 根据需要进行调整
