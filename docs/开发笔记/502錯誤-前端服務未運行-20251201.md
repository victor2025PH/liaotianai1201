# 502 éŒ¯èª¤ - å‰ç«¯æœå‹™æœªé‹è¡Œ

> **æ—¥æœŸ**: 2025-12-01  
> **å•é¡Œ**: å‰ç«¯æœå‹™ï¼ˆ3000ç«¯å£ï¼‰æœªé‹è¡Œ

---

## ğŸ” å•é¡Œåˆ†æ

å¾ Nginx éŒ¯èª¤æ—¥èªŒå¯ä»¥çœ‹å‡ºï¼š

```
upstream: "http://127.0.0.1:3000/health"
upstream: "http://127.0.0.1:3000/"
```

**å•é¡Œ**:
1. è¨ªå• `/health` æ™‚ï¼ŒNginx å°‡å…¶è·¯ç”±åˆ° `http://127.0.0.1:3000`ï¼ˆå‰ç«¯ï¼‰
2. è¨ªå• `/` æ™‚ï¼Œä¹Ÿè¢«è·¯ç”±åˆ° `http://127.0.0.1:3000`ï¼ˆå‰ç«¯ï¼‰
3. **å‰ç«¯æœå‹™ï¼ˆ3000ç«¯å£ï¼‰æœªé‹è¡Œ**ï¼Œå°è‡´ 502 éŒ¯èª¤

**åŸå› **:
- `/health` ä¸åŒ¹é… `/api/`ï¼Œæ‰€ä»¥è¢« `location /` æ•ç²
- `location /` æŒ‡å‘å‰ç«¯æœå‹™ï¼ˆ3000ç«¯å£ï¼‰
- å‰ç«¯æœå‹™æœªå•Ÿå‹•

---

## ğŸ”§ è§£æ±ºæ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: å•Ÿå‹•å‰ç«¯æœå‹™ï¼ˆæ¨è–¦ï¼‰

```bash
echo "=== æª¢æŸ¥å’Œå•Ÿå‹•å‰ç«¯æœå‹™ ===" && \
echo "" && \
echo "ã€1ã€‘æª¢æŸ¥å‰ç«¯æœå‹™ç‹€æ…‹..." && \
if pgrep -f "node.*next\|npm.*dev\|next-server" > /dev/null; then
    echo "âœ… å‰ç«¯æœå‹™æ­£åœ¨é‹è¡Œ"
    pgrep -f "node.*next\|npm.*dev\|next-server"
else
    echo "âŒ å‰ç«¯æœå‹™æœªé‹è¡Œ"
fi && \
echo "" && \
echo "ã€2ã€‘æª¢æŸ¥ç«¯å£ 3000..." && \
if lsof -i :3000 > /dev/null 2>&1; then
    echo "âœ… ç«¯å£ 3000 æ­£åœ¨ç›£è½"
    lsof -i :3000
else
    echo "âŒ ç«¯å£ 3000 æœªç›£è½"
fi && \
echo "" && \
echo "ã€3ã€‘å•Ÿå‹•å‰ç«¯æœå‹™..." && \
cd /home/ubuntu/liaotian/deployment-package/saas-demo && \
if [ -f "package.json" ]; then
    echo "æ‰¾åˆ°å‰ç«¯é …ç›®ï¼Œå•Ÿå‹•æœå‹™..."
    nohup npm run dev > /tmp/frontend.log 2>&1 &
    sleep 5
    if lsof -i :3000 > /dev/null 2>&1; then
        echo "âœ… å‰ç«¯æœå‹™å·²å•Ÿå‹•"
    else
        echo "âš ï¸ å‰ç«¯æœå‹™å¯èƒ½å•Ÿå‹•å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ—¥èªŒ: /tmp/frontend.log"
        tail -20 /tmp/frontend.log
    fi
else
    echo "âŒ æœªæ‰¾åˆ°å‰ç«¯é …ç›®"
    echo "è«‹ç¢ºèªå‰ç«¯é …ç›®è·¯å¾‘"
fi
```

### æ–¹æ¡ˆ 2: æ¸¬è©¦å¾Œç«¯ APIï¼ˆè‡¨æ™‚æ–¹æ¡ˆï¼‰

å¦‚æœåªéœ€è¦æ¸¬è©¦å¾Œç«¯ï¼Œè¨ªå• `/api/health` è€Œä¸æ˜¯ `/health`ï¼š

```bash
curl -H "Host: aikz.usdt2026.cc" http://127.0.0.1/api/health
```

---

## ğŸ“‹ å®Œæ•´ä¿®å¾©å‘½ä»¤

```bash
echo "=== å•Ÿå‹•å‰ç«¯æœå‹™ ===" && \
cd /home/ubuntu/liaotian/deployment-package/saas-demo && \
if [ -f "package.json" ]; then
    echo "åœæ­¢èˆŠçš„å‰ç«¯é€²ç¨‹..." && \
    pkill -f "node.*next\|npm.*dev" 2>/dev/null || true && \
    sleep 2 && \
    echo "å•Ÿå‹•å‰ç«¯æœå‹™..." && \
    nohup npm run dev > /tmp/frontend.log 2>&1 & \
    sleep 8 && \
    echo "æª¢æŸ¥æœå‹™ç‹€æ…‹..." && \
    if lsof -i :3000 > /dev/null 2>&1; then
        echo "âœ… å‰ç«¯æœå‹™å·²å•Ÿå‹•ï¼ˆç«¯å£ 3000ï¼‰"
        curl -s http://127.0.0.1:3000 | head -5 || echo "å‰ç«¯éŸ¿æ‡‰ä¸­..."
    else
        echo "âš ï¸ å‰ç«¯æœå‹™å¯èƒ½å•Ÿå‹•å¤±æ•—"
        echo "æŸ¥çœ‹æ—¥èªŒ: tail -30 /tmp/frontend.log"
        tail -30 /tmp/frontend.log
    fi
else
    echo "âŒ æœªæ‰¾åˆ°å‰ç«¯é …ç›®"
    echo "è«‹ç¢ºèªå‰ç«¯é …ç›®åœ¨: /home/ubuntu/liaotian/deployment-package/saas-demo"
fi
```

---

**åŸ·è¡Œä¸Šè¿°å‘½ä»¤å•Ÿå‹•å‰ç«¯æœå‹™ï¼**
