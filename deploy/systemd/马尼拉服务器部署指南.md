# 马尼拉服务器部署指南

## 服务器信息
- **主机**: 165.154.233.55
- **用户**: ubuntu
- **SSH 命令**: `ssh ubuntu@165.154.233.55`

## 部署步骤

### 方法1: 使用 SCP 上传文件（推荐）

在本地 PowerShell 执行：

```powershell
# 上传修复后的文件
scp saas-demo/src/components/layout-wrapper.tsx ubuntu@165.154.233.55:/home/ubuntu/saas-demo/src/components/
```

**注意**: 如果要求输入密码，直接输入（不会显示），然后按 Enter。

### 方法2: 使用 Web SSH（如果可用）

1. 登录云服务器控制台
2. 找到马尼拉服务器 (165.154.233.55)
3. 使用 Web SSH 连接
4. 执行以下命令：

```bash
# 1. 进入目录
cd /home/ubuntu/saas-demo/src/components

# 2. 备份原文件
cp layout-wrapper.tsx layout-wrapper.tsx.bak

# 3. 编辑文件
nano layout-wrapper.tsx
```

在 nano 中：
- 删除所有内容（多次按 Ctrl+K）
- 从本地文件 `deploy/systemd/fix_layout_wrapper.txt` 复制全部内容
- 按 Ctrl+V 粘贴
- 按 Ctrl+O 保存
- 按 Enter 确认
- 按 Ctrl+X 退出

然后继续：

```bash
# 4. 返回前端目录
cd /home/ubuntu/saas-demo

# 5. 确保使用 Node.js 20
source ~/.nvm/nvm.sh
nvm use 20

# 如果没有 Node.js 20，安装它：
# nvm install 20
# nvm use 20
# nvm alias default 20

# 6. 重新构建
npm run build

# 7. 重启服务
sudo systemctl restart smart-tg-frontend

# 8. 检查状态
sudo systemctl status smart-tg-frontend
```

### 方法3: 检查服务器状态

如果无法连接，先检查：

```bash
# 在本地测试连接
ping 165.154.233.55

# 测试 SSH 端口
telnet 165.154.233.55 22
```

## 验证部署

部署完成后：

1. 访问前端: http://165.154.233.55:3000
2. 访问后端: http://165.154.233.55:8000
3. 清除浏览器缓存
4. 如果仍然卡在认证检查，在浏览器控制台执行: `localStorage.clear()`

## 如果遇到问题

### 问题1: SSH 连接失败
- 检查云服务器控制台，确认服务器状态
- 检查安全组是否开放 22 端口
- 确认用户名和密码正确

### 问题2: 文件上传失败
- 确认目录存在: `/home/ubuntu/saas-demo/src/components/`
- 确认有写入权限

### 问题3: 构建失败
- 检查 Node.js 版本: `node --version` (需要 >= 20.9.0)
- 检查依赖: `npm install`
- 查看构建日志中的错误信息

### 问题4: 服务无法启动
- 查看日志: `sudo journalctl -u smart-tg-frontend -f`
- 检查端口占用: `sudo ss -tlnp | grep 3000`
- 检查服务配置: `sudo systemctl status smart-tg-frontend`

