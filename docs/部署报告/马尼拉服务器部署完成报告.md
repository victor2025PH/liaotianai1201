# 馬尼拉服務器部署完成報告

## 部署資訊

| 項目 | 值 |
|------|-----|
| 服務器 IP | 165.154.233.55 |
| GitHub 倉庫 | https://github.com/victor2025PH/loaotian1127.git |
| 部署時間 | 2025-11-27 |
| 狀態 | ✅ 服務已啟動，⚠️ 需開放安全組端口 |

## 服務狀態

| 服務 | 狀態 | 端口 |
|------|------|------|
| 後端 API (liaotian-backend) | ✅ active (running) | 8000 |
| 前端應用 (liaotian-frontend) | ✅ active (running) | 3000 |

## 訪問地址

```
前端應用: http://165.154.233.55:3000
後端 API: http://165.154.233.55:8000
API 文檔: http://165.154.233.55:8000/docs
```

## 登錄帳號

```
郵箱: admin@example.com
密碼: changeme123
```

## ⚠️ 重要：需要手動操作

### 開放雲服務商安全組端口

服務器的 UFW 防火牆已經開放了必要端口，但**雲服務商的安全組**可能還需要手動配置。

請登錄雲服務商控制台（如 AWS、阿里雲、騰訊雲等），找到此服務器的安全組，添加以下入站規則：

| 端口 | 協議 | 來源 | 說明 |
|------|------|------|------|
| 22 | TCP | 0.0.0.0/0 | SSH 連接 |
| 80 | TCP | 0.0.0.0/0 | HTTP |
| 443 | TCP | 0.0.0.0/0 | HTTPS |
| **3000** | TCP | 0.0.0.0/0 | **前端應用** |
| **8000** | TCP | 0.0.0.0/0 | **後端 API** |

## 部署內容

### 目錄結構

```
/home/ubuntu/liaotian/
├── admin-backend/          # 後端 Python FastAPI
│   ├── .venv/              # Python 虛擬環境
│   ├── app/                # 應用代碼
│   ├── .env                # 環境配置
│   └── admin.db            # SQLite 數據庫
└── saas-demo/              # 前端 Next.js
    ├── .next/              # 構建產物
    ├── node_modules/       # 依賴
    └── .env.local          # 環境配置
```

### Systemd 服務

```bash
# 查看服務狀態
sudo systemctl status liaotian-backend
sudo systemctl status liaotian-frontend

# 重啟服務
sudo systemctl restart liaotian-backend
sudo systemctl restart liaotian-frontend

# 查看日誌
sudo journalctl -u liaotian-backend -f
sudo journalctl -u liaotian-frontend -f
```

## 配置文件

### 後端 .env

```bash
DATABASE_URL=sqlite:///./admin.db
JWT_SECRET=<自動生成>
ADMIN_DEFAULT_EMAIL=admin@example.com
ADMIN_DEFAULT_PASSWORD=changeme123
CORS_ORIGINS=http://localhost:3000,http://165.154.233.55:3000,http://165.154.233.55
```

### 前端 .env.local

```bash
NEXT_PUBLIC_API_BASE_URL=http://165.154.233.55:8000/api/v1
```

## 更新部署

如需更新代碼，執行以下命令：

```bash
# SSH 連接服務器
ssh ubuntu@165.154.233.55

# 更新代碼
cd /home/ubuntu/liaotian
git pull

# 更新後端
cd admin-backend
source .venv/bin/activate
pip install -r requirements.txt
sudo systemctl restart liaotian-backend

# 更新前端
cd ../saas-demo
npm install
npm run build
sudo systemctl restart liaotian-frontend
```

## 常見問題

### 1. 無法訪問前端

檢查安全組是否開放了 3000 端口。

### 2. API 返回 CORS 錯誤

編輯 `/home/ubuntu/liaotian/admin-backend/.env`，添加前端地址到 `CORS_ORIGINS`。

### 3. 登錄失敗

確保數據庫已初始化：
```bash
cd /home/ubuntu/liaotian/admin-backend
source .venv/bin/activate
python reset_admin_user.py
```

---

部署完成日期: 2025-11-27

