# ç«‹å³è§£å†³æ–¹æ¡ˆï¼šè„šæœ¬æ‰¾ä¸åˆ°

## ğŸ” é—®é¢˜è¯Šæ–­

æœåŠ¡å™¨ä¸Šæ‰¾ä¸åˆ°è„šæœ¬æ–‡ä»¶ï¼Œè¯´æ˜æ–‡ä»¶å¯èƒ½æ²¡æœ‰æ¨é€åˆ° GitHubã€‚

---

## âœ… ç«‹å³è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: åœ¨æœåŠ¡å™¨ä¸Šç›´æ¥åˆ›å»ºè„šæœ¬ï¼ˆæœ€å¿«ï¼‰

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç›´æ¥åˆ›å»º `full_auto_complete.sh`ï¼š

```bash
cd ~/liaotian

# åˆ›å»ºè„šæœ¬æ–‡ä»¶
cat > scripts/full_auto_complete.sh << 'SCRIPTEOF'
#!/bin/bash
# Full Auto Complete: Verify, Deploy, and Cleanup (Non-Interactive)

set -e

echo "========================================"
echo "Full Auto Complete Script"
echo "Started at: $(date)"
echo "========================================"
echo ""

cd ~/liaotian || {
    echo "âŒ Cannot enter project directory"
    exit 1
}

# Phase 1: Auto Verify Scripts
echo "========================================"
echo "Phase 1: Auto Verify Script Files"
echo "========================================"

CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
if [[ "$CURRENT_BRANCH" != "main" ]]; then
    git checkout main 2>/dev/null || git checkout -b main origin/main
fi
echo "âœ… On main branch"

echo "Fetching latest code..."
git fetch origin main
LOCAL_COMMIT=$(git rev-parse HEAD)
REMOTE_COMMIT=$(git rev-parse origin/main)

if [[ "$LOCAL_COMMIT" != "$REMOTE_COMMIT" ]]; then
    git pull origin main
    echo "âœ… Code updated"
else
    echo "âœ… Code already up to date"
fi

REQUIRED_SCRIPTS=(
    "scripts/one_click_deploy.sh"
    "scripts/unify_branches_server.sh"
    "deploy/fix_and_deploy_frontend_complete.sh"
)

echo ""
echo "Verifying script files..."
mkdir -p scripts deploy

for script in "${REQUIRED_SCRIPTS[@]}"; do
    if [[ -f "$script" ]]; then
        echo "âœ… $script exists"
        chmod +x "$script" 2>/dev/null || true
    else
        echo "âš ï¸  $script missing, attempting to checkout..."
        git checkout origin/main -- "$script" 2>/dev/null && {
            chmod +x "$script" 2>/dev/null || true
            echo "âœ… Checked out: $script"
        } || echo "âŒ Failed to checkout: $script"
    fi
done

# Phase 2: Auto Test Deployment
echo ""
echo "========================================"
echo "Phase 2: Auto Test Deployment Script"
echo "========================================"

if [[ -f "deploy/fix_and_deploy_frontend_complete.sh" ]]; then
    if bash -n deploy/fix_and_deploy_frontend_complete.sh; then
        echo "âœ… Deployment script syntax is valid"
        
        if [[ -d "saas-demo" ]]; then
            echo "âœ… Frontend directory exists"
        fi
        
        if command -v node >/dev/null 2>&1; then
            echo "âœ… Node.js: $(node --version)"
        fi
        
        if command -v npm >/dev/null 2>&1; then
            echo "âœ… npm: $(npm --version)"
        fi
        
        echo ""
        echo "ğŸš€ Executing deployment script..."
        echo "========================================"
        bash deploy/fix_and_deploy_frontend_complete.sh
        DEPLOY_RESULT=$?
        
        if [[ $DEPLOY_RESULT -eq 0 ]]; then
            echo ""
            echo "âœ… Deployment completed successfully!"
        else
            echo ""
            echo "âš ï¸  Deployment completed with exit code: $DEPLOY_RESULT"
        fi
    else
        echo "âŒ Deployment script has syntax errors"
    fi
else
    echo "âŒ Deployment script not found"
fi

# Phase 3: Auto Cleanup Master Branch
echo ""
echo "========================================"
echo "Phase 3: Auto Cleanup Master Branch"
echo "========================================"

if git show-ref --verify --quiet refs/heads/master; then
    echo "Master branch exists, checking merge status..."
    
    if git branch --merged main | grep -q "master"; then
        echo "Master is fully merged into main"
        echo "Deleting master branch..."
        git branch -d master 2>/dev/null || git branch -D master
        echo "âœ… Master branch deleted"
    else
        echo "Master is not fully merged"
        UNMERGED=$(git log main..master --oneline 2>/dev/null | wc -l)
        if [[ $UNMERGED -gt 0 ]]; then
            echo "Master has $UNMERGED unmerged commit(s)"
            echo "Attempting to merge master into main..."
            if git merge master --no-edit --no-ff 2>/dev/null; then
                echo "âœ… Merged master into main"
                git branch -d master 2>/dev/null || git branch -D master
                echo "âœ… Master branch deleted"
            else
                echo "âš ï¸  Merge failed, force deleting master..."
                git branch -D master 2>/dev/null || true
                echo "âœ… Master branch force deleted"
            fi
        else
            echo "Force deleting master..."
            git branch -D master 2>/dev/null || true
            echo "âœ… Master branch deleted"
        fi
    fi
else
    echo "âœ… Master branch does not exist"
fi

# Phase 4: Final Status
echo ""
echo "========================================"
echo "Phase 4: Final Status Report"
echo "========================================"

echo ""
echo "Branch Status:"
echo "  Current branch: $(git rev-parse --abbrev-ref HEAD)"
echo "  Local branches:"
git branch | sed 's/^/    /'

echo ""
echo "Sync Status:"
git status -sb | sed 's/^/  /'

echo ""
echo "Latest Commit:"
git log -1 --oneline | sed 's/^/  /'

echo ""
echo "========================================"
echo "âœ… Full Auto Complete Finished!"
echo "Completed at: $(date)"
echo "========================================"
SCRIPTEOF

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x scripts/full_auto_complete.sh

# éªŒè¯æ–‡ä»¶å·²åˆ›å»º
ls -la scripts/full_auto_complete.sh

echo ""
echo "âœ… Script created successfully!"
echo "Now you can run: bash scripts/full_auto_complete.sh"
```

### æ–¹æ¡ˆ 2: å…ˆè¯Šæ–­ï¼Œå†è§£å†³

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œè¯Šæ–­ï¼š

```bash
cd ~/liaotian

# 1. æŸ¥çœ‹è¿œç¨‹ä»“åº“ä¸­æ‰€æœ‰è„šæœ¬
echo "=== All .sh files in remote repository ==="
git fetch origin main
git ls-tree -r origin/main --name-only | grep "\.sh$"

# 2. æŸ¥çœ‹ scripts ç›®å½•
echo ""
echo "=== Files in scripts/ directory ==="
git ls-tree -r origin/main --name-only scripts/

# 3. æŸ¥çœ‹æœ€æ–°æäº¤
echo ""
echo "=== Latest commit files ==="
git log -1 --name-only --oneline origin/main
```

æ ¹æ®è¯Šæ–­ç»“æœå†³å®šä¸‹ä¸€æ­¥ã€‚

---

## ğŸ¯ æ¨èæ“ä½œ

**ç«‹å³æ‰§è¡Œæ–¹æ¡ˆ 1**ï¼Œç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºè„šæœ¬æ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥ç«‹å³ä½¿ç”¨ï¼Œä¸éœ€è¦ç­‰å¾… Git åŒæ­¥é—®é¢˜è§£å†³ã€‚

åˆ›å»ºå®Œæˆåï¼Œç›´æ¥è¿è¡Œï¼š

```bash
bash scripts/full_auto_complete.sh
```
