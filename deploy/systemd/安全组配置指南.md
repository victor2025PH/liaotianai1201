# 云服务器安全组配置指南

## 问题诊断

如果无法从外部访问前端（http://165.154.254.99:3000），最可能的原因是**云服务器安全组没有开放 3000 端口**。

## 当前状态

✅ **后端服务**: 正常运行，外部可访问（http://165.154.254.99:8000）
- 说明安全组已开放 8000 端口

❌ **前端服务**: 服务正常运行，但外部无法访问（http://165.154.254.99:3000）
- 说明安全组可能未开放 3000 端口

## 解决方案

### 方法 1: 在云服务器控制台配置安全组

1. **登录云服务器控制台**
   - 访问您的云服务提供商控制台（如阿里云、腾讯云、AWS 等）

2. **找到安全组设置**
   - 进入"云服务器 ECS"或"实例"页面
   - 找到服务器 `165.154.254.99`
   - 点击"安全组"或"Security Group"

3. **添加入站规则**
   - 点击"添加规则"或"Add Rule"
   - 配置如下：
     - **端口范围**: `3000`
     - **协议**: `TCP`
     - **授权对象**: `0.0.0.0/0`（允许所有 IP 访问）
     - **描述**: `前端服务端口`
   - 保存规则

4. **验证**
   - 等待 1-2 分钟让规则生效
   - 在浏览器访问: http://165.154.254.99:3000

### 方法 2: 使用命令行（如果支持）

某些云服务提供商支持通过 CLI 配置安全组，例如：

```bash
# 阿里云 CLI 示例
aliyun ecs AuthorizeSecurityGroup --SecurityGroupId sg-xxx --IpProtocol tcp --PortRange 3000/3000 --SourceCidrIp 0.0.0.0/0

# AWS CLI 示例
aws ec2 authorize-security-group-ingress --group-id sg-xxx --protocol tcp --port 3000 --cidr 0.0.0.0/0
```

## 当前服务状态

### 后端服务 ✅
- **状态**: Active
- **端口**: 0.0.0.0:8000
- **健康检查**: `{"status":"ok"}`
- **外部访问**: ✅ 正常

### 前端服务 ✅
- **状态**: Active
- **端口**: 0.0.0.0:3000
- **本地访问**: HTTP 200
- **外部访问**: ⚠️ 需要配置安全组

## 验证步骤

配置安全组后，请验证：

1. **检查端口监听**（在服务器上）:
   ```bash
   sudo ss -tlnp | grep :3000
   ```
   应该显示: `LISTEN ... 0.0.0.0:3000`

2. **测试本地访问**（在服务器上）:
   ```bash
   curl http://localhost:3000
   ```
   应该返回 HTML 内容

3. **测试外部访问**（从本地电脑）:
   ```bash
   curl http://165.154.254.99:3000
   ```
   如果配置正确，应该返回 HTML 内容

## 常见问题

### Q: 为什么后端可以访问，前端不行？
A: 因为安全组只开放了 8000 端口，没有开放 3000 端口。

### Q: 配置安全组后多久生效？
A: 通常立即生效，最多 1-2 分钟。

### Q: 如何确认安全组配置正确？
A: 在服务器上运行 `sudo ss -tlnp | grep :3000`，如果显示 `0.0.0.0:3000`，说明服务配置正确。如果外部仍无法访问，就是安全组问题。

## 安全建议

如果只允许特定 IP 访问，可以将安全组的"授权对象"设置为：
- 特定 IP: `your.ip.address/32`
- IP 段: `192.168.1.0/24`

而不是 `0.0.0.0/0`（允许所有 IP）。

