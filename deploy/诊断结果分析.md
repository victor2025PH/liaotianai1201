# è¯Šæ–­ç»“æœåˆ†æ

## ğŸ” å…³é”®å‘ç°

### 1. æœåŠ¡çŠ¶æ€
- âœ… **liaotian-backend.service** - `active, running`ï¼ˆæ­£å¸¸è¿è¡Œï¼‰
- âš ï¸ **admin-backend.service** - `activating auto-restart`ï¼ˆæœ‰é—®é¢˜ï¼Œåœ¨è‡ªåŠ¨é‡å¯ï¼‰
- âœ… **liaotian-frontend.service** - `active, running`ï¼ˆæ­£å¸¸è¿è¡Œï¼‰

### 2. å®é™…è¿è¡Œçš„åç«¯
- **è¿›ç¨‹ï¼š** PID 51991
- **è·¯å¾„ï¼š** `/home/ubuntu/liaotian/admin-backend/`
- **ç«¯å£ï¼š** 8000
- **å‘½ä»¤ï¼š** `/home/ubuntu/liaotian/admin-backend/.venv/bin/python -m uvicorn app.main:app --host 0.0.0.0 --port 8000`

### 3. systemd é…ç½®
- **æœåŠ¡æ–‡ä»¶ï¼š** `/etc/systemd/system/liaotian-backend.service`
- **EnvironmentFileï¼š** `/home/ubuntu/admin-backend/.env`
- **æ³¨æ„ï¼š** systemd é…ç½®çš„ .env è·¯å¾„ä¸å®é™…è¿è¡Œè·¯å¾„ä¸åŒï¼

### 4. é—®é¢˜å‘ç°
- æœ‰å¤šä¸ªé‡å¤çš„ uvicorn è¿›ç¨‹åœ¨ç«¯å£ 8001 è¿è¡Œï¼ˆå¯èƒ½æ˜¯é—®é¢˜ï¼‰
- systemd é…ç½®çš„ .env è·¯å¾„ï¼š`/home/ubuntu/admin-backend/.env`
- å®é™…è¿è¡Œè·¯å¾„ï¼š`/home/ubuntu/liaotian/admin-backend/`

## ğŸ¯ ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šä¿®å¤ systemd é…ç½®çš„ .envï¼ˆæ¨èï¼‰

```bash
# 1. æ£€æŸ¥å¹¶åˆ›å»º/æ›´æ–° .env æ–‡ä»¶
sudo mkdir -p /home/ubuntu/admin-backend
sudo touch /home/ubuntu/admin-backend/.env

# 2. æ·»åŠ  CORS_ORIGINS é…ç½®
echo "CORS_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:5173,http://localhost:8080,http://aikz.usdt2026.cc" | sudo tee -a /home/ubuntu/admin-backend/.env

# 3. å¦‚æœå·²å­˜åœ¨ï¼Œæ›´æ–°
sudo sed -i 's|CORS_ORIGINS=\(.*\)|CORS_ORIGINS=\1,http://aikz.usdt2026.cc|' /home/ubuntu/admin-backend/.env

# 4. é‡å¯æœåŠ¡
sudo systemctl restart liaotian-backend
```

### æ–¹æ¡ˆ 2ï¼šåŒæ—¶æ›´æ–°å®é™…è¿è¡Œè·¯å¾„çš„ .envï¼ˆä¿é™©ï¼‰

```bash
# 1. æ£€æŸ¥å®é™…è·¯å¾„çš„ .env
ls -la /home/ubuntu/liaotian/admin-backend/.env

# 2. å¦‚æœå­˜åœ¨ï¼Œä¹Ÿæ›´æ–°å®ƒ
if [ -f "/home/ubuntu/liaotian/admin-backend/.env" ]; then
    sudo sed -i 's|CORS_ORIGINS=\(.*\)|CORS_ORIGINS=\1,http://aikz.usdt2026.cc|' /home/ubuntu/liaotian/admin-backend/.env
    # æˆ–æ·»åŠ æ–°è¡Œ
    echo "CORS_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:5173,http://localhost:8080,http://aikz.usdt2026.cc" | sudo tee -a /home/ubuntu/liaotian/admin-backend/.env
fi
```

## ğŸ“‹ æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤ 1ï¼šæ£€æŸ¥ .env æ–‡ä»¶

```bash
# æ£€æŸ¥ systemd é…ç½®çš„ .env
ls -la /home/ubuntu/admin-backend/.env

# æ£€æŸ¥å®é™…è¿è¡Œè·¯å¾„çš„ .env
ls -la /home/ubuntu/liaotian/admin-backend/.env

# æŸ¥çœ‹ systemd æœåŠ¡é…ç½®
cat /etc/systemd/system/liaotian-backend.service
```

### æ­¥éª¤ 2ï¼šæ›´æ–° CORS é…ç½®

```bash
# ä½¿ç”¨è‡ªåŠ¨ä¿®å¤è„šæœ¬ï¼ˆæ¨èï¼‰
sudo bash /tmp/ä¿®å¤401è®¤è¯-ç²¾ç¡®è·¯å¾„.sh
```

### æ­¥éª¤ 3ï¼šéªŒè¯ä¿®å¤

```bash
# æ£€æŸ¥é…ç½®
sudo grep CORS_ORIGINS /home/ubuntu/admin-backend/.env
sudo grep CORS_ORIGINS /home/ubuntu/liaotian/admin-backend/.env

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status liaotian-backend

# æ£€æŸ¥åç«¯æ—¥å¿—
sudo journalctl -u liaotian-backend -n 50 | grep -i cors
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è·¯å¾„ä¸ä¸€è‡´é—®é¢˜**
   - systemd é…ç½®æŒ‡å‘ï¼š`/home/ubuntu/admin-backend/.env`
   - å®é™…è¿è¡Œåœ¨ï¼š`/home/ubuntu/liaotian/admin-backend/`
   - éœ€è¦ç¡®ä¿ä¸¤ä¸ªè·¯å¾„çš„é…ç½®éƒ½æ­£ç¡®

2. **å¤šä¸ªé‡å¤è¿›ç¨‹**
   - å‘ç°å¤šä¸ª uvicorn è¿›ç¨‹åœ¨ç«¯å£ 8001 è¿è¡Œ
   - å¯èƒ½å½±å“æ€§èƒ½ï¼Œä½†ç«¯å£ 8000 çš„è¿›ç¨‹æ˜¯æ­£å¸¸çš„

3. **admin-backend æœåŠ¡é—®é¢˜**
   - `admin-backend.service` åœ¨è‡ªåŠ¨é‡å¯
   - å¯èƒ½é…ç½®æœ‰é—®é¢˜ï¼Œä½†ä¸å½±å“å½“å‰ä½¿ç”¨çš„ `liaotian-backend` æœåŠ¡

## ğŸ¯ é¢„æœŸç»“æœ

ä¿®å¤åï¼š
- âœ… CORS_ORIGINS åŒ…å«ç”Ÿäº§åŸŸå
- âœ… åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- âœ… API è¯·æ±‚è¿”å› 200ï¼ˆä¸æ˜¯ 401ï¼‰
- âœ… æµè§ˆå™¨å¯ä»¥æ­£å¸¸è®¿é—®

