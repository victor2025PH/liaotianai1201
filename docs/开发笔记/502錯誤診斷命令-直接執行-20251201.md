# 502 éŒ¯èª¤è¨ºæ–·å‘½ä»¤ï¼ˆç›´æ¥åŸ·è¡Œï¼‰

> **æ—¥æœŸ**: 2025-12-01  
> **è·¯å¾‘**: æ ¹æ“šå¯¦éš›æœå‹™å™¨çµæ§‹

---

## ğŸ” ç«‹å³åŸ·è¡Œè¨ºæ–·

åœ¨æœå‹™å™¨ä¸Šç›´æ¥åŸ·è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆä¸éœ€è¦è…³æœ¬æ–‡ä»¶ï¼‰ï¼š

```bash
echo "=== 502 Bad Gateway è¨ºæ–· ===" && \
echo "" && \
echo "ã€æ­¥é©Ÿ 1ã€‘æª¢æŸ¥å¾Œç«¯æœå‹™ç‹€æ…‹..." && \
if pgrep -f "uvicorn.*app.main:app" > /dev/null; then
    echo "âœ… å¾Œç«¯é€²ç¨‹æ­£åœ¨é‹è¡Œ"
    ps aux | grep "uvicorn.*app.main:app" | grep -v grep
else
    echo "âŒ å¾Œç«¯é€²ç¨‹æœªé‹è¡Œ"
fi && \
echo "" && \
echo "ã€æ­¥é©Ÿ 2ã€‘æª¢æŸ¥ç«¯å£ 8000..." && \
if lsof -i :8000 > /dev/null 2>&1; then
    echo "âœ… ç«¯å£ 8000 æ­£åœ¨ç›£è½"
    lsof -i :8000
else
    echo "âŒ ç«¯å£ 8000 æœªç›£è½"
fi && \
echo "" && \
echo "ã€æ­¥é©Ÿ 3ã€‘æ¸¬è©¦å¾Œç«¯å¥åº·æª¢æŸ¥..." && \
if curl -s http://localhost:8000/health > /dev/null 2>&1; then
    echo "âœ… å¾Œç«¯å¥åº·æª¢æŸ¥é€šé"
    curl -s http://localhost:8000/health
else
    echo "âŒ å¾Œç«¯å¥åº·æª¢æŸ¥å¤±æ•—"
    echo "å˜—è©¦é€£æ¥..."
    curl -v http://localhost:8000/health 2>&1 | head -20
fi && \
echo "" && \
echo "ã€æ­¥é©Ÿ 4ã€‘æª¢æŸ¥ Nginx éŒ¯èª¤æ—¥èªŒ..." && \
if [ -f "/var/log/nginx/error.log" ]; then
    echo "æœ€è¿‘çš„ Nginx éŒ¯èª¤:"
    tail -20 /var/log/nginx/error.log | grep -i "502\|bad gateway\|upstream" || echo "æœªæ‰¾åˆ°ç›¸é—œéŒ¯èª¤"
fi && \
echo "" && \
echo "ã€æ­¥é©Ÿ 5ã€‘æª¢æŸ¥å¾Œç«¯æ—¥èªŒ..." && \
if [ -f "/tmp/backend_final2.log" ]; then
    echo "æœ€è¿‘çš„å¾Œç«¯æ—¥èªŒ:"
    tail -20 /tmp/backend_final2.log
elif [ -f "/tmp/backend.log" ]; then
    echo "æœ€è¿‘çš„å¾Œç«¯æ—¥èªŒ:"
    tail -20 /tmp/backend.log
else
    echo "æœªæ‰¾åˆ°å¾Œç«¯æ—¥èªŒæ–‡ä»¶"
fi
```

---

## ğŸ”§ å¦‚æœå¾Œç«¯æœªé‹è¡Œï¼ŒåŸ·è¡Œä¿®å¾©

```bash
cd /home/ubuntu/liaotian/deployment-package/admin-backend && \
source /home/ubuntu/liaotian/admin-backend/.venv/bin/activate && \
export PYTHONPATH=/home/ubuntu/liaotian/deployment-package && \
export JWT_SECRET='kLZdZJCzq8qev_isfbrxjSshcHGiMDMA8Uok8f55RXc' && \
export ADMIN_DEFAULT_PASSWORD='Along2021!!!' && \
echo "åœæ­¢èˆŠé€²ç¨‹..." && \
pkill -f "uvicorn.*app.main:app" 2>/dev/null || true && \
sleep 2 && \
echo "å•Ÿå‹•å¾Œç«¯æœå‹™..." && \
nohup /home/ubuntu/liaotian/admin-backend/.venv/bin/python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 > /tmp/backend_final2.log 2>&1 & \
sleep 5 && \
echo "æª¢æŸ¥æœå‹™ç‹€æ…‹..." && \
curl http://localhost:8000/health
```

---

## ğŸ“‹ å®Œæ•´è¨ºæ–·å’Œä¿®å¾©ï¼ˆä¸€éµåŸ·è¡Œï¼‰

```bash
echo "=== 502 éŒ¯èª¤è¨ºæ–·å’Œä¿®å¾© ===" && \
echo "" && \
echo "ã€è¨ºæ–·ã€‘æª¢æŸ¥å¾Œç«¯æœå‹™..." && \
if ! pgrep -f "uvicorn.*app.main:app" > /dev/null; then
    echo "âŒ å¾Œç«¯æœªé‹è¡Œï¼Œé–‹å§‹ä¿®å¾©..." && \
    cd /home/ubuntu/liaotian/deployment-package/admin-backend && \
    source /home/ubuntu/liaotian/admin-backend/.venv/bin/activate && \
    export PYTHONPATH=/home/ubuntu/liaotian/deployment-package && \
    export JWT_SECRET='kLZdZJCzq8qev_isfbrxjSshcHGiMDMA8Uok8f55RXc' && \
    export ADMIN_DEFAULT_PASSWORD='Along2021!!!' && \
    pkill -f "uvicorn.*app.main:app" 2>/dev/null || true && \
    sleep 2 && \
    nohup /home/ubuntu/liaotian/admin-backend/.venv/bin/python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 > /tmp/backend_final2.log 2>&1 & \
    sleep 5 && \
    if curl -s http://localhost:8000/health > /dev/null 2>&1; then
        echo "âœ… å¾Œç«¯æœå‹™å·²å•Ÿå‹•"
    else
        echo "âš ï¸ å¾Œç«¯æœå‹™å¯èƒ½å•Ÿå‹•å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ—¥èªŒ: /tmp/backend_final2.log"
    fi
else
    echo "âœ… å¾Œç«¯æœå‹™æ­£åœ¨é‹è¡Œ"
    if curl -s http://localhost:8000/health > /dev/null 2>&1; then
        echo "âœ… å¾Œç«¯å¥åº·æª¢æŸ¥é€šé"
    else
        echo "âš ï¸ å¾Œç«¯é€²ç¨‹å­˜åœ¨ä½†ç„¡æ³•éŸ¿æ‡‰ï¼Œå¯èƒ½éœ€è¦é‡å•Ÿ"
    fi
fi && \
echo "" && \
echo "ã€é©—è­‰ã€‘æœ€çµ‚æª¢æŸ¥..." && \
if curl -s http://localhost:8000/health > /dev/null 2>&1; then
    echo "âœ… å¾Œç«¯æœå‹™æ­£å¸¸"
    echo ""
    echo "å¦‚æœç¶²é ä»é¡¯ç¤º 502ï¼Œè«‹æª¢æŸ¥ï¼š"
    echo "1. Nginx é…ç½®: sudo grep -A 5 'proxy_pass' /etc/nginx/sites-enabled/default"
    echo "2. é‡è¼‰ Nginx: sudo nginx -s reload"
else
    echo "âŒ å¾Œç«¯æœå‹™ä»æœ‰å•é¡Œ"
    echo "æŸ¥çœ‹æ—¥èªŒ: tail -50 /tmp/backend_final2.log"
fi
```

---

**ç›´æ¥è¤‡è£½ä¸Šè¿°å‘½ä»¤åœ¨æœå‹™å™¨ä¸ŠåŸ·è¡Œå³å¯ï¼**
