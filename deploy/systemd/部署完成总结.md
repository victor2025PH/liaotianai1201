# éƒ¨ç½²å®Œæˆæ€»ç»“

**æ‰§è¡Œæ—¶é—´**: 2025-01-23

## âœ… å·²å®Œæˆçš„ä»»åŠ¡

### 1. Node.js å‡çº§ âœ…
- **çŠ¶æ€**: å·²å®Œæˆ
- **ç‰ˆæœ¬**: ä» `18.19.1` å‡çº§åˆ° `v20.19.6`
- **æ–¹æ³•**: ä½¿ç”¨ nvm å®‰è£… Node.js 20

### 2. åç«¯ç¯å¢ƒå˜é‡é…ç½® âœ…
- **çŠ¶æ€**: å·²å®Œæˆ
- **æ–‡ä»¶**: `/home/ubuntu/admin-backend/.env`
- **æ³¨æ„**: å·²åˆ›å»ºåŸºæœ¬é…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®æ•°æ®åº“è¿æ¥å’Œå¯†é’¥

### 3. å‰ç«¯ç¯å¢ƒå˜é‡é…ç½® âœ…
- **çŠ¶æ€**: å·²å®Œæˆ
- **æ–‡ä»¶**: `/home/ubuntu/saas-demo/.env.local`
- **API åœ°å€**: `http://165.154.254.99:8000/api/v1`

### 4. å‰ç«¯æ„å»º âœ…
- **çŠ¶æ€**: å·²å®Œæˆ
- **æ„å»ºç›®å½•**: `/home/ubuntu/saas-demo/.next`
- **æ³¨æ„**: éœ€è¦é‡æ–°æ„å»ºä»¥ç”Ÿæˆ BUILD_ID

### 5. Systemd æœåŠ¡é…ç½® âœ…
- **çŠ¶æ€**: å·²å®Œæˆ
- **åç«¯æœåŠ¡**: `/etc/systemd/system/smart-tg-backend.service`
- **å‰ç«¯æœåŠ¡**: `/etc/systemd/system/smart-tg-frontend.service`

## âš ï¸ å¾…å®Œæˆçš„ä»»åŠ¡

### 1. ä¸Šä¼ å®Œæ•´çš„åç«¯ä»£ç 
- **é—®é¢˜**: `app` ç›®å½•ä¸å­˜åœ¨
- **è§£å†³æ–¹æ¡ˆ**: éœ€è¦ä¸Šä¼ å®Œæ•´çš„åç«¯ä»£ç 

**ä¸Šä¼ å‘½ä»¤**:
```bash
# ä»æœ¬åœ°æœºå™¨æ‰§è¡Œ
cd "E:\002-å·¥ä½œæ–‡ä»¶\é‡è¦ç¨‹åº\èŠå¤©AIç¾¤èŠç¨‹åº"
scp -r admin-backend/* ubuntu@165.154.254.99:/home/ubuntu/admin-backend/
```

æˆ–è€…ä½¿ç”¨ PowerShell (å¦‚æœå®‰è£…äº† Posh-SSH):
```powershell
$session = New-SSHSession -ComputerName "165.154.254.99" -Credential (Get-Credential)
$files = Get-ChildItem -Path "admin-backend" -Recurse -File
foreach ($file in $files) {
    $remotePath = $file.FullName.Replace((Get-Location).Path + "\", "").Replace("\", "/")
    Set-SCPFile -SessionId $session.SessionId -LocalFile $file.FullName -RemotePath "/home/ubuntu/$remotePath"
}
```

### 2. é‡æ–°æ„å»ºå‰ç«¯
- **é—®é¢˜**: `.next/BUILD_ID` æ–‡ä»¶ç¼ºå¤±
- **è§£å†³æ–¹æ¡ˆ**: é‡æ–°æ‰§è¡Œæ„å»º

**æ„å»ºå‘½ä»¤**:
```bash
ssh ubuntu@165.154.254.99
cd /home/ubuntu/saas-demo
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"
nvm use 20
npm run build
```

### 3. é…ç½®åç«¯æ•°æ®åº“
- **æ–‡ä»¶**: `/home/ubuntu/admin-backend/.env`
- **éœ€è¦é…ç½®**:
  - `DATABASE_URL`: PostgreSQL æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
  - `SECRET_KEY`: å®‰å…¨å¯†é’¥ï¼ˆç”¨äº JWT ç­‰ï¼‰
  - `REDIS_URL`: Redis è¿æ¥ï¼ˆå¦‚æœä½¿ç”¨ï¼‰

### 4. å¯åŠ¨æœåŠ¡
- **å¯åŠ¨å‘½ä»¤**:
```bash
sudo systemctl start smart-tg-backend
sudo systemctl start smart-tg-frontend
sudo systemctl enable smart-tg-backend
sudo systemctl enable smart-tg-frontend
```

## ğŸ“‹ å¿«é€Ÿå®Œæˆéƒ¨ç½²æ¸…å•

1. âœ… å‡çº§ Node.js åˆ° 20.x
2. âœ… é…ç½®åç«¯ .env æ–‡ä»¶
3. âœ… é…ç½®å‰ç«¯ .env.local æ–‡ä»¶
4. â³ ä¸Šä¼ å®Œæ•´çš„åç«¯ä»£ç 
5. â³ é‡æ–°æ„å»ºå‰ç«¯
6. â³ é…ç½®æ•°æ®åº“è¿æ¥
7. â³ å¯åŠ¨æœåŠ¡

## ğŸ”§ æœåŠ¡ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status smart-tg-backend
sudo systemctl status smart-tg-frontend

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u smart-tg-backend -f
sudo journalctl -u smart-tg-frontend -f

# é‡å¯æœåŠ¡
sudo systemctl restart smart-tg-backend
sudo systemctl restart smart-tg-frontend

# åœæ­¢æœåŠ¡
sudo systemctl stop smart-tg-backend
sudo systemctl stop smart-tg-frontend
```

## ğŸŒ è®¿é—®åœ°å€

- **åç«¯ API**: http://165.154.254.99:8000
- **å‰ç«¯ç•Œé¢**: http://165.154.254.99:3000
- **API æ–‡æ¡£**: http://165.154.254.99:8000/docs

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **åç«¯ä»£ç **: ç¡®ä¿ä¸Šä¼ å®Œæ•´çš„ `admin-backend` ç›®å½•ï¼ŒåŒ…æ‹¬ `app` ç›®å½•åŠå…¶æ‰€æœ‰æ–‡ä»¶
2. **æ•°æ®åº“**: éœ€è¦å…ˆé…ç½®å¹¶å¯åŠ¨ PostgreSQL æ•°æ®åº“
3. **é˜²ç«å¢™**: ç¡®ä¿æœåŠ¡å™¨é˜²ç«å¢™å¼€æ”¾ 8000 å’Œ 3000 ç«¯å£
4. **æƒé™**: ç¡®ä¿æœåŠ¡ç”¨æˆ·ï¼ˆubuntuï¼‰æœ‰æƒé™è®¿é—®æ‰€æœ‰å¿…è¦çš„ç›®å½•å’Œæ–‡ä»¶

