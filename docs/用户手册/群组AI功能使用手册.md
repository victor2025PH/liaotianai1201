# 群组 AI 功能使用手册

## 目录

1. [概述](#概述)
2. [快速开始](#快速开始)
3. [账号管理](#账号管理)
4. [剧本管理](#剧本管理)
5. [角色分配](#角色分配)
6. [功能串联使用流程](#功能串联使用流程)
7. [常见问题](#常见问题)

---

## 概述

群组 AI 系统是一个完整的 Telegram 群组自动化管理平台，包含三个核心功能模块：

- **账号管理**：管理 Telegram 账号的创建、启动、停止和配置
- **剧本管理**：创建和管理 AI 对话剧本
- **角色分配**：为账号分配剧本中的角色

### 系统架构

```
Session 文件 → 账号管理 → 剧本管理 → 角色分配 → 运行
```

---

## 快速开始

### 第一步：准备 Session 文件

1. 将您的 Telegram `.session` 文件放置在项目的 `sessions` 目录中
2. 确保文件格式正确（`.session` 扩展名）

### 第二步：扫描 Session 文件

1. 进入「群组 AI」→「账号管理」页面
2. 点击「扫描 Session」按钮
3. 系统会自动扫描 `sessions` 目录中的所有 `.session` 文件
4. 扫描成功后，会显示找到的文件数量

### 第三步：创建账号

1. 点击「添加账号」按钮
2. 填写以下信息：
   - **账号 ID**：自定义的账号标识符
   - **Session 文件**：从下拉列表中选择已扫描的 Session 文件
   - **剧本 ID**：选择要使用的剧本（如果还没有剧本，请先创建）
3. 点击「创建」完成账号创建

---

## 账号管理

### 功能概述

账号管理是系统的核心模块，用于管理所有 Telegram AI 账号。

### 主要功能

#### 1. 扫描 Session 文件

- **位置**：账号管理页面顶部工具栏
- **功能**：扫描 `sessions` 目录中的所有 `.session` 文件
- **显示**：扫描成功后，会在页面上显示「可用的 Session 文件」卡片，列出所有找到的文件

#### 2. 上传 Session 文件

- **位置**：创建账号对话框中的「上传 Session」按钮
- **功能**：上传新的 `.session` 文件到系统
- **限制**：
  - 只支持 `.session` 文件
  - 文件大小不超过 10MB

#### 3. 创建账号

**步骤**：

1. 点击「添加账号」按钮
2. 填写必填信息：
   - **账号 ID**：唯一标识符（建议使用有意义的名称）
   - **Session 文件**：
     - 从下拉列表选择已扫描的文件
     - 或点击「上传 Session」上传新文件
     - 或手动输入文件名
   - **剧本 ID**：
     - 从下拉列表选择已创建的剧本
     - 或点击「管理剧本」快速跳转到剧本管理页面
     - 或手动输入剧本 ID
3. 点击「创建」按钮

**注意事项**：
- 所有标记为 `*` 的字段都是必填项
- 账号 ID 必须唯一
- Session 文件必须存在于 `sessions` 目录中

#### 4. 启动/停止账号

- **启动账号**：点击账号列表中的「播放」按钮（▶️）
- **停止账号**：点击账号列表中的「停止」按钮（⏹️）
- **状态显示**：账号状态会实时更新（online/offline/error）

#### 5. 账号设置

- **位置**：账号列表操作栏中的「设置」按钮（⚙️）
- **功能**：配置账号的运行参数
  - 回复率
  - 红包功能开关
  - 红包概率
  - 每小时最大回复数
  - 最小回复间隔

#### 6. 角色分配

- **位置**：账号列表操作栏中的「角色分配」按钮（👥）
- **功能**：快速跳转到角色分配页面，为该账号分配角色

#### 7. 删除账号

- **位置**：账号列表操作栏中的「删除」按钮（🗑️）
- **功能**：删除不需要的账号
- **注意**：删除操作无法撤销，请谨慎操作

### 界面说明

#### 可用的 Session 文件卡片

当扫描到 Session 文件后，会在账号列表上方显示一个卡片：

- **标题**：可用的 Session 文件
- **文件数量**：显示找到的文件总数
- **文件列表**：以网格形式显示所有可用的 Session 文件
  - 文件名
  - 文件大小（KB）

#### 账号列表

显示所有已创建的账号，包含以下信息：

- **账号 ID**：账号的唯一标识符
- **状态**：当前运行状态（online/offline/error）
- **Session 文件**：使用的 Session 文件名
- **剧本**：绑定的剧本 ID
- **群组数**：加入的群组数量
- **消息数**：处理的消息总数
- **回复数**：发送的回复总数
- **操作**：各种操作按钮

---

## 剧本管理

### 功能概述

剧本管理用于创建和管理 AI 对话剧本，定义 AI 在群组中的行为和回应逻辑。

### 主要功能

#### 1. 创建剧本

**步骤**：

1. 点击「创建剧本」按钮
2. 填写剧本信息：
   - **剧本 ID**：唯一标识符
   - **名称**：剧本的显示名称
   - **版本**：剧本版本号（如：1.0）
   - **描述**：剧本的说明文字
   - **YAML 内容**：剧本的 YAML 配置内容
3. 点击「创建」完成

#### 2. 编辑剧本

- 点击剧本列表中的「编辑」按钮
- 修改剧本内容
- 保存更改

#### 3. 测试剧本

- 点击剧本列表中的「测试」按钮
- 输入测试消息
- 查看 AI 的回应结果

#### 4. 删除剧本

- 点击剧本列表中的「删除」按钮
- 确认删除操作

**注意**：删除剧本前，请确保没有账号正在使用该剧本。

### 剧本格式

剧本使用 YAML 格式，定义 AI 的行为规则、回应模板和角色设定。

---

## 角色分配

### 功能概述

角色分配用于为账号分配剧本中定义的角色，实现多账号协同工作。

### 主要功能

#### 1. 选择剧本

- 从下拉列表中选择要使用的剧本
- 系统会自动加载该剧本的所有角色

#### 2. 提取角色

- 点击「提取角色」按钮
- 系统会从选定的剧本中提取所有角色定义
- 显示角色列表和总数

#### 3. 选择账号

- 从账号列表中选择要分配角色的账号
- 可以选择多个账号

#### 4. 创建分配方案

**分配模式**：

- **自动分配**：系统自动为账号分配角色
- **手动分配**：手动为每个账号指定角色

**步骤**：

1. 选择分配模式
2. 如果选择手动分配，为每个账号选择对应的角色
3. 点击「创建分配方案」按钮
4. 查看生成的分配方案

#### 5. 应用分配

- 查看分配方案预览
- 确认无误后，点击「应用分配」按钮
- 系统会将角色分配应用到选定的账号

---

## 功能串联使用流程

### 完整工作流程

#### 场景：从零开始设置一个新的 AI 账号

**步骤 1：准备 Session 文件**
```
1. 将 .session 文件放入 sessions 目录
2. 进入「账号管理」页面
3. 点击「扫描 Session」按钮
4. 确认文件已扫描成功
```

**步骤 2：创建剧本（如果还没有）**
```
1. 进入「剧本管理」页面
2. 点击「创建剧本」按钮
3. 填写剧本信息并保存
4. 记下剧本 ID
```

**步骤 3：创建账号**
```
1. 返回「账号管理」页面
2. 点击「添加账号」按钮
3. 填写账号信息：
   - 账号 ID：my_account_1
   - Session 文件：从下拉列表选择
   - 剧本 ID：从下拉列表选择（或手动输入）
4. 点击「创建」
```

**步骤 4：配置账号参数（可选）**
```
1. 在账号列表中，点击「设置」按钮
2. 调整运行参数
3. 保存设置
```

**步骤 5：分配角色（如果需要）**
```
1. 在账号列表中，点击「角色分配」按钮
2. 或直接进入「角色分配」页面
3. 选择剧本
4. 提取角色
5. 选择账号
6. 创建并应用分配方案
```

**步骤 6：启动账号**
```
1. 在账号列表中，点击「启动」按钮（▶️）
2. 等待账号状态变为「online」
3. 账号开始运行
```

### 快速操作路径

#### 从账号管理到剧本管理

- **方法 1**：在创建账号对话框中，点击「管理剧本」按钮
- **方法 2**：从侧边栏导航到「剧本管理」

#### 从账号管理到角色分配

- **方法 1**：在账号列表中，点击「角色分配」按钮（👥）
- **方法 2**：从侧边栏导航到「角色分配」页面，然后选择账号

#### 从剧本管理到账号管理

- 从侧边栏导航到「账号管理」
- 在创建账号时，可以选择刚创建的剧本

---

## 常见问题

### Q1: 扫描 Session 文件时显示「未找到文件」

**可能原因**：
- Session 文件不在 `sessions` 目录中
- 文件扩展名不是 `.session`
- 文件路径配置错误

**解决方法**：
1. 确认文件已放置在项目的 `sessions` 目录中
2. 检查文件扩展名是否为 `.session`
3. 重新点击「扫描 Session」按钮

### Q2: 创建账号时无法选择 Session 文件

**可能原因**：
- 还没有扫描 Session 文件
- Session 文件列表为空

**解决方法**：
1. 先点击「扫描 Session」按钮
2. 或点击「上传 Session」上传新文件
3. 或手动输入 Session 文件名

### Q3: 创建账号时无法选择剧本

**可能原因**：
- 还没有创建任何剧本
- 剧本列表加载失败

**解决方法**：
1. 先进入「剧本管理」页面创建剧本
2. 或点击「管理剧本」按钮快速跳转
3. 或手动输入剧本 ID

### Q4: 账号无法启动

**可能原因**：
- Session 文件无效或已过期
- 剧本配置错误
- 网络连接问题

**解决方法**：
1. 检查 Session 文件是否有效
2. 检查剧本配置是否正确
3. 查看系统日志了解详细错误信息

### Q5: 如何删除账号？

**步骤**：
1. 在账号列表中，找到要删除的账号
2. 点击「删除」按钮（🗑️）
3. 在确认对话框中点击「确认」
4. 账号将被永久删除

**注意**：删除操作无法撤销，请谨慎操作。

### Q6: 如何为多个账号分配角色？

**步骤**：
1. 进入「角色分配」页面
2. 选择剧本并提取角色
3. 在账号列表中选择多个账号（勾选复选框）
4. 选择分配模式（自动或手动）
5. 创建并应用分配方案

### Q7: 账号状态一直显示「offline」

**可能原因**：
- 账号未启动
- 启动过程中出现错误

**解决方法**：
1. 点击「启动」按钮启动账号
2. 查看系统日志了解启动失败的原因
3. 检查 Session 文件和剧本配置

---

## 最佳实践

### 1. 命名规范

- **账号 ID**：使用有意义的名称，如 `account_001`、`bot_main`
- **剧本 ID**：使用描述性名称，如 `default`、`customer_service`
- **Session 文件**：使用账号相关的名称，如 `123456789.session`

### 2. 工作流程建议

1. **先创建剧本**：在创建账号前，先准备好要使用的剧本
2. **批量扫描**：一次性扫描所有 Session 文件
3. **测试后启动**：创建账号后，先测试功能，确认无误后再启动
4. **定期检查**：定期检查账号状态和运行日志

### 3. 安全建议

- 妥善保管 Session 文件，不要泄露
- 定期备份账号配置
- 使用强密码保护系统访问

---

## 技术支持

如遇到问题，请：

1. 查看系统日志了解详细错误信息
2. 检查浏览器控制台是否有错误
3. 确认所有服务正常运行
4. 联系技术支持团队

---


