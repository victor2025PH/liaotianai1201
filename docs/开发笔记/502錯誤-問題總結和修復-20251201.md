# 502 錯誤 - 問題總結和修復

> **日期**: 2025-12-01  
> **根本原因**: 前端服務（3000端口）未運行

---

## 📊 問題分析

### 當前狀況

- ✅ **後端服務**: 正常運行（8000端口）
- ❌ **前端服務**: 未運行（3000端口）
- ✅ **Nginx 配置**: 正確

### 錯誤原因

1. 訪問 `/` 或 `/health` 時，Nginx 路由到前端（3000端口）
2. 前端服務未運行，導致 502 錯誤
3. 錯誤日誌顯示：`connect() failed (111: Connection refused) while connecting to upstream, upstream: "http://127.0.0.1:3000/"`

---

## 🔧 修復方案

### 立即執行：啟動前端服務

```bash
cd /home/ubuntu/liaotian/deployment-package/saas-demo && \
if [ -f "package.json" ]; then
    echo "停止舊進程..." && \
    pkill -f "node.*next\|npm.*dev" 2>/dev/null || true && \
    sleep 2 && \
    echo "啟動前端服務..." && \
    nohup npm run dev > /tmp/frontend.log 2>&1 & \
    sleep 8 && \
    if lsof -i :3000 > /dev/null 2>&1; then
        echo "✅ 前端服務已啟動"
        echo "測試: curl http://127.0.0.1:3000"
    else
        echo "⚠️ 前端服務啟動失敗，查看日誌:"
        tail -30 /tmp/frontend.log
    fi
else
    echo "❌ 前端項目不存在"
    find /home/ubuntu/liaotian -name "package.json" -path "*/saas-demo/*" 2>/dev/null | head -3
fi
```

---

## ✅ 驗證修復

啟動前端服務後，執行：

```bash
echo "=== 驗證服務狀態 ===" && \
echo "【1】後端服務（8000）:" && \
curl -s http://127.0.0.1:8000/health && echo " ✅" || echo " ❌" && \
echo "【2】前端服務（3000）:" && \
curl -s http://127.0.0.1:3000 | head -1 && echo " ✅" || echo " ❌" && \
echo "【3】通過 Nginx 訪問:" && \
curl -s -H "Host: aikz.usdt2026.cc" http://127.0.0.1/ | head -1 && echo " ✅" || echo " ❌"
```

---

**執行啟動前端服務的命令，然後刷新網頁測試！**
