# 服务器账号自动聊天功能完整说明

> **更新时间**: 2025-01-21

---

## 📋 功能说明

### 工作原理

1. **服务器上的main.py**
   - 在服务器上运行，使用session文件连接Telegram
   - 监听群组消息
   - 根据剧本自动回复

2. **群组创建**
   - 通过后端API创建群组
   - 账号加入群组
   - 启动自动聊天功能

3. **自动回复**
   - 服务器上的main.py接收群组消息
   - 根据剧本匹配场景
   - 自动生成并发送回复

---

## ✅ 当前状态

### 已完成
- ✅ 群组已创建（群组ID: -4994741044）
- ✅ 自动聊天功能已启动
- ✅ 剧本已加载（default剧本）

### 当前问题
- ⚠️ 服务器上的main.py因AUTH_KEY_DUPLICATED无法启动
- ⚠️ 本地AccountManager中的账号已停止

---

## 🔍 验证方法

### 方法1: 在Telegram客户端中验证（最直接）

**步骤**:
1. 打开Telegram客户端
2. 查找群组 "测试群组 - 自动聊天功能测试"
3. 向群组发送消息（例如: "你好"）
4. 观察是否收到自动回复

**预期结果**:
- 如果账号在线，应该收到自动回复
- 回复内容根据default剧本:
  - 包含"你好"/"hello"/"hi" → "你好！很高兴认识你。"
  - 其他消息 → "谢谢你的消息！"（50%概率）

### 方法2: 检查服务器日志

**步骤**:
1. SSH连接到服务器
2. 查看日志: `/home/ubuntu/logs/main_639641837416.log`
3. 查找消息接收和回复记录

---

## 💡 解决方案

### 方案1: 使用本地AccountManager（当前）

- 重新启动本地AccountManager中的账号
- 账号应该能够处理群组消息并自动回复

### 方案2: 等待并重启服务器账号

- 等待更长时间让Telegram释放session
- 重新启动服务器上的main.py
- 服务器账号处理群组消息

---

## 📝 重要说明

### 账号运行位置

- **本地AccountManager**: 账号在本地后端服务中运行
- **服务器main.py**: 账号在服务器上通过main.py运行
- **两者不能同时使用同一个session文件**

### 当前配置

- 群组是通过本地AccountManager中的账号创建的
- 因此应该使用本地AccountManager中的账号来处理群组消息
- 需要确保本地账号在线

---

**最后更新**: 2025-01-21  
**测试状态**: ⏳ **等待账号在线后验证自动回复功能**

