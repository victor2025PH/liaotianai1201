# 需要更新服務器代碼

> **日期**: 2025-12-01  
> **問題**: 測試仍返回 404，說明服務器運行的是舊代碼

---

## 🔍 問題診斷

**測試結果**:
- HTTP 狀態碼: **404**
- 錯誤信息: "帳號 639454959591 不存在"

**說明**: 服務器上運行的代碼**還沒有包含修復**，需要：
1. 檢查服務器代碼是否包含修復
2. 如果不包含，需要部署新代碼
3. 重啟後端服務

---

## 🔧 解決方案

### 步驟 1: 檢查服務器代碼是否包含修復

檢查服務器上的代碼文件：

```bash
# 檢查 get_account_status 函數是否包含數據庫檢查
grep -A 10 "檢查數據庫（包含遠程服務器賬號）" /home/ubuntu/liaotian/admin-backend/app/api/group_ai/accounts.py 2>/dev/null || \
grep -A 10 "檢查數據庫（包含遠程服務器賬號）" /home/ubuntu/admin-backend/app/api/group_ai/accounts.py 2>/dev/null
```

**如果找到該註釋** → 代碼已更新，需要重啟服務  
**如果找不到** → 代碼未更新，需要部署新代碼

---

### 步驟 2: 如果代碼已更新，重啟服務

```bash
# 找到後端進程
ps aux | grep uvicorn | grep -v grep

# 停止進程
pkill -f "uvicorn.*app.main:app"

# 進入後端目錄並重啟
cd /home/ubuntu/liaotian/admin-backend  # 或實際運行中的目錄
source ../.venv/bin/activate 2>/dev/null || source .venv/bin/activate 2>/dev/null
nohup python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 > /tmp/backend.log 2>&1 &
sleep 5

# 驗證
curl http://localhost:8000/health
```

---

### 步驟 3: 如果代碼未更新，需要部署

需要將修復的代碼從本地推送到服務器。有兩種方式：

**方式 1: 使用 Git（如果服務器代碼在 Git 倉庫中）**

```bash
cd /home/ubuntu/liaotian/admin-backend  # 或實際目錄
git pull origin main  # 或 master
```

**方式 2: 手動上傳文件**

需要將本地的 `admin-backend/app/api/group_ai/accounts.py` 文件上傳到服務器替換舊文件。

---

## 🚀 立即檢查

執行以下命令檢查代碼：

```bash
# 檢查哪個目錄是實際運行的
ps aux | grep uvicorn | grep -v grep

# 檢查該目錄的代碼
grep -n "檢查數據庫（包含遠程服務器賬號）" /home/ubuntu/liaotian/admin-backend/app/api/group_ai/accounts.py 2>/dev/null || \
grep -n "檢查數據庫（包含遠程服務器賬號）" /home/ubuntu/admin-backend/app/api/group_ai/accounts.py 2>/dev/null || \
echo "代碼未更新"
```

---

**先執行檢查命令，告訴我結果！**
