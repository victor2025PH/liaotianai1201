# 智能格式转换功能使用指南

## 功能简介

智能格式转换功能是一个AI驱动的工具，可以自动将旧格式的剧本YAML转换为新格式，同时支持内容优化和多格式文件上传。

## 快速开始

### 方式一：直接粘贴转换

1. **打开剧本创建页面**
   - 访问：http://localhost:3000/group-ai/scripts
   - 点击「创建剧本」按钮

2. **粘贴旧格式YAML**
   - 在「YAML 内容」文本框中粘贴旧格式内容
   - 例如：
   ```yaml
   - step: 9
     actor: siya
     action: speak
     lines:
       - 好的,那什么时候开始啊?
   ```

3. **点击「智能转换」**
   - 系统自动识别格式并转换
   - 转换后的内容自动填充到表单

4. **确认并创建**
   - 检查转换结果
   - 点击「创建」按钮保存

### 方式二：文件上传转换

1. **准备文件**
   - 准备YAML文件（.yaml, .yml）
   - 或文本文件（.txt, .md, .json）

2. **上传文件**
   - 点击「上传文件」按钮
   - 选择文件（最大10MB）

3. **智能转换**
   - 文件内容自动填充到文本框
   - 点击「智能转换」进行转换

4. **创建剧本**
   - 确认转换结果
   - 点击「创建」保存

## 功能详解

### 1. 智能转换

**功能**：将旧格式YAML自动转换为新格式

**使用场景**：
- 您有旧格式的剧本文件
- 需要批量转换多个剧本
- 不确定新格式的具体结构

**转换示例**：

**旧格式**：
```yaml
- step: 9
  actor: siya
  action: speak
  delay_after: 2
  lines:
    - 好的,那什么时候开始啊?
- step: 10
  actor: huge
  action: speak
  lines:
    - 我们需要诚信做关注活动的
```

**转换后**：
```yaml
script_id: converted_script
version: 1.0
description: 转换自旧格式
scenes:
  - id: scene_9
    triggers:
      - type: message
    responses:
      - template: "好的,那什么时候开始啊?"
  - id: scene_10
    triggers:
      - type: message
    responses:
      - template: "我们需要诚信做关注活动的"
```

### 2. 内容优化

**功能**：使用AI优化YAML内容的语法、表达和结构

**优化类型**：
- **全部优化**：语法纠正 + 表达润色 + 结构调整
- **语法纠正**：修正语法错误和拼写错误
- **表达润色**：优化表达方式，使其更自然流畅
- **结构调整**：优化场景顺序和逻辑关系

**使用步骤**：
1. 输入或粘贴YAML内容
2. 点击「内容优化」按钮
3. 等待优化完成
4. 查看优化后的内容

### 3. 文件上传

**支持格式**：
- YAML文件（.yaml, .yml）
- 文本文件（.txt）
- Markdown文件（.md）
- JSON文件（.json）

**文件限制**：
- 最大文件大小：10MB
- 编码：UTF-8

**上传步骤**：
1. 点击「上传文件」按钮
2. 选择文件
3. 文件内容自动读取到文本框
4. 进行转换或优化

## 用户交互流程

```
┌─────────────────────────────────────┐
│  打开剧本创建页面                    │
└──────────────┬──────────────────────┘
               │
               ▼
    ┌──────────────────────┐
    │ 选择输入方式          │
    └───┬──────────────┬───┘
        │              │
        ▼              ▼
  直接粘贴        上传文件
        │              │
        └──────┬───────┘
               │
               ▼
    ┌──────────────────────┐
    │ 点击「智能转换」      │
    └──────────┬───────────┘
               │
               ▼
    ┌──────────────────────┐
    │ AI分析并转换格式      │
    └──────────┬───────────┘
               │
               ▼
    ┌──────────────────────┐
    │ 显示转换结果          │
    └──────────┬───────────┘
               │
               ▼
    ┌──────────────────────┐
    │ 可选：内容优化        │
    └──────────┬───────────┘
               │
               ▼
    ┌──────────────────────┐
    │ 用户确认并创建        │
    └──────────────────────┘
```

## 功能需求详细说明

### 1. 文件格式支持

#### 当前支持
- ✅ YAML (.yaml, .yml) - 完整支持
- ✅ 文本 (.txt) - 基础支持
- ✅ Markdown (.md) - 基础支持
- ✅ JSON (.json) - 基础支持

#### 计划支持
- ⏳ DOCX - 需要解析Word文档
- ⏳ PDF - 需要OCR识别
- ⏳ HTML - 需要提取文本内容

### 2. AI能力范围

#### 格式转换能力
- ✅ 识别旧格式结构
- ✅ 转换为新格式结构
- ✅ 保持语义完整性
- ✅ 自动生成场景ID
- ✅ 智能生成触发条件

#### 内容优化能力
- ✅ 语法纠正
- ✅ 表达润色
- ✅ 结构调整
- ✅ 变量提取

#### 智能分析能力
- ✅ 结构分析
- ✅ 逻辑验证
- ✅ 重复检测
- ✅ 元数据生成

### 3. 用户界面反馈

#### 实时状态显示
- 转换中：显示「转换中...」状态
- 优化中：显示「优化中...」状态
- 成功：显示成功提示和场景数量
- 失败：显示详细错误信息

#### 预览功能
- 转换结果自动填充到表单
- 可以随时编辑修改
- 支持撤销操作

### 4. 数据安全和隐私保护

#### 安全措施
- ✅ 临时文件自动清理
- ✅ HTTPS加密传输
- ✅ API密钥安全存储
- ✅ 文件大小限制（10MB）

#### 隐私保护
- ✅ 不存储用户数据
- ✅ 不用于模型训练
- ✅ 处理完成后立即清除

## 常见问题

### Q1: 转换失败怎么办？
**A**: 
1. 检查YAML格式是否正确
2. 确保内容不为空
3. 查看错误提示信息
4. 如果AI服务不可用，系统会自动使用规则转换

### Q2: 支持哪些文件格式？
**A**: 当前主要支持YAML格式的自动转换。其他格式（TXT、MD、JSON）可以上传，但需要手动检查内容。

### Q3: 文件大小有限制吗？
**A**: 是的，文件大小限制为10MB。如果文件过大，请分割处理。

### Q4: 转换需要多长时间？
**A**: 
- 规则转换：几乎即时（<1秒）
- AI转换：通常5-15秒，取决于内容长度

### Q5: 转换后可以修改吗？
**A**: 可以。转换后的内容会填充到表单中，您可以随时编辑修改。

### Q6: 优化功能会改变内容吗？
**A**: 优化主要针对语法、表达和结构，不会改变核心语义。您可以在优化前后对比查看。

## 最佳实践

1. **备份原始文件**：转换前建议备份原始文件
2. **逐步转换**：对于复杂剧本，建议分步骤转换
3. **检查结果**：转换后务必检查结果，确保符合预期
4. **使用优化**：转换后可以使用优化功能进一步改进
5. **保存模板**：常用的转换结果可以保存为模板

## 技术支持

如遇到问题，请：
1. 查看错误提示信息
2. 检查文档格式是否正确
3. 确认OpenAI API密钥已配置
4. 查看系统日志获取详细信息

---

**状态**: ✅ 功能已完整实现并可用

