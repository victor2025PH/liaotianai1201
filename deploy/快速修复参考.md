# 快速修复参考卡片

## 快速命令（在服务器上执行）

```bash
# 1. 登录服务器
ssh ubuntu@165.154.233.55

# 2. 执行修复（复制粘贴以下全部命令）
cd /home/ubuntu/liaotian/saas-demo && \
sudo systemctl stop liaotian-frontend && \
export NVM_DIR="$HOME/.nvm" && \
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh" && \
nvm use 20 && \
rm -rf .next node_modules/.cache && \
npm run build && \
test -f .next/BUILD_ID && echo "✓ 构建成功" || echo "✗ 构建失败" && \
sudo systemctl daemon-reload && \
sudo systemctl start liaotian-frontend && \
sleep 5 && \
sudo systemctl status liaotian-frontend --no-pager | head -20
```

## 分步执行（推荐）

### 步骤1：登录并准备
```bash
ssh ubuntu@165.154.233.55
cd /home/ubuntu/liaotian/saas-demo
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"
nvm use 20
```

### 步骤2：停止服务
```bash
sudo systemctl stop liaotian-frontend
```

### 步骤3：清理并构建
```bash
rm -rf .next node_modules/.cache
npm run build
```

### 步骤4：验证构建
```bash
test -f .next/BUILD_ID && echo "构建成功" || echo "构建失败"
```

### 步骤5：启动服务
```bash
sudo systemctl daemon-reload
sudo systemctl start liaotian-frontend
sleep 5
sudo systemctl status liaotian-frontend
```

## 检查清单

- [ ] 服务状态：`active (running)`
- [ ] 构建成功：`.next/BUILD_ID` 存在
- [ ] 端口监听：`netstat -tlnp | grep :3000`
- [ ] 浏览器访问：不再显示502错误

## 常见问题快速解决

### 问题1：构建失败
```bash
# 查看错误
npm run build 2>&1 | grep -i error

# 重新安装依赖
rm -rf node_modules
npm install
npm run build
```

### 问题2：服务无法启动
```bash
# 查看日志
sudo journalctl -u liaotian-frontend -n 50 --no-pager

# 检查构建
test -f .next/BUILD_ID || echo "需要重新构建"
```

### 问题3：端口未监听
```bash
# 检查端口
sudo netstat -tlnp | grep :3000

# 检查进程
ps aux | grep node
```

## 详细指南

完整的手动修复步骤请参考：`deploy/详细手动修复指南.md`

