# ğŸš€ å®Œæ•´æ¥­å‹™è‡ªå‹•åŒ–ç³»çµ±åŠŸèƒ½èªªæ˜

> æ›´æ–°æ™‚é–“ï¼š2025-12-04

---

## ğŸ“Š åŠŸèƒ½æ¨¡çµ„ç¸½è¦½

| æ¨¡çµ„ | æ–‡ä»¶ | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|------|
| ğŸ§§ ç´…åŒ…å®¢æˆ¶ç«¯ | `worker_redpacket_client.py` | å®Œæ•´ API å°æ¥ + ç‚¸å½ˆç´…åŒ… + éŠæˆ²ç­–ç•¥ | âœ… å®Œæˆ |
| ğŸ¤– LLM å°è©± | `worker_llm_dialogue.py` | OpenAI/Claude æ™ºèƒ½å°è©± | âœ… å®Œæˆ |
| ğŸ“Š å¤šç¾¤çµ„ç®¡ç† | `worker_multi_group_manager.py` | ç¾¤çµ„æ±  + AI è³‡æºèª¿åº¦ | âœ… å®Œæˆ |
| ğŸ–¥ï¸ å¯¦æ™‚ç›£æ§ | `worker_realtime_monitor.py` | WebSocket + å‘Šè­¦ç³»çµ± | âœ… å®Œæˆ |
| ğŸ“ˆ æ•¸æ“šåˆ†æ | `worker_analytics.py` | è½‰åŒ–æ¼æ–— + ç”¨æˆ¶ç•«åƒ | âœ… å®Œæˆ |
| ğŸ“ æ—¥èªŒç³»çµ± | `worker_logging.py` | æ–‡ä»¶è¼¸å‡º + è¼ªè½‰ + JSON | âœ… å®Œæˆ |
| ğŸ”„ éŒ¯èª¤é‡è©¦ | å…§ç½®æ–¼å„æ¨¡çµ„ | æŒ‡æ•¸é€€é¿ç­–ç•¥ | âœ… å®Œæˆ |

---

## ğŸ§§ ç´…åŒ…éŠæˆ² API é›†æˆ

### API é…ç½®

```python
from worker_redpacket_client import RedPacketAPIClient, RedPacketAPIConfig

config = RedPacketAPIConfig(
    api_url="http://api.usdt2026.cc",
    api_key="test-key-2024",
    max_retries=3,
    retry_base_delay=1.0
)

client = RedPacketAPIClient(config)
```

### æ”¯æŒçš„åŠŸèƒ½

| åŠŸèƒ½ | æ–¹æ³• | èªªæ˜ |
|------|------|------|
| å¥åº·æª¢æŸ¥ | `health_check()` | æª¢æŸ¥ API é€£é€šæ€§ |
| æŸ¥è©¢é¤˜é¡ | `get_balance(user_id)` | ç²å–ç”¨æˆ¶é¤˜é¡ |
| ç™¼é€ç´…åŒ… | `send_packet(...)` | æ”¯æŒæ™®é€š/ç‚¸å½ˆç´…åŒ… |
| é ˜å–ç´…åŒ… | `claim_packet(user_id, uuid)` | é ˜å–ç´…åŒ… |
| ç´…åŒ…è©³æƒ… | `get_packet_info(...)` | ç²å–ç´…åŒ…ç‹€æ…‹ |
| å…§éƒ¨è½‰å¸³ | `transfer(...)` | AI ä¹‹é–“è½‰å¸³ |

### ç‚¸å½ˆç´…åŒ…

```python
# ç™¼é€ç‚¸å½ˆç´…åŒ…
packet = await client.send_packet(
    sender_id=639277358115,
    total_amount=10.0,
    total_count=5,          # å¿…é ˆæ˜¯ 5 æˆ– 10
    packet_type="equal",
    message="ç‚¸å½ˆç´…åŒ…ä¾†äº†ï¼",
    bomb_number=3           # é›·è™Ÿ 0-9
)

# é ˜å–çµæœ
result = await client.claim_packet(user_id, packet.packet_uuid)
if result.is_bomb_hit:
    print(f"è¸©é›·ï¼è³ ä»˜ {result.penalty_amount} USDT")
```

### éŠæˆ²ç­–ç•¥

```python
from worker_redpacket_client import RedPacketGameEngine, GameStrategy

# ç­–ç•¥é¸é …
# - CONSERVATIVE: ä¿å®ˆï¼ˆå°‘ç™¼ã€å¤šæ¶ã€ä¸ç©ç‚¸å½ˆï¼‰
# - BALANCED: å¹³è¡¡ï¼ˆé»˜èªï¼‰
# - AGGRESSIVE: æ¿€é€²ï¼ˆå¤šç™¼ã€å¿«æ¶ã€ç©ç‚¸å½ˆï¼‰
# - SMART: æ™ºèƒ½ï¼ˆæ ¹æ“šæƒ…æ³èª¿æ•´ï¼‰

engine = RedPacketGameEngine(client, GameStrategy.SMART)

# åˆ¤æ–·æ˜¯å¦ç™¼ç´…åŒ…
should_send, params = engine.should_send_packet(user_id)
if should_send:
    await engine.send_packet(user_id, **params)

# åˆ¤æ–·æ˜¯å¦æ¶ç´…åŒ…
if engine.should_claim_packet(user_id, packet_info):
    result = await engine.claim_packet(user_id, packet_uuid)
```

---

## ğŸ¤– LLM æ™ºèƒ½å°è©±

### é…ç½®

```bash
# ç’°å¢ƒè®Šé‡
export LLM_PROVIDER=openai        # openai æˆ– claude
export OPENAI_API_KEY=sk-xxx
export LLM_MODEL=gpt-3.5-turbo
export LLM_TEMPERATURE=0.8
```

### é è¨­è§’è‰²

| è§’è‰² ID | åç¨± | æ€§æ ¼ |
|---------|------|------|
| xiaoqi | å°æŸ’ | è©±å¤šã€å¤–å‘ã€æ„›é–‹ç©ç¬‘ |
| mimi | ç±³ç±³ | æ´»æ½‘å¯æ„›ã€å–œæ­¡äº’å‹• |
| haoge | æµ©å“¥ | æˆç†Ÿç©©é‡ã€ç…§é¡§æ–°äºº |
| xiaoyu | å°é›¨ | æ–‡è—èŒƒã€æº«æŸ”ç´°è†© |
| aqiang | é˜¿å¼· | æŠ€è¡“å®…ã€å¶çˆ¾å†’æ³¡ |
| laozhang | è€å¼µ | æˆç†Ÿç©©é‡ã€èªªè©±æœ‰åˆ†é‡ |

### ä½¿ç”¨ç¤ºä¾‹

```python
from worker_llm_dialogue import SmartDialogueManager, LLMConfig

manager = SmartDialogueManager(LLMConfig.from_env())

# ç”Ÿæˆå›å¾©
response = await manager.generate_group_response(
    group_id=123456,
    user_message="å¤§å®¶å¥½ï¼æˆ‘æ˜¯æ–°ä¾†çš„",
    user_id=789,
    user_name="å°æ˜"
)

if response:
    role_name, reply_text = response
    print(f"{role_name}: {reply_text}")
    # è¼¸å‡º: å°æŸ’: å“‡ï¼Œæ–°æœ‹å‹ä¾†å•¦ï¼æ­¡è¿æ­¡è¿ï½ ğŸ‰
```

### æƒ…ç·’è­˜åˆ¥

ç³»çµ±æœƒè‡ªå‹•è­˜åˆ¥ç”¨æˆ¶æƒ…ç·’ä¸¦èª¿æ•´å›å¾©é¢¨æ ¼ï¼š

| æƒ…ç·’ | è­˜åˆ¥é—œéµè© | å›å¾©ç­–ç•¥ |
|------|-----------|----------|
| é–‹å¿ƒ | å“ˆå“ˆã€ğŸ˜Šã€ğŸ‰ | ä¸€èµ·é–‹å¿ƒäº’å‹• |
| èˆˆå¥® | å¤ªæ£’äº†ã€ğŸ”¥ | ä¸€èµ·æ¿€å‹• |
| å¥½å¥‡ | ç‚ºä»€éº¼ã€ğŸ¤” | çµ¦å‡ºè§£ç­” |
| å›°æƒ‘ | ä¸æ‡‚ã€ğŸ˜… | è€å¿ƒè§£é‡‹ |
| ç…©èº | ç…©ã€ğŸ˜¤ | å®‰æ’«æƒ…ç·’ |

---

## ğŸ“Š å¤šç¾¤çµ„ç®¡ç†

### æ¶æ§‹

```
MultiGroupManager
â”œâ”€â”€ GroupPool          # ç¾¤çµ„æ± 
â”‚   â”œâ”€â”€ GroupInfo 1
â”‚   â”œâ”€â”€ GroupInfo 2
â”‚   â””â”€â”€ ...
â”œâ”€â”€ AIResourceScheduler # AI è³‡æºèª¿åº¦
â”‚   â”œâ”€â”€ AIAccountInfo 1
â”‚   â”œâ”€â”€ AIAccountInfo 2
â”‚   â””â”€â”€ ...
â””â”€â”€ Clients            # Telegram å®¢æˆ¶ç«¯
```

### AI åˆ†é…ç­–ç•¥

| ç­–ç•¥ | èªªæ˜ |
|------|------|
| ROUND_ROBIN | è¼ªè©¢åˆ†é… |
| LEAST_LOADED | æœ€å°‘è² è¼‰å„ªå…ˆ |
| RANDOM | éš¨æ©Ÿåˆ†é… |
| SKILL_BASED | æŠ€èƒ½åŒ¹é…ï¼ˆé ç•™ï¼‰ |

### ä½¿ç”¨ç¤ºä¾‹

```python
from worker_multi_group_manager import MultiGroupManager, GroupConfig

manager = MultiGroupManager()

# è¨»å†Šå®¢æˆ¶ç«¯
for user_id, client in clients.items():
    manager.register_client(user_id, client)

# å‰µå»ºç¾¤çµ„
group = await manager.create_group(
    name="ç¦åˆ©ç¾¤ 1",
    config=GroupConfig(max_users=100, min_ai_count=4)
)

# è‡ªå‹•æ“´ç¸®å®¹
await manager.auto_scale(target_available_groups=3)
```

---

## ğŸ–¥ï¸ å¯¦æ™‚ç›£æ§

### WebSocket API

```javascript
// å‰ç«¯é€£æ¥ç¤ºä¾‹
const ws = new WebSocket('ws://localhost:8000/api/v1/monitor/ws');

ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    console.log('æ”¶åˆ°äº‹ä»¶:', data);
};

// è¨‚é–±ç‰¹å®šäº‹ä»¶
ws.send(JSON.stringify({
    action: 'subscribe',
    events: ['user_joined', 'redpacket_claimed']
}));
```

### äº‹ä»¶é¡å‹

| äº‹ä»¶ | èªªæ˜ |
|------|------|
| `group_created` | ç¾¤çµ„å‰µå»º |
| `group_status_changed` | ç¾¤çµ„ç‹€æ…‹è®Šæ›´ |
| `user_joined` | ç”¨æˆ¶åŠ å…¥ |
| `user_message` | ç”¨æˆ¶æ¶ˆæ¯ |
| `redpacket_sent` | ç´…åŒ…ç™¼é€ |
| `redpacket_claimed` | ç´…åŒ…é ˜å– |
| `system_status` | ç³»çµ±ç‹€æ…‹æ›´æ–° |
| `alert` | å‘Šè­¦ |

### å‘Šè­¦ç´šåˆ¥

| ç´šåˆ¥ | é¡è‰² | ç”¨é€” |
|------|------|------|
| INFO | è—è‰² | ä¸€èˆ¬ä¿¡æ¯ |
| WARNING | é»ƒè‰² | è­¦å‘Šï¼ˆè¸©é›·ç­‰ï¼‰ |
| ERROR | ç´…è‰² | éŒ¯èª¤ |
| CRITICAL | ç´«è‰² | åš´é‡éŒ¯èª¤ |

---

## ğŸ“ˆ æ•¸æ“šåˆ†æ

### è½‰åŒ–æ¼æ–—

```python
from worker_analytics import AnalyticsService

service = AnalyticsService()

funnel = service.get_funnel_report()
# {
#     "name": "ç”¨æˆ¶è½‰åŒ–æ¼æ–—",
#     "stages": [
#         {"name": "åŠ å…¥ç¾¤çµ„", "count": 100, "conversion_rate": 100.0},
#         {"name": "ç™¼é€æ¶ˆæ¯", "count": 60, "conversion_rate": 60.0},
#         {"name": "é ˜å–ç´…åŒ…", "count": 30, "conversion_rate": 50.0},
#         {"name": "ç™¼é€ç´…åŒ…", "count": 10, "conversion_rate": 33.3}
#     ],
#     "overall_rate": 10.0
# }
```

### ç”¨æˆ¶åˆ†å±¤

| åˆ†å±¤ | åƒèˆ‡åº¦åˆ†æ•¸ | èªªæ˜ |
|------|-----------|------|
| high_value | â‰¥70 | é«˜åƒ¹å€¼ç”¨æˆ¶ |
| engaged | 40-70 | æ´»èºç”¨æˆ¶ |
| casual | 10-40 | æ™®é€šç”¨æˆ¶ |
| inactive | <10 | ä¸æ´»èºç”¨æˆ¶ |

---

## ğŸ“ æ—¥èªŒç³»çµ±

### é…ç½®

```python
from worker_logging import setup_logging, LogConfig

config = LogConfig(
    log_dir="./logs",
    log_level="INFO",
    max_bytes=10 * 1024 * 1024,  # 10MB
    backup_count=5,
    json_log_enabled=True
)

log_manager = setup_logging(config)
```

### æ—¥èªŒæ–‡ä»¶

| æ–‡ä»¶ | å…§å®¹ |
|------|------|
| `app.log` | æ‰€æœ‰æ—¥èªŒ |
| `error.log` | åªæœ‰éŒ¯èª¤ |
| `app.json.log` | JSON æ ¼å¼æ—¥èªŒ |

### çµæ§‹åŒ–æ—¥èªŒ

```python
from worker_logging import get_structured_logger

logger = get_structured_logger("redpacket")

# æ¥­å‹™æ—¥èªŒ
logger.redpacket_event("claimed", user_id=123, amount=1.5)
logger.user_action(user_id=123, action="join_group", group_id=456)
logger.api_call("/packets/send", status="success", duration_ms=150)
```

---

## ğŸ”„ éŒ¯èª¤é‡è©¦æ©Ÿåˆ¶

### é‡è©¦è£é£¾å™¨

```python
from worker_redpacket_client import with_retry, RetryableError

@with_retry(
    max_retries=3,
    base_delay=1.0,
    max_delay=60.0,
    exponential_base=2.0
)
async def my_api_call():
    # å¤±æ•—æ™‚æœƒè‡ªå‹•é‡è©¦
    # é‡è©¦é–“éš”: 1s -> 2s -> 4s (+ éš¨æ©ŸæŠ–å‹•)
    pass
```

### å¯é‡è©¦çš„éŒ¯èª¤

| éŒ¯èª¤ | æ˜¯å¦é‡è©¦ |
|------|----------|
| ç¶²çµ¡è¶…æ™‚ | âœ… é‡è©¦ |
| é€£æ¥éŒ¯èª¤ | âœ… é‡è©¦ |
| æœå‹™å™¨ 500 | âœ… é‡è©¦ |
| åƒæ•¸éŒ¯èª¤ 400 | âŒ ä¸é‡è©¦ |
| èªè­‰å¤±æ•— 401 | âŒ ä¸é‡è©¦ |
| è³‡æºä¸å­˜åœ¨ 404 | âŒ ä¸é‡è©¦ |

---

## ğŸš€ å¿«é€Ÿå•Ÿå‹•

### ç’°å¢ƒè®Šé‡

```bash
# åŸºæœ¬é…ç½®
export SESSIONS_DIR=./sessions

# ç´…åŒ… API
export REDPACKET_API_URL=http://api.usdt2026.cc
export REDPACKET_API_KEY=test-key-2024

# LLMï¼ˆå¯é¸ï¼‰
export LLM_ENABLED=true
export OPENAI_API_KEY=sk-xxx

# éŠæˆ²ç­–ç•¥
export GAME_STRATEGY=smart  # conservative/balanced/aggressive/smart

# è‡ªå‹•åŒ–
export AUTO_CREATE_GROUP=true
export AUTO_GRAB=true
export AUTO_SEND=false
export AUTO_CHAT=true

# æ—¥èªŒ
export LOG_DIR=./logs
export LOG_LEVEL=INFO
```

### å•Ÿå‹•å‘½ä»¤

```bash
python start_full_system.py
```

### è¼¸å‡ºç¤ºä¾‹

```
======================================================================
  ğŸš€ å®Œæ•´æ¥­å‹™è‡ªå‹•åŒ–ç³»çµ±
  åŠŸèƒ½: LLMå°è©± | å¤šç¾¤çµ„ | ç´…åŒ…éŠæˆ² | å¯¦æ™‚ç›£æ§ | æ•¸æ“šåˆ†æ
======================================================================

2025-12-04 15:00:00 [INFO] âœ… ç´…åŒ… API é€£æ¥æ­£å¸¸
2025-12-04 15:00:01 [INFO] âœ… å¯¦æ™‚ç›£æ§å·²å•Ÿå‹•
2025-12-04 15:00:02 [INFO] è¼‰å…¥äº† 6 å€‹å¸³è™Ÿé…ç½®
2025-12-04 15:00:03 [INFO] âœ… å¸³è™Ÿ ai_user_1 (ID: 639277358115) é¤˜é¡: 100.0 USDT
...
2025-12-04 15:00:10 [INFO] âœ… é€£æ¥äº† 6 å€‹å¸³è™Ÿ

ğŸš€ ç³»çµ±å·²å•Ÿå‹•ï¼
   ğŸ“Š 6 å€‹å¸³è™Ÿåœ¨ç·š
   ğŸ¤– LLM å°è©±: âœ…
   ğŸ§§ è‡ªå‹•æ¶ç´…åŒ…: âœ…
   ğŸ“¤ è‡ªå‹•ç™¼ç´…åŒ…: âŒ
   ğŸ’¬ æ™ºèƒ½èŠå¤©: âœ…
   ğŸ“ˆ éŠæˆ²ç­–ç•¥: smart
```

---

## ğŸ“Š AI å¸³è™Ÿåˆ—è¡¨

| ID | Telegram User ID | åˆå§‹é¤˜é¡ |
|----|------------------|----------|
| AI-1 | 639277358115 | 100 USDT |
| AI-2 | 639543603735 | 100 USDT |
| AI-3 | 639952948692 | 100 USDT |
| AI-4 | 639454959591 | 100 USDT |
| AI-5 | 639542360349 | 100 USDT |
| AI-6 | 639950375245 | 100 USDT |

---

*æ–‡æª”æ›´æ–°æ™‚é–“ï¼š2025-12-04*
