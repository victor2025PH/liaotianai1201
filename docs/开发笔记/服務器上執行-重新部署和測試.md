# æœå‹™å™¨ä¸ŠåŸ·è¡Œ - é‡æ–°éƒ¨ç½²å’Œæ¸¬è©¦

> **æ—¥æœŸ**: 2025-12-01  
> **ä»»å‹™**: é‡æ–°éƒ¨ç½²å¾Œç«¯ä¸¦æ¸¬è©¦ä¿®å¾©å¾Œçš„è³¬è™Ÿç‹€æ…‹ç«¯é»

---

## ğŸš€ å¿«é€ŸåŸ·è¡Œ

åœ¨æœå‹™å™¨ SSH çµ‚ç«¯åŸ·è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# æ–¹æ³• 1: ä½¿ç”¨è‡ªå‹•åŒ–è…³æœ¬ï¼ˆæ¨è–¦ï¼‰
chmod +x deploy/æœå‹™å™¨ä¸Šç«‹å³åŸ·è¡Œ-éƒ¨ç½²å’Œæ¸¬è©¦.sh
bash deploy/æœå‹™å™¨ä¸Šç«‹å³åŸ·è¡Œ-éƒ¨ç½²å’Œæ¸¬è©¦.sh
```

---

## ğŸ“ æ‰‹å‹•åŸ·è¡Œæ­¥é©Ÿ

### æ­¥é©Ÿ 1: æ‹‰å–æœ€æ–°ä»£ç¢¼ï¼ˆå¦‚æœä½¿ç”¨ Gitï¼‰

```bash
cd /opt/group-ai  # æˆ– /opt/smart-tg
git pull origin main || git pull origin master
```

### æ­¥é©Ÿ 2: é‡å•Ÿå¾Œç«¯æœå‹™

**ä½¿ç”¨ systemd**:
```bash
sudo systemctl restart smart-tg-backend.service
sleep 5
sudo systemctl status smart-tg-backend.service
```

**æˆ–æ‰‹å‹•é‡å•Ÿ**:
```bash
# åœæ­¢ç¾æœ‰é€²ç¨‹
pkill -f "uvicorn.*app.main:app"
sleep 2

# å•Ÿå‹•æœå‹™
cd /opt/group-ai/admin-backend  # æˆ–ç›¸æ‡‰è·¯å¾‘
source ../.venv/bin/activate  # æˆ–ç›¸æ‡‰çš„è™›æ“¬ç’°å¢ƒè·¯å¾‘
nohup python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 > /tmp/backend.log 2>&1 &
```

### æ­¥é©Ÿ 3: é©—è­‰æœå‹™

```bash
curl http://localhost:8000/health
```

---

## ğŸ§ª æ¸¬è©¦ä¿®å¾©

åŸ·è¡Œä»¥ä¸‹æ¸¬è©¦å‘½ä»¤ï¼š

```bash
# ç²å– Token
TOKEN=$(curl -s -X POST "http://localhost:8000/api/v1/auth/login" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin@example.com&password=changeme123" | \
  python3 -c "import sys, json; print(json.loads(sys.stdin.read()).get('access_token', ''))")

echo "=== æ¸¬è©¦è³¬è™Ÿç‹€æ…‹ç«¯é»ä¿®å¾© ===" && \
echo "" && \
echo "ã€æ¸¬è©¦ 1ã€‘è³¬è™Ÿè©³æƒ…..." && \
curl -s -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8000/api/v1/group-ai/accounts/639454959591" | \
  python3 -m json.tool | head -10 && \
echo "" && \
echo "ã€æ¸¬è©¦ 2ã€‘è³¬è™Ÿç‹€æ…‹ï¼ˆä¿®å¾©å¾Œï¼‰..." && \
curl -s -w "\nHTTPç‹€æ…‹ç¢¼: %{http_code}\n" \
  -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8000/api/v1/group-ai/accounts/639454959591/status" | \
  python3 -m json.tool
```

---

## âœ… é æœŸçµæœ

### æ¸¬è©¦ 1: è³¬è™Ÿè©³æƒ…
- **HTTP ç‹€æ…‹**: 200
- **çµæœ**: è¿”å›è³¬è™Ÿä¿¡æ¯

### æ¸¬è©¦ 2: è³¬è™Ÿç‹€æ…‹ï¼ˆä¿®å¾©å¾Œï¼‰
- **HTTP ç‹€æ…‹**: âœ… **200**ï¼ˆä¿®å¾©å‰æ˜¯ 404ï¼‰
- **éŸ¿æ‡‰å…§å®¹**: 
```json
{
    "account_id": "639454959591",
    "status": "offline",
    "online": false,
    "last_activity": null,
    "message_count": 0,
    "reply_count": 0,
    "redpacket_count": 0,
    "error_count": 0,
    "last_error": null,
    "uptime_seconds": 0
}
```

---

## ğŸ” å¦‚æœä»è¿”å› 404

### æª¢æŸ¥ 1: ä»£ç¢¼æ˜¯å¦å·²æ›´æ–°

```bash
cd /opt/group-ai/admin-backend
grep -A 5 "æª¢æŸ¥æ•¸æ“šåº«ï¼ˆåŒ…å«é ç¨‹æœå‹™å™¨è³¬è™Ÿï¼‰" app/api/group_ai/accounts.py
```

å¦‚æœæ²’æœ‰æ‰¾åˆ°ï¼Œèªªæ˜ä»£ç¢¼æœªæ›´æ–°ã€‚

### æª¢æŸ¥ 2: æ‰‹å‹•æ‡‰ç”¨ä¿®å¾©

å¦‚æœä»£ç¢¼æœªæ›´æ–°ï¼Œå¯ä»¥æ‰‹å‹•ç·¨è¼¯æ–‡ä»¶ï¼š

```bash
cd /opt/group-ai/admin-backend
cp app/api/group_ai/accounts.py app/api/group_ai/accounts.py.bak

# ç„¶å¾Œç·¨è¼¯æ–‡ä»¶ï¼Œåœ¨ get_account_status å‡½æ•¸ä¸­æ·»åŠ æ•¸æ“šåº«æª¢æŸ¥é‚è¼¯
# æˆ–ä½¿ç”¨ sed å‘½ä»¤ç›´æ¥ä¿®æ”¹ï¼ˆéœ€è¦æ ¹æ“šå¯¦éš›æƒ…æ³èª¿æ•´ï¼‰
```

---

**åŸ·è¡Œæ¸¬è©¦ï¼Œå‘Šè¨´æˆ‘çµæœï¼**
