# 環境變量設置指南

## 📋 概述

本文檔說明如何設置後端應用的環境變量。由於 `.env.example` 文件被版本控制忽略，請按照以下步驟手動創建。

## 🚀 快速開始

### 方法 1: 從模板創建（推薦）

```bash
# 複製 worker 環境變量模板作為基礎
cp config/worker.env.example .env.example

# 然後手動編輯 .env.example，添加以下配置
```

### 方法 2: 手動創建

創建 `.env.example` 文件，內容如下：

```bash
# ============================================
# Smart TG Admin Backend 環境變量配置示例
# ============================================
# 使用方法：
# 1. 複製此文件為 .env
# 2. 根據實際環境修改配置值
# 3. ⚠️ 生產環境必須修改 JWT_SECRET 和 ADMIN_DEFAULT_PASSWORD
# ============================================

# ========== 應用配置 ==========
APP_NAME=Smart TG Admin API

# ========== 數據庫配置 ==========
# SQLite（開發環境）
DATABASE_URL=sqlite:///./admin.db

# PostgreSQL（生產環境示例）
# DATABASE_URL=postgresql://user:password@localhost:5432/dbname

# 數據庫連接池配置
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20
DATABASE_POOL_RECYCLE=3600
DATABASE_POOL_TIMEOUT=30

# ========== JWT 認證配置 ==========
# ⚠️ 生產環境必須修改為強密鑰（至少 32 字符）
JWT_SECRET=change_me_to_a_strong_secret_key_at_least_32_characters_long
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440

# ========== 管理員賬號配置 ==========
# ⚠️ 生產環境必須修改為強密碼
ADMIN_DEFAULT_EMAIL=admin@example.com
ADMIN_DEFAULT_PASSWORD=changeme123

# ========== CORS 配置 ==========
# 前端應用地址（逗號分隔，不能使用 "*"）
# 開發環境
CORS_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:5173,http://localhost:8080

# 生產環境示例
# CORS_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# ========== 服務地址配置 ==========
SESSION_SERVICE_URL=http://localhost:8001
REDPACKET_SERVICE_URL=http://localhost:8002
MONITORING_SERVICE_URL=http://localhost:8003

# ========== Redis 緩存配置（可選）==========
# 如果未配置，將使用內存緩存
REDIS_URL=redis://localhost:6379/0

# ========== 通知服務配置（可選）==========
# 郵件通知
EMAIL_ENABLED=false
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
EMAIL_FROM=

# Webhook 通知
WEBHOOK_ENABLED=false
WEBHOOK_URL=

# Telegram 通知
TELEGRAM_BOT_TOKEN=
TELEGRAM_CHAT_ID=

# ========== 自動備份配置 ==========
AUTO_BACKUP_ENABLED=true
BACKUP_DIR=backups
BACKUP_RETENTION_DAYS=30
BACKUP_INTERVAL_HOURS=24

# ========== 緩存配置 ==========
CACHE_DEFAULT_TTL=300

# ========== 性能監控配置 ==========
PERFORMANCE_CHECK_INTERVAL=60

# ========== 智能優化配置 ==========
AUTO_OPTIMIZE_ENABLED=true
AUTO_OPTIMIZE_INTERVAL_HOURS=6

# ========== 告警檢查配置 ==========
ALERT_CHECK_ENABLED=true
ALERT_CHECK_INTERVAL_SECONDS=300

# ========== 開發模式配置 ==========
# ⚠️ 生產環境必須設置為 false
DISABLE_AUTH=false

# ========== Telegram 註冊模擬模式（測試用）==========
TELEGRAM_REGISTRATION_MOCK_MODE=false
TELEGRAM_REGISTRATION_MOCK_CODE=123456

# ========== 日誌配置 ==========
DEBUG_AUTH_LOGS=false
```

## 🔒 生產環境安全配置

### 必須修改的配置項

1. **JWT_SECRET**
   - 必須是至少 32 字符的強密鑰
   - 可以使用以下命令生成：
     ```bash
     python -c "import secrets; print(secrets.token_urlsafe(64))"
     ```

2. **ADMIN_DEFAULT_PASSWORD**
   - 必須是至少 12 字符的強密碼
   - 建議包含大小寫字母、數字和特殊字符

3. **CORS_ORIGINS**
   - 必須配置實際的生產域名
   - 不能使用 `*` 或僅包含 `localhost`

4. **DISABLE_AUTH**
   - 必須設置為 `false`

### 自動化安全配置

運行以下腳本自動設置安全配置：

```bash
# 交互式設置（推薦）
python scripts/setup_production_security.py

# 檢查安全配置
python scripts/check_security_config.py
```

## 📝 環境變量說明

### 必需配置

| 變量名 | 說明 | 默認值 | 生產環境要求 |
|--------|------|--------|-------------|
| `DATABASE_URL` | 數據庫連接字符串 | `sqlite:///./admin.db` | 必須配置 |
| `JWT_SECRET` | JWT 簽名密鑰 | `change_me` | ⚠️ 必須修改 |
| `ADMIN_DEFAULT_PASSWORD` | 管理員默認密碼 | `changeme123` | ⚠️ 必須修改 |
| `CORS_ORIGINS` | CORS 允許的來源 | `localhost` | ⚠️ 必須配置實際域名 |

### 可選配置

| 變量名 | 說明 | 默認值 |
|--------|------|--------|
| `REDIS_URL` | Redis 連接 URL | 空（使用內存緩存） |
| `EMAIL_ENABLED` | 啟用郵件通知 | `false` |
| `TELEGRAM_BOT_TOKEN` | Telegram Bot Token | 空 |
| `AUTO_BACKUP_ENABLED` | 啟用自動備份 | `true` |

## 🔍 驗證配置

### 檢查安全配置

```bash
python scripts/check_security_config.py
```

### 檢查環境變量

```bash
# 檢查所有環境變量
python -c "from app.core.config import get_settings; s = get_settings(); print([f'{k}={v}' for k, v in s.model_dump().items()])"
```

## 📚 相關文檔

- [部署準備清單](./部署準備清單.md)
- [開發進度報告](./開發進度報告.md)
- [README](./README.md)

