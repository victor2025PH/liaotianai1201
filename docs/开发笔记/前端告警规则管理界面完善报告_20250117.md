# å‰ç«¯å‘Šè­¦è§„åˆ™ç®¡ç†ç•Œé¢å®Œå–„æŠ¥å‘Š

> **ç”Ÿæˆæ—¶é—´**: 2025-01-17  
> **å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ  
> **æŠ¥å‘Šç‰ˆæœ¬**: v1.0

---

## ğŸ“Š å®Œæˆæ¦‚è¿°

### å®ç°çš„åŠŸèƒ½

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| è¿æ¥çœŸå®åç«¯ API | âœ… å®Œæˆ | æ›´æ–° API å®¢æˆ·ç«¯è¿æ¥åç«¯å‘Šè­¦è§„åˆ™ API |
| åˆ›å»ºå‘Šè­¦è§„åˆ™ | âœ… å®Œæˆ | æ·»åŠ åˆ›å»ºå‘Šè­¦è§„åˆ™çš„å¯¹è¯æ¡†å’Œè¡¨å• |
| ç¼–è¾‘å‘Šè­¦è§„åˆ™ | âœ… å®Œæˆ | æ·»åŠ ç¼–è¾‘å‘Šè­¦è§„åˆ™çš„å¯¹è¯æ¡†å’Œè¡¨å• |
| åˆ é™¤å‘Šè­¦è§„åˆ™ | âœ… å®Œæˆ | æ·»åŠ åˆ é™¤å‘Šè­¦è§„åˆ™çš„åŠŸèƒ½ |
| å¯ç”¨/ç¦ç”¨å‘Šè­¦è§„åˆ™ | âœ… å®Œæˆ | ä½¿ç”¨ä¸“é—¨çš„å¯ç”¨/ç¦ç”¨ API |
| æ›´æ–°æ•°æ®ç»“æ„ | âœ… å®Œæˆ | åŒ¹é…åç«¯ Schema çš„æ•°æ®ç»“æ„ |

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. API å®¢æˆ·ç«¯æ›´æ–°

**æ–‡ä»¶**: `saas-demo/src/lib/api.ts`

**æ”¹è¿›**:
- âœ… æ›´æ–° `AlertRule` æ¥å£ä»¥åŒ¹é…åç«¯ Schema
- âœ… æ·»åŠ  `AlertRuleCreate` æ¥å£
- âœ… æ·»åŠ  `AlertRuleUpdate` æ¥å£
- âœ… å®ç° `getAlertRules()` - è¿æ¥çœŸå® API
- âœ… å®ç° `getAlertRule()` - è·å–å•ä¸ªè§„åˆ™
- âœ… å®ç° `createAlertRule()` - åˆ›å»ºè§„åˆ™
- âœ… å®ç° `updateAlertRule()` - æ›´æ–°è§„åˆ™
- âœ… å®ç° `deleteAlertRule()` - åˆ é™¤è§„åˆ™
- âœ… å®ç° `enableAlertRule()` - å¯ç”¨è§„åˆ™
- âœ… å®ç° `disableAlertRule()` - ç¦ç”¨è§„åˆ™

**API ç«¯ç‚¹**:
- `GET /api/v1/group-ai/alert-rules/` - è·å–è§„åˆ™åˆ—è¡¨
- `GET /api/v1/group-ai/alert-rules/{id}` - è·å–å•ä¸ªè§„åˆ™
- `POST /api/v1/group-ai/alert-rules/` - åˆ›å»ºè§„åˆ™
- `PUT /api/v1/group-ai/alert-rules/{id}` - æ›´æ–°è§„åˆ™
- `DELETE /api/v1/group-ai/alert-rules/{id}` - åˆ é™¤è§„åˆ™
- `POST /api/v1/group-ai/alert-rules/{id}/enable` - å¯ç”¨è§„åˆ™
- `POST /api/v1/group-ai/alert-rules/{id}/disable` - ç¦ç”¨è§„åˆ™

---

### 2. æ•°æ®ç»“æ„æ›´æ–°

**æ–‡ä»¶**: `saas-demo/src/lib/api.ts`

**æ›´æ–°å†…å®¹**:

```typescript
/**
 * å‘Šè­¦è¦å‰‡ï¼ˆåŒ¹é…å¾Œç«¯ Schemaï¼‰
 */
export interface AlertRule {
  id: string;
  name: string;
  rule_type: string; // error_rate, response_time, system_errors, account_offline
  alert_level: "error" | "warning" | "info";
  threshold_value: number;
  threshold_operator: ">" | ">=" | "<" | "<=" | "==" | "!=";
  enabled: boolean;
  notification_method: "email" | "webhook" | "telegram";
  notification_target?: string; // éƒµç®±åœ°å€ã€Webhook URLã€Telegram Chat ID
  rule_conditions?: Record<string, any>; // JSON æ ¼å¼çš„è¦å‰‡æ¢ä»¶
  description?: string;
  created_by?: string;
  created_at: string; // ISO æ ¼å¼æ™‚é–“æˆ³
  updated_at: string; // ISO æ ¼å¼æ™‚é–“æˆ³
}
```

**ä¸»è¦å˜åŒ–**:
- ä» `metric` æ”¹ä¸º `rule_type`
- ä» `threshold` æ”¹ä¸º `threshold_value`
- ä» `operator` æ”¹ä¸º `threshold_operator`
- æ·»åŠ  `alert_level` å­—æ®µ
- æ·»åŠ  `rule_conditions` å­—æ®µ
- æ·»åŠ  `description` å­—æ®µ
- æ·»åŠ  `created_by`, `created_at`, `updated_at` å­—æ®µ
- ç§»é™¤ `time_window` å­—æ®µï¼ˆåç«¯æœªä½¿ç”¨ï¼‰

---

### 3. å‰ç«¯é¡µé¢æ›´æ–°

**æ–‡ä»¶**: `saas-demo/src/app/settings/alerts/page.tsx`

**æ”¹è¿›**:
- âœ… æ·»åŠ åˆ›å»ºå‘Šè­¦è§„åˆ™çš„å¯¹è¯æ¡†
- âœ… æ·»åŠ ç¼–è¾‘å‘Šè­¦è§„åˆ™çš„å¯¹è¯æ¡†
- âœ… æ·»åŠ åˆ é™¤å‘Šè­¦è§„åˆ™çš„åŠŸèƒ½
- âœ… æ›´æ–°è¡¨æ ¼æ˜¾ç¤ºä»¥åŒ¹é…æ–°çš„æ•°æ®ç»“æ„
- âœ… æ›´æ–°å¯ç”¨/ç¦ç”¨åŠŸèƒ½ä½¿ç”¨æ–°çš„ API
- âœ… æ·»åŠ é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

**æ–°å¢åŠŸèƒ½**:

#### 3.1 åˆ›å»ºå‘Šè­¦è§„åˆ™

- **è¡¨å•å­—æ®µ**:
  - è§„åˆ™åç§°ï¼ˆå¿…å¡«ï¼‰
  - è§„åˆ™ç±»å‹ï¼ˆerror_rate, response_time, system_errors, account_offlineï¼‰
  - å‘Šè­¦çº§åˆ«ï¼ˆerror, warning, infoï¼‰
  - é˜ˆå€¼ï¼ˆå¿…å¡«ï¼‰
  - æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆ>, >=, <, <=, ==, !=ï¼‰
  - é€šçŸ¥æ–¹å¼ï¼ˆemail, webhook, telegramï¼‰
  - é€šçŸ¥ç›®æ ‡ï¼ˆå¿…å¡«ï¼‰
  - æè¿°ï¼ˆå¯é€‰ï¼‰
  - å¯ç”¨/ç¦ç”¨å¼€å…³

#### 3.2 ç¼–è¾‘å‘Šè­¦è§„åˆ™

- **åŠŸèƒ½**:
  - ç¼–è¾‘æ‰€æœ‰è§„åˆ™å­—æ®µ
  - ä¿å­˜æ›´æ”¹
  - å–æ¶ˆç¼–è¾‘

#### 3.3 åˆ é™¤å‘Šè­¦è§„åˆ™

- **åŠŸèƒ½**:
  - ç¡®è®¤å¯¹è¯æ¡†
  - åˆ é™¤è§„åˆ™
  - æ›´æ–°åˆ—è¡¨

#### 3.4 è¡¨æ ¼æ˜¾ç¤º

- **åˆ—**:
  - è§„åˆ™åç§°
  - è§„åˆ™ç±»å‹
  - å‘Šè­¦çº§åˆ«ï¼ˆå¸¦é¢œè‰²æ ‡ç­¾ï¼‰
  - é˜ˆå€¼
  - è¿ç®—ç¬¦
  - é€šçŸ¥æ–¹å¼
  - é€šçŸ¥ç›®æ ‡ï¼ˆæˆªæ–­æ˜¾ç¤ºï¼‰
  - çŠ¶æ€ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰
  - æ“ä½œï¼ˆå¯ç”¨/ç¦ç”¨ã€ç¼–è¾‘ã€åˆ é™¤ï¼‰

---

## ğŸ“‹ ä½¿ç”¨æ–¹å¼

### 1. æŸ¥çœ‹å‘Šè­¦è§„åˆ™åˆ—è¡¨

è®¿é—® `/settings/alerts` é¡µé¢ï¼ŒæŸ¥çœ‹æ‰€æœ‰å‘Šè­¦è§„åˆ™ã€‚

### 2. åˆ›å»ºå‘Šè­¦è§„åˆ™

1. ç‚¹å‡»ã€Œåˆ›å»ºè§„åˆ™ã€æŒ‰é’®
2. å¡«å†™è¡¨å•ï¼š
   - è§„åˆ™åç§°ï¼šä¾‹å¦‚ã€Œè´¦å·é”™è¯¯ç‡è­¦å‘Šã€
   - è§„åˆ™ç±»å‹ï¼šé€‰æ‹© `error_rate`
   - å‘Šè­¦çº§åˆ«ï¼šé€‰æ‹© `warning`
   - é˜ˆå€¼ï¼šè¾“å…¥ `0.2`ï¼ˆ20%ï¼‰
   - æ¯”è¾ƒè¿ç®—ç¬¦ï¼šé€‰æ‹© `>`
   - é€šçŸ¥æ–¹å¼ï¼šé€‰æ‹© `email`
   - é€šçŸ¥ç›®æ ‡ï¼šè¾“å…¥é‚®ç®±åœ°å€
   - æè¿°ï¼šå¯é€‰
   - å¯ç”¨ï¼šé»˜è®¤å¯ç”¨
3. ç‚¹å‡»ã€Œåˆ›å»ºã€æŒ‰é’®

### 3. ç¼–è¾‘å‘Šè­¦è§„åˆ™

1. åœ¨è§„åˆ™åˆ—è¡¨ä¸­ç‚¹å‡»ã€Œç¼–è¾‘ã€æŒ‰é’®ï¼ˆé“…ç¬”å›¾æ ‡ï¼‰
2. ä¿®æ”¹è§„åˆ™å­—æ®µ
3. ç‚¹å‡»ã€Œä¿å­˜ã€æŒ‰é’®

### 4. åˆ é™¤å‘Šè­¦è§„åˆ™

1. åœ¨è§„åˆ™åˆ—è¡¨ä¸­ç‚¹å‡»ã€Œåˆ é™¤ã€æŒ‰é’®ï¼ˆåƒåœ¾æ¡¶å›¾æ ‡ï¼‰
2. ç¡®è®¤åˆ é™¤æ“ä½œ

### 5. å¯ç”¨/ç¦ç”¨å‘Šè­¦è§„åˆ™

1. åœ¨è§„åˆ™åˆ—è¡¨ä¸­ç‚¹å‡»ã€Œå¯ç”¨ã€æˆ–ã€Œç¦ç”¨ã€æŒ‰é’®
2. è§„åˆ™çŠ¶æ€ç«‹å³æ›´æ–°

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### ä¿®æ”¹æ–‡ä»¶

1. `saas-demo/src/lib/api.ts` - æ›´æ–° API æ¥å£å’Œæ•°æ®ç»“æ„
2. `saas-demo/src/app/settings/alerts/page.tsx` - æ·»åŠ åˆ›å»º/ç¼–è¾‘/åˆ é™¤åŠŸèƒ½

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. API ç«¯ç‚¹

å‰ç«¯ä½¿ç”¨ä»¥ä¸‹ API ç«¯ç‚¹ï¼ˆå‰ç¼€ `/api/v1`ï¼‰:
- `/group-ai/alert-rules/` - è§„åˆ™åˆ—è¡¨å’Œåˆ›å»º
- `/group-ai/alert-rules/{id}` - è·å–ã€æ›´æ–°ã€åˆ é™¤å•ä¸ªè§„åˆ™
- `/group-ai/alert-rules/{id}/enable` - å¯ç”¨è§„åˆ™
- `/group-ai/alert-rules/{id}/disable` - ç¦ç”¨è§„åˆ™

### 2. è®¤è¯

æ‰€æœ‰ API è¯·æ±‚éœ€è¦ JWT Token è®¤è¯ã€‚å‰ç«¯ API å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å¤„ç†è®¤è¯ï¼ˆå¦‚æœé…ç½®äº†ï¼‰ã€‚

### 3. é”™è¯¯å¤„ç†

- API é”™è¯¯ä¼šæ˜¾ç¤º toast æç¤º
- ç½‘ç»œé”™è¯¯ä¼šæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
- éªŒè¯é”™è¯¯ä¼šæ˜¾ç¤ºå…·ä½“å­—æ®µé”™è¯¯

### 4. æ•°æ®æ ¼å¼

- æ—¶é—´æˆ³ä½¿ç”¨ ISO æ ¼å¼ï¼ˆ`created_at`, `updated_at`ï¼‰
- é€šçŸ¥ç›®æ ‡æ ¹æ®é€šçŸ¥æ–¹å¼ä¸åŒï¼š
  - Email: é€—å·åˆ†éš”çš„é‚®ç®±åœ°å€
  - Webhook: URL
  - Telegram: Chat ID

---

## ğŸ¯ ç‰¹æ€§

### 1. å®Œæ•´åŠŸèƒ½

- âœ… åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤å‘Šè­¦è§„åˆ™
- âœ… å¯ç”¨/ç¦ç”¨å‘Šè­¦è§„åˆ™
- âœ… å®æ—¶æ›´æ–°åˆ—è¡¨
- âœ… ç”¨æˆ·å‹å¥½çš„ç•Œé¢

### 2. æ•°æ®éªŒè¯

- âœ… è§„åˆ™åç§°å¿…å¡«
- âœ… é€šçŸ¥ç›®æ ‡å¿…å¡«
- âœ… é˜ˆå€¼å¿…å¡«ä¸”ä¸ºæ•°å­—
- âœ… è¡¨å•éªŒè¯å’Œé”™è¯¯æç¤º

### 3. ç”¨æˆ·ä½“éªŒ

- âœ… åŠ è½½çŠ¶æ€æ˜¾ç¤º
- âœ… é”™è¯¯æç¤º
- âœ… æˆåŠŸæç¤º
- âœ… ç¡®è®¤å¯¹è¯æ¡†ï¼ˆåˆ é™¤æ“ä½œï¼‰

### 4. å“åº”å¼è®¾è®¡

- âœ… å¯¹è¯æ¡†è‡ªé€‚åº”
- âœ… è¡¨æ ¼å“åº”å¼å¸ƒå±€
- âœ… ç§»åŠ¨ç«¯å‹å¥½

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å‘Šè­¦è§„åˆ™é…ç½®ç³»ç»Ÿå®ç°æŠ¥å‘Š](./å‘Šè­¦è§„åˆ™é…ç½®ç³»ç»Ÿå®ç°æŠ¥å‘Š_20250117.md)
- [å‘Šè­¦è§„åˆ™é›†æˆå®ŒæˆæŠ¥å‘Š](./å‘Šè­¦è§„åˆ™é›†æˆå®ŒæˆæŠ¥å‘Š_20250117.md)
- [é€šçŸ¥æœåŠ¡å®ç°å®ŒæˆæŠ¥å‘Š](./é€šçŸ¥æœåŠ¡å®ç°å®ŒæˆæŠ¥å‘Š_20250117.md)

---

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºé”™è¯¯ç‡å‘Šè­¦è§„åˆ™

```typescript
const rule: AlertRuleCreate = {
  name: "è´¦å·é”™è¯¯ç‡è­¦å‘Š",
  rule_type: "error_rate",
  alert_level: "warning",
  threshold_value: 0.2, // 20%
  threshold_operator: ">",
  enabled: true,
  notification_method: "email",
  notification_target: "admin@example.com, team@example.com",
  description: "å½“è´¦å·é”™è¯¯ç‡è¶…è¿‡ 20% æ—¶å‘é€é‚®ä»¶å‘Šè­¦",
};

const result = await createAlertRule(rule);
```

### æ›´æ–°å‘Šè­¦è§„åˆ™

```typescript
const updates: AlertRuleUpdate = {
  threshold_value: 0.15, // æ›´æ–°é˜ˆå€¼ä¸º 15%
  enabled: false, // ç¦ç”¨è§„åˆ™
};

const result = await updateAlertRule(ruleId, updates);
```

### å¯ç”¨/ç¦ç”¨è§„åˆ™

```typescript
// å¯ç”¨
await enableAlertRule(ruleId);

// ç¦ç”¨
await disableAlertRule(ruleId);
```

---

## âœ… æˆåŠŸè¦ç‚¹

1. **å®Œæ•´çš„ CRUD åŠŸèƒ½**
   - åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤å‘Šè­¦è§„åˆ™
   - å¯ç”¨/ç¦ç”¨åŠŸèƒ½

2. **æ•°æ®ä¸€è‡´æ€§**
   - å‰ç«¯æ•°æ®ç»“æ„ä¸åç«¯ Schema å®Œå…¨åŒ¹é…
   - API ç«¯ç‚¹æ­£ç¡®æ˜ å°„

3. **ç”¨æˆ·ä½“éªŒ**
   - å‹å¥½çš„ç•Œé¢
   - æ¸…æ™°çš„é”™è¯¯æç¤º
   - å®æ—¶æ›´æ–°

4. **ä»£ç è´¨é‡**
   - TypeScript ç±»å‹å®‰å…¨
   - é”™è¯¯å¤„ç†å®Œå–„
   - ä»£ç ç»“æ„æ¸…æ™°

---

**æŠ¥å‘Šç”Ÿæˆå®Œæˆæ—¶é—´**: 2025-01-17  
**å½“å‰çŠ¶æ€**: ğŸŸ¢ å‰ç«¯å‘Šè­¦è§„åˆ™ç®¡ç†ç•Œé¢å·²å®Œæˆï¼Œæ”¯æŒå®Œæ•´çš„ CRUD æ“ä½œå’Œå¯ç”¨/ç¦ç”¨åŠŸèƒ½

