# 部署到服務器 165.154.233.55 的命令

## 步驟 1: SSH 連接到服務器

在您的 Windows PowerShell 或 CMD 中執行：

```bash
ssh ubuntu@165.154.233.55
```

輸入密碼後，您將進入服務器終端。

## 步驟 2: 檢查項目目錄

在服務器上執行以下命令，檢查項目是否存在：

```bash
# 檢查常見的項目目錄
ls -la ~/liaotian
ls -la ~/telegram-ai-system

# 如果兩個目錄都不存在，需要克隆倉庫
```

## 步驟 3A: 如果項目不存在，克隆倉庫

```bash
# 創建並進入項目目錄
mkdir -p ~/liaotian
cd ~/liaotian

# 克隆 GitHub 倉庫
git clone https://github.com/victor2025PH/liaotianai1201.git .

# 或使用另一個目錄名
mkdir -p ~/telegram-ai-system
cd ~/telegram-ai-system
git clone https://github.com/victor2025PH/liaotianai1201.git .
```

## 步驟 3B: 如果項目已存在，拉取最新代碼並部署

```bash
# 進入項目目錄（根據實際目錄選擇）
cd ~/liaotian
# 或
cd ~/telegram-ai-system

# 執行自動部署腳本
bash deploy/从GitHub拉取并部署.sh
```

## 步驟 4: 如果自動腳本不存在，手動部署

```bash
# 進入項目目錄
cd ~/liaotian
# 或
cd ~/telegram-ai-system

# 從 GitHub 拉取最新代碼
git fetch origin
git pull origin main

# 進入後端目錄
cd admin-backend

# 創建虛擬環境（如果不存在）
if [ ! -d ".venv" ]; then
    python3 -m venv .venv
fi

# 激活虛擬環境
source .venv/bin/activate

# 安裝依賴（如果需要）
pip install -r requirements.txt

# 停止舊服務
pkill -9 -f 'uvicorn.*app.main:app' || true
sleep 2

# 啟動新服務
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 > /tmp/backend.log 2>&1 &

# 等待服務啟動
sleep 5

# 檢查服務狀態
curl http://localhost:8000/health
```

## 步驟 5: 驗證部署

```bash
# 檢查進程
ps aux | grep uvicorn

# 檢查端口
netstat -tlnp | grep 8000

# 健康檢查
curl http://localhost:8000/health

# 查看日誌
tail -f /tmp/backend.log
```
