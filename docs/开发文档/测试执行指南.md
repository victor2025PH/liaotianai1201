# Telegram注册系统 - 测试执行指南

## 🎯 测试目标

验证Telegram注册系统的所有功能是否正常工作，包括：
- 后端API功能
- 前端页面功能
- 数据库操作
- 系统集成

## 📋 测试前准备

### 1. 确认服务运行

```bash
# 检查后端服务
netstat -ano | findstr :8000

# 检查前端服务
netstat -ano | findstr :5173
```

### 2. 运行系统测试脚本

```bash
cd admin-backend
python test_full_system.py
```

这个脚本会自动检查：
- ✅ 后端服务健康
- ✅ 前端服务健康
- ✅ 数据库状态
- ✅ API端点
- ✅ 配置文件

## 🧪 测试步骤

### 阶段1: 系统健康检查 ✅

**目标**: 确认所有服务正常运行

**方法**: 运行 `test_full_system.py`

**预期结果**: 所有检查项通过

### 阶段2: 前端页面测试

#### 2.1 访问前端

1. 打开浏览器
2. 访问 http://localhost:5173
3. 确认页面加载正常

#### 2.2 登录系统

1. 输入有效的邮箱和密码
2. 点击登录
3. 确认登录成功

#### 2.3 访问注册页面

1. 点击左侧菜单"账户中心"
2. 点击"Telegram注册"标签页
3. 确认页面正常显示

**检查项**:
- [ ] 页面加载无错误
- [ ] 步骤指示器显示
- [ ] 表单字段显示
- [ ] 服务器列表加载

### 阶段3: 功能测试

#### 3.1 表单验证测试

**测试手机号格式验证**:
- [ ] 输入 `1234567890` (缺少+号) → 应显示错误
- [ ] 输入 `+123` (太短) → 应显示错误
- [ ] 输入 `+1234567890` → 应通过验证

**测试必填字段**:
- [ ] 不填手机号 → 应显示必填提示
- [ ] 不选择服务器 → 应显示必填提示

#### 3.2 注册流程测试

**步骤1: 配置信息**
1. 填写手机号: `+1234567890` (使用真实手机号)
2. 选择国家代码: `+1`
3. 选择服务器: `worker-01`
4. 点击"开始注册"

**预期结果**:
- [ ] 按钮显示加载状态
- [ ] 如果成功: 跳转到步骤2
- [ ] 显示倒计时
- [ ] 显示风险评分
- [ ] 如果失败: 显示错误提示

**步骤2: 验证码输入**
1. 查看手机收到的验证码
2. 在输入框中输入验证码
3. 点击"验证"

**预期结果**:
- [ ] 如果正确: 跳转到步骤3
- [ ] 如果错误: 显示错误提示
- [ ] 如果过期: 显示过期提示

**步骤3: 完成**
**预期结果**:
- [ ] 显示成功消息
- [ ] 显示Session文件信息
- [ ] 显示"注册新的账号"按钮

### 阶段4: API测试（使用Swagger UI）

#### 4.1 访问API文档

1. 打开浏览器
2. 访问 http://localhost:8000/docs
3. 找到 `telegram-registration` 标签

#### 4.2 获取认证Token

1. 找到 `auth` 标签
2. 使用登录接口获取token
3. 点击右上角"Authorize"按钮
4. 输入token

#### 4.3 测试端点

**POST /telegram-registration/start**

请求体:
```json
{
  "phone": "+1234567890",
  "country_code": "+1",
  "node_id": "worker-01"
}
```

**POST /telegram-registration/verify**

请求体:
```json
{
  "registration_id": "从start接口获得",
  "code": "12345"
}
```

**GET /telegram-registration/status/{registration_id}**

**POST /telegram-registration/cancel**

请求体:
```json
{
  "registration_id": "要取消的注册ID"
}
```

### 阶段5: 异常场景测试

#### 5.1 网络错误
- [ ] 断开网络连接
- [ ] 尝试注册
- [ ] 应显示网络错误提示

#### 5.2 速率限制
- [ ] 快速连续注册多次
- [ ] 应触发速率限制
- [ ] 应显示等待时间

#### 5.3 验证码错误
- [ ] 输入错误的验证码
- [ ] 应显示错误提示
- [ ] 允许重试

#### 5.4 验证码过期
- [ ] 等待5分钟后输入验证码
- [ ] 应显示过期提示
- [ ] 可以重新开始

## 📊 测试结果记录

### 测试检查清单

#### 后端测试
- [ ] 服务启动成功
- [ ] API端点可访问
- [ ] 认证机制正常
- [ ] 数据库操作正常

#### 前端测试
- [ ] 页面加载正常
- [ ] 表单验证正常
- [ ] 注册流程正常
- [ ] 错误处理正常

#### 集成测试
- [ ] 完整注册流程
- [ ] 异常场景处理
- [ ] 用户体验良好

### 问题记录

**发现问题**:
1. [问题描述]
   - 重现步骤:
   - 预期结果:
   - 实际结果:
   - 严重程度: [高/中/低]

### 测试报告模板

```
测试日期: YYYY-MM-DD
测试人员: [姓名]
测试环境: [描述]

=== 测试结果 ===
后端服务: [通过/失败]
前端服务: [通过/失败]
API功能: [通过/失败]
前端功能: [通过/失败]
集成测试: [通过/失败]

=== 发现的问题 ===
1. [问题描述]
2. [问题描述]

=== 建议 ===
1. [建议内容]
2. [建议内容]
```

## 🔧 测试工具

### 自动化测试脚本

1. **test_full_system.py**
   - 系统健康检查
   - 自动验证所有组件

2. **test_api_endpoints.py**
   - API端点测试
   - 不需要认证

3. **test_registration_flow.py**
   - 注册流程测试
   - 需要认证token

4. **verify_migration.py**
   - 数据库验证
   - 检查表创建

### 使用方法

```bash
# 完整系统测试
cd admin-backend
python test_full_system.py

# API端点测试
python test_api_endpoints.py

# 注册流程测试（需要token）
python test_registration_flow.py

# 数据库验证
python verify_migration.py
```

## ✅ 测试完成标准

### 必须通过的项目

1. ✅ 后端服务正常运行
2. ✅ 前端服务正常运行
3. ✅ 数据库迁移完成
4. ✅ API端点可访问
5. ✅ 前端页面可访问

### 功能测试通过标准

1. ✅ 表单验证正常
2. ✅ 注册流程完整
3. ✅ 错误处理正常
4. ✅ 用户体验良好

## 🎉 测试完成

当所有测试项通过后，系统即可投入使用！

---

**提示**: 测试过程中如发现问题，请及时记录并修复。

