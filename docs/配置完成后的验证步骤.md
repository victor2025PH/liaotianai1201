# âœ… é…ç½®å®Œæˆåçš„éªŒè¯æ­¥éª¤

## ğŸ‰ é…ç½®çŠ¶æ€

æ ¹æ®ä½ çš„æˆªå›¾ï¼Œé…ç½®å·²ç»åŸºæœ¬å®Œæˆï¼š
- âœ… Nginx é…ç½®æµ‹è¯•æˆåŠŸ
- âœ… æœåŠ¡å·²å¯ç”¨å’Œå¯åŠ¨
- âœ… é…ç½®å‘½ä»¤æ‰§è¡Œå®Œæˆ

---

## ğŸ” éªŒè¯éƒ¨ç½²æ˜¯å¦æˆåŠŸ

### æ–¹æ³• 1: ä½¿ç”¨éªŒè¯è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd ~/liaotian

# å¦‚æœè„šæœ¬å·²å­˜åœ¨
bash scripts/verify_deployment.sh

# æˆ–è€…ç›´æ¥æ‰§è¡ŒéªŒè¯å‘½ä»¤
bash -c '
echo "æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
systemctl status liaotian-backend --no-pager -l | head -10
echo ""
systemctl status liaotian-frontend --no-pager -l | head -10
echo ""
echo "æ£€æŸ¥ç«¯å£..."
ss -tlnp | grep -E ":(80|3000|8000)"
'
```

### æ–¹æ³• 2: æ‰‹åŠ¨éªŒè¯

#### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥åç«¯æœåŠ¡
sudo systemctl status liaotian-backend

# æ£€æŸ¥å‰ç«¯æœåŠ¡
sudo systemctl status liaotian-frontend

# æ£€æŸ¥ Nginx
sudo systemctl status nginx
```

#### 2. æ£€æŸ¥ç«¯å£

```bash
# æ£€æŸ¥æ‰€æœ‰ç›¸å…³ç«¯å£
ss -tlnp | grep -E ":(80|3000|8000)"
```

é¢„æœŸè¾“å‡ºåº”è¯¥æ˜¾ç¤ºï¼š
- ç«¯å£ 80ï¼ˆNginxï¼‰
- ç«¯å£ 3000ï¼ˆå‰ç«¯ï¼‰
- ç«¯å£ 8000ï¼ˆåç«¯ï¼‰

#### 3. æµ‹è¯• HTTP å“åº”

```bash
# æµ‹è¯•åç«¯å¥åº·æ£€æŸ¥ï¼ˆç›´æ¥è®¿é—®ï¼‰
curl http://localhost:8000/health

# æµ‹è¯•å‰ç«¯ï¼ˆç›´æ¥è®¿é—®ï¼‰
curl -s http://localhost:3000 | head -10

# æµ‹è¯• Nginx ä»£ç†
curl http://localhost/health
curl -s http://localhost/ | head -10
```

#### 4. æ£€æŸ¥æœåŠ¡æ—¥å¿—

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
sudo journalctl -u liaotian-backend -n 50 --no-pager

# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
sudo journalctl -u liaotian-frontend -n 50 --no-pager

# æŸ¥çœ‹ Nginx æ—¥å¿—
sudo tail -20 /var/log/nginx/liaotian-error.log
sudo tail -20 /var/log/nginx/liaotian-access.log
```

---

## ğŸ”§ å¦‚æœæœåŠ¡æœªè¿è¡Œ

### æ£€æŸ¥åç«¯æœåŠ¡

```bash
# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
sudo systemctl status liaotian-backend -l

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u liaotian-backend -n 100 --no-pager

# æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
cd ~/liaotian/admin-backend
python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### æ£€æŸ¥å‰ç«¯æœåŠ¡

```bash
# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
sudo systemctl status liaotian-frontend -l

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u liaotian-frontend -n 100 --no-pager

# æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
cd ~/liaotian/saas-demo
npm start
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯åç«¯
sudo systemctl restart liaotian-backend
sleep 5
sudo systemctl status liaotian-backend

# é‡å¯å‰ç«¯
sudo systemctl restart liaotian-frontend
sleep 5
sudo systemctl status liaotian-frontend

# é‡å¯ Nginx
sudo systemctl restart nginx
```

---

## ğŸŒ å¤–éƒ¨è®¿é—®æµ‹è¯•

### é…ç½®é˜²ç«å¢™ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# å…è®¸ HTTP è®¿é—®
sudo ufw allow 80/tcp

# å…è®¸ HTTPS è®¿é—®ï¼ˆå¦‚æœé…ç½®äº† SSLï¼‰
sudo ufw allow 443/tcp

# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
sudo ufw status
```

### ä»æµè§ˆå™¨è®¿é—®

1. **å‰ç«¯ç•Œé¢**: `http://165.154.233.55/`
2. **åç«¯ API æ–‡æ¡£**: `http://165.154.233.55/docs`
3. **å¥åº·æ£€æŸ¥**: `http://165.154.233.55/health`

---

## âœ… éªŒè¯æ¸…å•

å®Œæˆä»¥ä¸‹æ£€æŸ¥ï¼š

- [ ] Nginx æœåŠ¡è¿è¡Œä¸­
- [ ] åç«¯æœåŠ¡è¿è¡Œä¸­
- [ ] å‰ç«¯æœåŠ¡è¿è¡Œä¸­
- [ ] ç«¯å£ 80 ç›‘å¬ä¸­
- [ ] ç«¯å£ 3000 ç›‘å¬ä¸­
- [ ] ç«¯å£ 8000 ç›‘å¬ä¸­
- [ ] `curl http://localhost:8000/health` è¿”å› `{"status":"ok"}`
- [ ] `curl http://localhost:3000` è¿”å› HTML å†…å®¹
- [ ] `curl http://localhost/health` é€šè¿‡ Nginx ä»£ç†æ­£å¸¸
- [ ] å¯ä»¥ä»å¤–éƒ¨æµè§ˆå™¨è®¿é—® `http://165.154.233.55/`

---

## ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. å¦‚æœæ‰€æœ‰æœåŠ¡éƒ½æ­£å¸¸è¿è¡Œ

æ­å–œï¼ä½ å¯ä»¥ï¼š

1. **è®¿é—®å‰ç«¯ç•Œé¢**: åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://165.154.233.55/`
2. **æµ‹è¯•åŠŸèƒ½**: éªŒè¯æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸
3. **é…ç½®åŸŸå**ï¼ˆå¯é€‰ï¼‰: å¦‚æœæœ‰åŸŸåï¼Œæ›´æ–° Nginx é…ç½®ä¸­çš„ `server_name`
4. **é…ç½® SSL**ï¼ˆå¯é€‰ï¼‰: ä½¿ç”¨ Let's Encrypt é…ç½® HTTPS

### 2. å¦‚æœæœåŠ¡æœ‰é—®é¢˜

1. **æŸ¥çœ‹æ—¥å¿—**: ä½¿ç”¨ä¸Šé¢çš„æ—¥å¿—æŸ¥çœ‹å‘½ä»¤
2. **æ£€æŸ¥é…ç½®**: ç¡®è®¤æ‰€æœ‰é…ç½®æ–‡ä»¶æ­£ç¡®
3. **é‡å¯æœåŠ¡**: å°è¯•é‡å¯æœ‰é—®é¢˜çš„æœåŠ¡
4. **æ£€æŸ¥ä¾èµ–**: ç¡®ä¿æ‰€æœ‰ä¾èµ–éƒ½å·²å®‰è£…

---

## ğŸ“ å¸¸ç”¨ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
sudo systemctl status liaotian-backend liaotian-frontend nginx

# é‡å¯æ‰€æœ‰æœåŠ¡
sudo systemctl restart liaotian-backend liaotian-frontend nginx

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u liaotian-backend -f
sudo journalctl -u liaotian-frontend -f

# ç¦ç”¨æœåŠ¡ï¼ˆå¦‚æœéœ€è¦ï¼‰
sudo systemctl disable liaotian-backend
sudo systemctl disable liaotian-frontend

# å¯ç”¨æœåŠ¡
sudo systemctl enable liaotian-backend
sudo systemctl enable liaotian-frontend
```

---

## ğŸ” å¸¸è§é—®é¢˜

### é—®é¢˜ 1: æœåŠ¡å¯åŠ¨åç«‹å³é€€å‡º

**åŸå› **: å¯èƒ½æ˜¯é…ç½®æ–‡ä»¶é”™è¯¯æˆ–ä¾èµ–ç¼ºå¤±

**è§£å†³**:
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u liaotian-backend -n 100
sudo journalctl -u liaotian-frontend -n 100
```

### é—®é¢˜ 2: ç«¯å£è¢«å ç”¨

**è§£å†³**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo ss -tlnp | grep :3000
sudo ss -tlnp | grep :8000

# åœæ­¢å ç”¨è¿›ç¨‹
sudo kill -9 <PID>
```

### é—®é¢˜ 3: Nginx 502 Bad Gateway

**åŸå› **: åç«¯æˆ–å‰ç«¯æœåŠ¡æœªè¿è¡Œ

**è§£å†³**:
```bash
# ç¡®ä¿æœåŠ¡è¿è¡Œ
sudo systemctl start liaotian-backend
sudo systemctl start liaotian-frontend

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status liaotian-backend
sudo systemctl status liaotian-frontend
```

---

**æœ€åæ›´æ–°**: 2025-12-07
