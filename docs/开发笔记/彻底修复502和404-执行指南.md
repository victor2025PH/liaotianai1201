# 彻底修复502和404问题 - 执行指南

## 📍 执行位置

**所有命令都在远程服务器上执行：`ubuntu@165.154.233.55`**

## 🚀 快速执行

### 方法1: 使用一键脚本（推荐）

```bash
# 在远程服务器上执行
ssh ubuntu@165.154.233.55
bash ~/liaotian/deploy/一键修复502和404.sh
```

### 方法2: 手动执行步骤

按照 `deploy/彻底修复502和404-完整方案.md` 中的步骤逐步执行。

## 📋 修复步骤总结

### 任务一：修复 502 Bad Gateway

1. ✅ **检查前端端口配置** - package.json 中 dev 脚本应使用 `-p 3000`
2. ✅ **重启后端服务** - 端口 8000
3. ✅ **重启前端服务** - 端口 3000
4. ✅ **重载Nginx** - 使配置生效
5. ✅ **验证所有服务** - 确认返回 200/302/304 而不是 502

### 任务二：修复 404 账号不存在

1. ✅ **登录获取token**
2. ✅ **获取账号列表** - 保存到 /tmp/group_ai_accounts.json
3. ✅ **检查目标账号是否存在** - 检查 639277358115
4. ✅ **搜索代码中的引用** - 查找硬编码的账号ID
5. ✅ **替换或创建账号** - 使用真实存在的账号ID替换
6. ✅ **重启后端服务** - 如果代码被修改
7. ✅ **验证修复** - PUT请求应返回 200 而不是 404

## 📝 已创建的脚本文件

1. **`deploy/一键修复502和404.sh`** - 完整自动化修复脚本
2. **`deploy/彻底修复502和404问题.sh`** - 详细修复脚本（bash版本）
3. **`deploy/彻底修复502和404问题.py`** - 详细修复脚本（Python版本）
4. **`deploy/修复502和404-分步执行.sh`** - 分步执行脚本
5. **`deploy/彻底修复502和404-完整方案.md`** - 完整方案文档

## 🎯 预期结果

### 502问题修复后

- ✅ `curl http://localhost:8000/health` 返回 200
- ✅ `curl http://localhost:3000` 返回 200 或 304
- ✅ `curl http://aikz.usdt2026.cc/group-ai/accounts` 返回 200、302 或 304（不是502）

### 404问题修复后

- ✅ PUT请求不再返回 404
- ✅ 账号ID使用真实存在的账号
- ✅ 代码中的硬编码ID已被替换（如果存在）

## 🔧 从零启动服务的命令清单

```bash
# 在远程服务器 ubuntu@165.154.233.55 上执行

# 1. 启动后端服务
cd ~/liaotian/admin-backend
source .venv/bin/activate
pkill -f "uvicorn.*app.main:app" || true
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 > /tmp/backend.log 2>&1 &
sleep 5

# 2. 启动前端服务
cd ~/liaotian/saas-demo
pkill -f "next.*dev\|node.*3000" || true
nohup npm run dev > /tmp/frontend.log 2>&1 &
sleep 15

# 3. 重载Nginx
sudo systemctl reload nginx

# 4. 验证服务
curl -I http://localhost:8000/health
curl -I http://localhost:3000
curl -I http://aikz.usdt2026.cc/group-ai/accounts
```

## 📊 修复总结模板

修复完成后，请记录：

### 502问题的根本原因
- [ ] 前端端口配置错误
- [ ] 前端服务未启动
- [ ] 后端服务未启动
- [ ] Nginx配置错误
- [ ] 其他原因: _______________

### 修改的文件
- [ ] `saas-demo/package.json` - 端口配置
- [ ] Nginx配置文件 - 代理配置
- [ ] 其他文件: _______________

### 404问题的修复方式
- [ ] 方案A: 替换为真实存在的账号ID
- [ ] 方案B: 创建新账号
- [ ] 其他方式: _______________

### 修改的文件
- [ ] `saas-demo/src/...` - 前端代码
- [ ] `admin-backend/app/...` - 后端代码
- [ ] 其他文件: _______________

---

**重要提示**: 所有操作都在远程服务器上执行，不要在本地Windows电脑上执行！
