# 一键部署角色选择功能 - 直接复制执行

## 问题说明

服务当前是停止状态，需要：
1. 上传文件到服务器
2. 替换文件
3. 重新构建
4. 复制standalone文件
5. 启动服务

## 部署步骤

### 步骤1：上传文件（在本地PowerShell执行）

```powershell
scp saas-demo/src/app/group-ai/accounts/page.tsx ubuntu@165.154.233.55:/tmp/accounts_page.tsx
```

### 步骤2：在服务器上执行完整部署（SSH登录后，直接复制整行执行）

```bash
cd /home/ubuntu/liaotian/saas-demo && sudo systemctl stop liaotian-frontend && cp /tmp/accounts_page.tsx src/app/group-ai/accounts/page.tsx && rm -rf .next/standalone && export NVM_DIR="$HOME/.nvm" && [ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh" && nvm use 20 && npm run build && mkdir -p .next/standalone/liaotian/saas-demo/.next/server && cp .next/BUILD_ID .next/standalone/liaotian/saas-demo/.next/ && cp .next/*.json .next/standalone/liaotian/saas-demo/.next/ && cp -r .next/server/* .next/standalone/liaotian/saas-demo/.next/server/ && cp -r .next/static .next/standalone/liaotian/saas-demo/.next/ && sudo systemctl start liaotian-frontend && sleep 5 && sudo systemctl status liaotian-frontend --no-pager | head -15
```

### 步骤3：验证部署

```bash
# 检查服务状态
sudo systemctl status liaotian-frontend --no-pager | head -15

# 检查文件
ls -la .next/standalone/liaotian/saas-demo/.next/server/pages-manifest.json

# 测试服务
curl -I http://localhost:3000/group-ai/accounts
```

## 如果构建失败

如果构建过程中出现错误，可以分步执行：

```bash
# 1. 进入目录
cd /home/ubuntu/liaotian/saas-demo

# 2. 停止服务
sudo systemctl stop liaotian-frontend

# 3. 替换文件
cp /tmp/accounts_page.tsx src/app/group-ai/accounts/page.tsx

# 4. 清理standalone
rm -rf .next/standalone

# 5. 加载NVM
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"
nvm use 20

# 6. 构建（查看完整输出）
npm run build

# 7. 复制文件
mkdir -p .next/standalone/liaotian/saas-demo/.next/server
cp .next/BUILD_ID .next/standalone/liaotian/saas-demo/.next/
cp .next/*.json .next/standalone/liaotian/saas-demo/.next/
cp -r .next/server/* .next/standalone/liaotian/saas-demo/.next/server/
cp -r .next/static .next/standalone/liaotian/saas-demo/.next/

# 8. 启动服务
sudo systemctl start liaotian-frontend
sleep 5

# 9. 检查状态
sudo systemctl status liaotian-frontend --no-pager | head -15
```

## 预期结果

部署成功后：
- ✅ 服务状态：`Active: active (running)`
- ✅ 页面可以正常访问：http://aikz.usdt2026.cc/group-ai/accounts
- ✅ 点击"分配剧本"按钮，对话框显示账号信息和角色选择
- ✅ 角色可以点击选择，显示已选状态和已被使用状态

