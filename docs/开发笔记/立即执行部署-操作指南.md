# 立即执行部署 - 操作指南

> **创建时间**: 2025-11-29  
> **状态**: 准备执行部署

---

## 🚀 立即执行（最简单方式）

### 方式 1: 直接SSH执行（推荐）⭐⭐⭐

在您的终端（PowerShell 或 CMD）中执行：

```bash
ssh ubuntu@165.154.233.55 "cd ~/liaotian && git pull origin master && bash deploy/从GitHub拉取并部署.sh"
```

这个命令会：
1. ✅ 连接到服务器
2. ✅ 切换到项目目录
3. ✅ 从GitHub拉取最新代码
4. ✅ 执行部署脚本
5. ✅ 显示完整输出

---

### 方式 2: 使用批处理脚本

双击运行：
```
deploy\一键执行完整部署.bat
```

或者在 PowerShell 中：
```powershell
.\deploy\一键执行完整部署.bat
```

---

### 方式 3: 分步执行（如果自动执行失败）

```bash
# 1. SSH 登录服务器
ssh ubuntu@165.154.233.55

# 2. 切换到项目目录
cd ~/liaotian

# 3. 从GitHub拉取最新代码
git pull origin master

# 4. 确保脚本可执行并转换行尾符
sed -i 's/\r$//' deploy/从GitHub拉取并部署.sh
chmod +x deploy/从GitHub拉取并部署.sh

# 5. 执行部署
bash deploy/从GitHub拉取并部署.sh
```

---

## ✅ 成功验证标准

执行后，您应该看到：

### 1. 不再出现行尾符错误 ✅

**之前的错误**（已修复）:
```
$'\r': command not found
```

**现在应该**: 不再出现此错误

---

### 2. 看到正常的执行步骤 ✅

```
=========================================
从 GitHub 拉取最新代码并部署
开始时间: Sat Nov 29 19:45:37 PST 2025
=========================================

【步骤1】备份当前代码...
  ✓ 备份 accounts.py

【步骤2】从 GitHub 拉取最新代码...
  当前分支: master
  ✓ 代码拉取完成
  
  最近的提交:
  781dcf1 修复 Windows/Linux 行尾符兼容性问题

【步骤3】验证关键文件...
  ✓ accounts.py 存在（包含 X 处 UPSERT）

【步骤4】重启后端服务...
  ✓ 后端服务已启动

【步骤5】验证服务...
  ✓ 后端服务正常运行

=========================================
部署完成！
=========================================
```

---

## 📊 执行后验证清单

- [ ] ✅ **无行尾符错误** - 不再看到 `$'\r': command not found`
- [ ] ✅ **代码成功拉取** - 看到最新提交 781dcf1
- [ ] ✅ **后端服务重启** - 看到服务正常运行
- [ ] ✅ **健康检查通过** - 看到"后端服务正常运行"

---

## 🎯 部署成功后的下一步

### 1. 验证 UPSERT 功能

在前端界面测试分配剧本功能：
- 访问 `http://aikz.usdt2026.cc/group-ai/scripts`
- 尝试为账号分配剧本和角色
- 验证不再出现"账号不存在"错误

### 2. 清理项目文件

整理 `deploy/` 目录，归档临时脚本。

---

## 🔧 如果部署失败

### 常见问题

#### 1. SSH 连接失败

**错误**: `Permission denied` 或 `Connection refused`

**解决**:
- 检查服务器IP是否正确: `165.154.233.55`
- 确认SSH密钥或密码是否正确
- 尝试手动SSH登录: `ssh ubuntu@165.154.233.55`

#### 2. 行尾符错误仍然出现

**错误**: `$'\r': command not found`

**解决**:
```bash
# 在服务器上手动修复
cd ~/liaotian
sed -i 's/\r$//' deploy/从GitHub拉取并部署.sh
chmod +x deploy/从GitHub拉取并部署.sh
bash deploy/从GitHub拉取并部署.sh
```

#### 3. Git pull 失败

**错误**: `fatal: not a git repository` 或 `fatal: Could not read from remote repository`

**解决**:
```bash
# 检查Git配置
cd ~/liaotian
git status
git remote -v

# 如果需要，重新设置远程仓库
git remote set-url origin https://github.com/victor2025PH/loaotian1127.git
```

---

## 💡 推荐执行命令

**最推荐的方式**（最简单、最可靠）:

```bash
ssh ubuntu@165.154.233.55 "cd ~/liaotian && git pull origin master && bash deploy/从GitHub拉取并部署.sh"
```

---

**准备好后，请执行上述命令！** 🚀

执行完成后，请告诉我结果，我会继续后续步骤。
