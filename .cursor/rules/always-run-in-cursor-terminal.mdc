# 始终在 Cursor 终端中运行服务

## ⚠️ 重要：AI 助手必须读取此规则

**在执行任何启动服务的命令之前，AI 助手必须：**
1. ✅ **首先读取此规则文件** (`.cursor/rules/always-run-in-cursor-terminal.mdc`)
2. ✅ **检查并遵守所有禁止的操作**
3. ✅ **使用推荐的启动方式**
4. ✅ **验证服务在 Cursor 终端中运行，而不是外部窗口**

**如果 AI 助手违反此规则，用户将无法实时查看日志，问题难以调试！**

## 规则说明
**所有服务（前端、后端）必须始终在 Cursor 的集成终端中运行**，而不是在外部 PowerShell 窗口中运行。这样可以：
1. 实时监控服务日志
2. 快速发现和调试问题
3. 统一管理所有服务
4. AI 助手可以实时查看日志并快速定位问题

## 启动服务的方式

### ⭐ 方式 1：使用简化脚本（最推荐，最简单）
**在 Cursor 中打开两个终端标签页，分别运行：**

```powershell
# 终端标签页 1 - 后端
.\scripts\start_backend.ps1

# 终端标签页 2 - 前端
.\scripts\start_frontend.ps1
```

**优势：**
- ✅ 日志实时显示在 Cursor 终端中
- ✅ AI 助手可以实时查看日志
- ✅ 简单直接，无需复杂配置
- ✅ 使用 Ctrl+C 可以随时停止

### 方式 2：直接运行命令（推荐用于调试）
```powershell
# 终端标签页 1 - 后端
cd admin-backend
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

# 终端标签页 2 - 前端
cd saas-demo
npm run dev
```

### 方式 3：使用日志文件方式（需要监控多个服务时）
```powershell
# 在 Cursor 终端中运行（推荐）
.\scripts\start_services_with_logs.ps1

# 只启动后端
.\scripts\start_services_with_logs.ps1 -BackendOnly

# 只启动前端
.\scripts\start_services_with_logs.ps1 -FrontendOnly
```

### 方式 4：使用后台任务（不推荐，日志可能不完整）
```powershell
# 仅在特殊情况下使用
.\scripts\start_services_in_cursor.ps1
```

## 禁止的操作
- ❌ **禁止**使用 `Start-Process -WindowStyle Minimized` 在外部窗口启动服务
- ❌ **禁止**使用 `Start-Process` 创建隐藏窗口
- ❌ **禁止**在外部 PowerShell 窗口中运行服务
- ❌ **禁止**使用 `-WindowStyle Hidden` 或 `-WindowStyle Minimized`

## 监控日志

### 实时监控（推荐）
使用 `start_services_with_logs.ps1` 脚本，日志会实时显示在 Cursor 终端中，带时间戳和颜色区分。

### 查看日志文件
如果使用 `-NoMonitor` 参数，日志保存在 `logs/` 目录：
```powershell
# 实时查看后端日志
Get-Content logs\backend.log -Wait -Tail 50

# 实时查看前端日志
Get-Content logs\frontend.log -Wait -Tail 50
```

## 服务管理

### 停止服务
- 在运行服务的终端中按 `Ctrl+C`
- 或使用脚本自动停止（脚本会处理）

### 检查服务状态
```powershell
# 检查端口占用
Get-NetTCPConnection -LocalPort 8000,3000

# 检查进程
Get-Process | Where-Object {$_.ProcessName -like "*python*" -or $_.ProcessName -like "*node*"}
```

## 故障排查
如果服务无法启动：
1. 检查端口是否被占用：`Get-NetTCPConnection -LocalPort 8000,3000`
2. 检查进程：`Get-Process | Where-Object {$_.ProcessName -like "*python*" -or $_.ProcessName -like "*node*"}`
3. 查看终端中的错误信息
4. 查看日志文件：`logs/backend.log` 和 `logs/frontend.log`

## AI 助手使用规则（重要！）

### 🔴 执行前必须检查清单

**在 AI 助手执行任何启动服务的命令之前，必须完成以下检查：**

1. ✅ **已读取此规则文件** - 使用 `read_file` 工具读取 `.cursor/rules/always-run-in-cursor-terminal.mdc`
2. ✅ **已检查禁止的操作** - 确保不使用 `Start-Process` 创建外部窗口
3. ✅ **已选择正确的启动方式** - 优先使用 `.\scripts\start_backend.ps1` 和 `.\scripts\start_frontend.ps1`
4. ✅ **已验证命令符合规则** - 确保命令在 Cursor 集成终端中运行

### 优先使用方式（按优先级排序）

1. **最推荐**：使用简化脚本，在 Cursor 中打开两个终端标签页
   ```powershell
   # 终端标签页 1
   .\scripts\start_backend.ps1
   
   # 终端标签页 2
   .\scripts\start_frontend.ps1
   ```
   **为什么推荐：** 这些脚本专门设计为在 Cursor 终端中运行，日志实时显示。

2. **次推荐**：直接在终端中运行命令
   ```powershell
   # 终端标签页 1
   cd admin-backend
   python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
   
   # 终端标签页 2
   cd saas-demo
   npm run dev
   ```
   **为什么推荐：** 命令直接在终端中执行，日志实时显示。

3. **备选**：使用日志文件方式（需要同时监控多个服务时）
   ```powershell
   .\scripts\start_services_with_logs.ps1
   ```
   **注意：** 确保此脚本也在 Cursor 终端中运行，而不是外部窗口。

### 严格禁止的操作（违反将导致规则失效）

- ❌ **绝对禁止**使用 `Start-Process -WindowStyle Minimized` 在外部窗口启动服务
- ❌ **绝对禁止**使用 `Start-Process -WindowStyle Hidden` 创建隐藏窗口
- ❌ **绝对禁止**使用 `Start-Process -WindowStyle Normal` 创建外部窗口
- ❌ **绝对禁止**使用 `Start-Process` 创建任何外部 PowerShell 窗口
- ❌ **绝对禁止**在外部 PowerShell 窗口中运行服务
- ❌ **绝对禁止**使用 `Start-Job` 在后台运行服务（除非明确需要且日志已重定向到文件）

### 如何验证服务在 Cursor 终端中运行

执行启动命令后，检查：
1. ✅ 服务日志是否显示在当前 Cursor 终端窗口中
2. ✅ 没有新的外部 PowerShell 窗口被打开
3. ✅ 可以使用 `Ctrl+C` 在终端中停止服务
4. ✅ AI 助手可以通过 `run_terminal_cmd` 查看实时日志

### 为什么必须在 Cursor 终端中运行？
1. **实时监控**：AI 助手可以实时查看日志，快速定位问题
2. **统一管理**：所有服务都在 Cursor 中，便于管理
3. **快速调试**：日志实时显示，问题一目了然
4. **用户体验**：用户可以在 Cursor 中直接看到服务状态

### 监控日志
- 所有日志都会实时显示在 Cursor 终端中
- AI 助手可以通过终端输出实时查看服务状态
- 使用 `Ctrl+C` 可以随时停止服务
