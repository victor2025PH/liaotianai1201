# WebSocket Location 删除说明

## 当前配置情况

从之前的检查可以看到，配置文件中有 **两个重复的** `location /api/v1/notifications/ws` 块：

### 第一个 location 块（保留）
```
第 87-99 行：
    location /api/v1/notifications/ws {
        proxy_pass http://127.0.0.1:8000/api/v1/notifications/ws;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 86400;
        proxy_send_timeout 86400;
        proxy_buffering off;
    }
```
**这个要保留！**

### 第二个 location 块（删除）
```
第 101-114 行：
   # WebSocket 支持 - 通知服务
   location /api/v1/notifications/ws {
       proxy_pass http://127.0.0.1:8000/api/v1/notifications/ws;
       proxy_http_version 1.1;
       proxy_set_header Upgrade $http_upgrade;
       proxy_set_header Connection "upgrade";
       proxy_set_header Host $host;
       proxy_set_header X-Real-IP $remote_addr;
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       proxy_set_header X-Forwarded-Proto $scheme;
       proxy_read_timeout 86400;
       proxy_send_timeout 86400;
       proxy_buffering off;
   }
```
**这个要删除！**（包括前面的注释）

## 删除步骤

### 方法 1：使用 sed 命令（快速）

```bash
# 删除第 101-114 行（包括注释和整个 location 块）
sudo sed -i '101,114d' /etc/nginx/sites-available/aikz.usdt2026.cc
```

### 方法 2：手动编辑（推荐，更安全）

```bash
# 1. 编辑文件
sudo nano /etc/nginx/sites-available/aikz.usdt2026.cc

# 2. 找到第 101 行左右，应该看到：
#    # WebSocket 支持 - 通知服务
#    location /api/v1/notifications/ws {
#        ...
#    }

# 3. 删除从 "# WebSocket 支持 - 通知服务" 这一行开始
#    到对应的 "}" 结束的整个块（大约 14 行）

# 4. 保存：Ctrl+O，然后 Enter
# 5. 退出：Ctrl+X
```

## 验证删除结果

删除后执行：

```bash
# 应该只显示 1 个 location
sudo grep -c 'location /api/v1/notifications/ws' /etc/nginx/sites-available/aikz.usdt2026.cc
# 输出应该是: 1

# 查看剩余的配置（应该只有一个 location 块）
sudo grep -A 15 'location /api/v1/notifications/ws' /etc/nginx/sites-available/aikz.usdt2026.cc
```

## 重要提示

✅ **保留第一个** location 块（第 87-99 行）  
❌ **删除第二个** location 块（第 101-114 行，包括注释）

删除后，配置文件中应该**只有一个** `location /api/v1/notifications/ws` 块。

