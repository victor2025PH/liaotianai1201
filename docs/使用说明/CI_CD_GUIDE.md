# CI/CD æµç¨‹æŒ‡å—

> **æ›´æ–°æ—¥æœŸ**: 2025-01-17  
> **çŠ¶æ€**: âœ… å·²é…ç½® GitHub Actions CI/CD

---

## ğŸ“‹ æ¦‚è¿°

é¡¹ç›®å·²é…ç½®å®Œæ•´çš„ GitHub Actions CI/CD æµç¨‹ï¼ŒåŒ…æ‹¬ï¼š

- âœ… è‡ªåŠ¨åŒ–ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆLintã€Formatï¼‰
- âœ… è‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œ
- âœ… æµ‹è¯•è¦†ç›–ç‡æ£€æŸ¥
- âœ… Docker é•œåƒæ„å»ºéªŒè¯
- âœ… å‰ç«¯æ„å»ºå’Œ E2E æµ‹è¯•

---

## ğŸ”§ CI/CD å·¥ä½œæµ

### 1. æŒç»­é›†æˆï¼ˆCIï¼‰

**æ–‡ä»¶**: `.github/workflows/ci.yml`

**è§¦å‘æ—¶æœº**:
- Push åˆ° `main` æˆ– `develop` åˆ†æ”¯
- åˆ›å»º Pull Request

**å·¥ä½œæµç¨‹**:

#### é˜¶æ®µ 1: ä»£ç è´¨é‡æ£€æŸ¥
1. **Python ä»£ç æ£€æŸ¥**
   - Ruff lint æ£€æŸ¥
   - Black æ ¼å¼åŒ–æ£€æŸ¥
   
2. **å‰ç«¯ä»£ç æ£€æŸ¥**
   - ESLint æ£€æŸ¥
   - æ„å»ºéªŒè¯

#### é˜¶æ®µ 2: è‡ªåŠ¨åŒ–æµ‹è¯•
1. **åç«¯æµ‹è¯•**
   - è¿è¡Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹
   - ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
   - æ£€æŸ¥è¦†ç›–ç‡é˜ˆå€¼ï¼ˆ70%ï¼‰

2. **å‰ç«¯ E2E æµ‹è¯•**
   - Playwright E2E æµ‹è¯•
   - ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

#### é˜¶æ®µ 3: Docker æ„å»º
1. **é•œåƒæ„å»ºéªŒè¯**
   - admin-backend é•œåƒ
   - session-service é•œåƒ
   - admin-frontend é•œåƒ

---

### 2. æµ‹è¯•è¦†ç›–ç‡

**æ–‡ä»¶**: `.github/workflows/test-coverage.yml`

**è§¦å‘æ—¶æœº**:
- Push åˆ° `main` æˆ– `develop` åˆ†æ”¯
- Pull Request
- å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤© UTC 02:00ï¼‰
- æ‰‹åŠ¨è§¦å‘ï¼ˆ`workflow_dispatch`ï¼‰

**åŠŸèƒ½**:
- ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
- ä¸Šä¼ åˆ° Codecovï¼ˆå¦‚æœé…ç½®ï¼‰
- ç”Ÿæˆ HTML è¦†ç›–ç‡æŠ¥å‘Šä¾›ä¸‹è½½

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡é˜ˆå€¼

å½“å‰é¡¹ç›®è®¾ç½®çš„æµ‹è¯•è¦†ç›–ç‡é˜ˆå€¼ä¸º **70%**ã€‚

å¦‚æœæµ‹è¯•è¦†ç›–ç‡ä½äºé˜ˆå€¼ï¼ŒCI æµç¨‹ä¼šå¤±è´¥ã€‚

**æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š**:
1. åœ¨ GitHub Actions é¡µé¢æŸ¥çœ‹å·¥ä½œæµè¿è¡Œç»“æœ
2. ä¸‹è½½ `coverage-html-report` artifact
3. è§£å‹ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `index.html`

---

## ğŸš€ æœ¬åœ°è¿è¡Œ CI æ£€æŸ¥

åœ¨æäº¤ä»£ç å‰ï¼Œå»ºè®®æœ¬åœ°è¿è¡Œ CI æ£€æŸ¥ï¼š

### ä»£ç è´¨é‡æ£€æŸ¥

```bash
cd admin-backend

# Ruff lint æ£€æŸ¥
poetry run ruff check app tests

# Black æ ¼å¼åŒ–æ£€æŸ¥
poetry run black --check app tests

# è‡ªåŠ¨ä¿®å¤æ ¼å¼é—®é¢˜
poetry run black app tests
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
poetry run pytest tests/ -v

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
poetry run pytest tests/ --cov=app --cov-report=term-missing --cov-report=html

# æ£€æŸ¥è¦†ç›–ç‡é˜ˆå€¼
poetry run pytest tests/ --cov=app --cov-report=term
```

---

## ğŸ” CI/CD ç¯å¢ƒå˜é‡

CI/CD æµç¨‹ä½¿ç”¨ä»¥ä¸‹æµ‹è¯•ç¯å¢ƒå˜é‡ï¼ˆä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®ï¼‰ï¼š

| å˜é‡å | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `DATABASE_URL` | `sqlite:///./test_admin.db` | æµ‹è¯•æ•°æ®åº“ |
| `JWT_SECRET` | `test_jwt_secret_for_ci` | JWT å¯†é’¥ |
| `ADMIN_DEFAULT_EMAIL` | `admin@test.com` | ç®¡ç†å‘˜é‚®ç®± |
| `ADMIN_DEFAULT_PASSWORD` | `testpass123` | ç®¡ç†å‘˜å¯†ç  |

---

## ğŸ“ Pull Request æ£€æŸ¥æ¸…å•

åœ¨åˆ›å»º Pull Request å‰ï¼Œè¯·ç¡®ä¿ï¼š

- [ ] æ‰€æœ‰ä»£ç è´¨é‡æ£€æŸ¥é€šè¿‡
  - [ ] Ruff lint æ— é”™è¯¯
  - [ ] Black æ ¼å¼åŒ–æ£€æŸ¥é€šè¿‡
  - [ ] å‰ç«¯ ESLint æ— é”™è¯¯

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
  - [ ] å•å…ƒæµ‹è¯•é€šè¿‡
  - [ ] é›†æˆæµ‹è¯•é€šè¿‡
  - [ ] E2E æµ‹è¯•é€šè¿‡ï¼ˆå¦‚æœé€‚ç”¨ï¼‰

- [ ] æµ‹è¯•è¦†ç›–ç‡æ»¡è¶³è¦æ±‚
  - [ ] è¦†ç›–ç‡ >= 70%
  - [ ] æ–°å¢ä»£ç æœ‰æµ‹è¯•è¦†ç›–

- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
  - [ ] è‡³å°‘ä¸€äººå®¡æŸ¥
  - [ ] å®¡æŸ¥æ„è§å·²å¤„ç†

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. CI å¤±è´¥ï¼šè¦†ç›–ç‡ä½äºé˜ˆå€¼

**é—®é¢˜**: æµ‹è¯•è¦†ç›–ç‡ä½äº 70%

**è§£å†³æ–¹æ¡ˆ**:
- æ·»åŠ ç¼ºå¤±çš„æµ‹è¯•ç”¨ä¾‹
- ç¡®ä¿æ–°å¢ä»£ç æœ‰æµ‹è¯•è¦†ç›–
- ä½¿ç”¨ `--cov-report=html` æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Šï¼Œæ‰¾å‡ºæœªè¦†ç›–çš„ä»£ç 

### 2. CI å¤±è´¥ï¼šä»£ç æ ¼å¼ä¸ç¬¦åˆè§„èŒƒ

**é—®é¢˜**: Black æ ¼å¼åŒ–æ£€æŸ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
cd admin-backend
poetry run black app tests
```
ç„¶åæäº¤ä¿®å¤åçš„ä»£ç ã€‚

### 3. CI å¤±è´¥ï¼šRuff lint é”™è¯¯

**é—®é¢˜**: Ruff æ£€æŸ¥å‘ç°ä»£ç é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:
```bash
cd admin-backend
# æŸ¥çœ‹é—®é¢˜
poetry run ruff check app tests

# è‡ªåŠ¨ä¿®å¤ï¼ˆå¦‚æœå¯ä»¥ï¼‰
poetry run ruff check app tests --fix
```

### 4. å‰ç«¯æ„å»ºå¤±è´¥

**é—®é¢˜**: å‰ç«¯æ„å»ºæˆ– E2E æµ‹è¯•å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
cd admin-frontend
# å®‰è£…ä¾èµ–
npm ci

# è¿è¡Œ lint
npm run lint

# æ„å»º
npm run build

# E2E æµ‹è¯•
npm run test:e2e
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•æŒ‡å—](../æµ‹è¯•æŒ‡å—/)
- [API æ–‡æ¡£](./API_DOCUMENTATION.md)
- [Docker éƒ¨ç½²æŒ‡å—](./DOCKER_DEPLOYMENT.md)

---

## ğŸ”— å‚è€ƒèµ„æº

- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [pytest æ–‡æ¡£](https://docs.pytest.org/)
- [pytest-cov æ–‡æ¡£](https://pytest-cov.readthedocs.io/)
- [Ruff æ–‡æ¡£](https://docs.astral.sh/ruff/)
- [Black æ–‡æ¡£](https://black.readthedocs.io/)

---

**æœ€åæ›´æ–°**: 2025-01-17

