# é‡æ–°éƒ¨ç½²å’Œæ¸¬è©¦æŒ‡å—

> **æ—¥æœŸ**: 2025-12-01  
> **ä»»å‹™**: é‡æ–°éƒ¨ç½²å¾Œç«¯ä¸¦æ¸¬è©¦ä¿®å¾©å¾Œçš„è³¬è™Ÿç‹€æ…‹ç«¯é»

---

## ğŸ“‹ éƒ¨ç½²æ­¥é©Ÿ

### æ–¹æ³• 1: ä½¿ç”¨è‡ªå‹•åŒ–è…³æœ¬ï¼ˆæ¨è–¦ï¼‰

åœ¨æœå‹™å™¨ä¸ŠåŸ·è¡Œï¼š

```bash
# è³¦äºˆåŸ·è¡Œæ¬Šé™
chmod +x deploy/é‡æ–°éƒ¨ç½²ä¸¦æ¸¬è©¦ä¿®å¾©.sh

# åŸ·è¡Œéƒ¨ç½²å’Œæ¸¬è©¦
bash deploy/é‡æ–°éƒ¨ç½²ä¸¦æ¸¬è©¦ä¿®å¾©.sh
```

---

### æ–¹æ³• 2: æ‰‹å‹•éƒ¨ç½²

#### æ­¥é©Ÿ 1: æ‹‰å–æœ€æ–°ä»£ç¢¼

```bash
cd /opt/group-ai
git pull origin main || git pull origin master
```

#### æ­¥é©Ÿ 2: é‡å•Ÿå¾Œç«¯æœå‹™

**ä½¿ç”¨ systemd æœå‹™ï¼ˆæ¨è–¦ï¼‰**:
```bash
sudo systemctl restart smart-tg-backend.service
sudo systemctl status smart-tg-backend.service
```

**æˆ–æ‰‹å‹•é‡å•Ÿ**:
```bash
# åœæ­¢ç¾æœ‰é€²ç¨‹
pkill -f "uvicorn.*app.main:app"

# é€²å…¥å¾Œç«¯ç›®éŒ„
cd /opt/group-ai/admin-backend

# æ¿€æ´»è™›æ“¬ç’°å¢ƒ
source /opt/group-ai/.venv/bin/activate

# å•Ÿå‹•æœå‹™
nohup python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 > /tmp/backend.log 2>&1 &
```

#### æ­¥é©Ÿ 3: é©—è­‰æœå‹™ç‹€æ…‹

```bash
# æª¢æŸ¥å¥åº·ç‹€æ…‹
curl http://localhost:8000/health

# æª¢æŸ¥é€²ç¨‹
ps aux | grep uvicorn
```

---

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### æ¸¬è©¦ 1: ç²å–èªè­‰ Token

```bash
TOKEN=$(curl -s -X POST "http://localhost:8000/api/v1/auth/login" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin@example.com&password=changeme123" | \
  python3 -c "import sys, json; print(json.loads(sys.stdin.read()).get('access_token', ''))")

echo "Token: $TOKEN"
```

### æ¸¬è©¦ 2: æŸ¥çœ‹è³¬è™Ÿè©³æƒ…ï¼ˆå°ç…§æ¸¬è©¦ï¼‰

```bash
curl -s -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8000/api/v1/group-ai/accounts/639454959591" | \
  python3 -m json.tool
```

**é æœŸçµæœ**: HTTP 200ï¼Œè¿”å›è³¬è™Ÿè©³æƒ…

### æ¸¬è©¦ 3: æŸ¥çœ‹è³¬è™Ÿç‹€æ…‹ï¼ˆä¿®å¾©é©—è­‰ï¼‰

```bash
curl -s -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8000/api/v1/group-ai/accounts/639454959591/status" | \
  python3 -m json.tool
```

**é æœŸçµæœ**: 
- âœ… HTTP 200ï¼ˆä¿®å¾©å‰æ˜¯ 404ï¼‰
- âœ… è¿”å›è³¬è™Ÿç‹€æ…‹ï¼Œå³ä½¿è³¬è™Ÿä¸åœ¨ AccountManager ä¸­

**é æœŸéŸ¿æ‡‰æ ¼å¼**:
```json
{
    "account_id": "639454959591",
    "status": "offline",
    "online": false,
    "last_activity": null,
    "message_count": 0,
    "reply_count": 0,
    "redpacket_count": 0,
    "error_count": 0,
    "last_error": null,
    "uptime_seconds": 0
}
```

---

## âœ… å¿«é€Ÿæ¸¬è©¦å‘½ä»¤

åŸ·è¡Œä»¥ä¸‹å®Œæ•´æ¸¬è©¦ï¼š

```bash
# ç²å– Token
TOKEN=$(curl -s -X POST "http://localhost:8000/api/v1/auth/login" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin@example.com&password=changeme123" | \
  python3 -c "import sys, json; print(json.loads(sys.stdin.read()).get('access_token', ''))")

echo "=== æ¸¬è©¦è³¬è™Ÿç‹€æ…‹ç«¯é»ä¿®å¾© ===" && \
echo "" && \
echo "ã€æ¸¬è©¦ 1ã€‘è³¬è™Ÿè©³æƒ…..." && \
curl -s -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8000/api/v1/group-ai/accounts/639454959591" | \
  python3 -m json.tool | head -10 && \
echo "" && \
echo "ã€æ¸¬è©¦ 2ã€‘è³¬è™Ÿç‹€æ…‹ï¼ˆä¿®å¾©å¾Œï¼‰..." && \
curl -s -w "\nHTTPç‹€æ…‹ç¢¼: %{http_code}\n" \
  -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8000/api/v1/group-ai/accounts/639454959591/status" | \
  python3 -m json.tool
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### å•é¡Œ 1: æœå‹™ç„¡æ³•å•Ÿå‹•

**æª¢æŸ¥æ—¥èªŒ**:
```bash
# systemd æœå‹™æ—¥èªŒ
sudo journalctl -u smart-tg-backend.service -n 50

# æˆ–æ‰‹å‹•å•Ÿå‹•çš„æ—¥èªŒ
tail -50 /tmp/backend.log
```

### å•é¡Œ 2: ä»è¿”å› 404

**æª¢æŸ¥ä»£ç¢¼æ˜¯å¦å·²æ›´æ–°**:
```bash
cd /opt/group-ai/admin-backend
grep -A 5 "æª¢æŸ¥æ•¸æ“šåº«" app/api/group_ai/accounts.py
```

å¦‚æœæ²’æœ‰çœ‹åˆ°"æª¢æŸ¥æ•¸æ“šåº«"çš„è¨»é‡‹ï¼Œèªªæ˜ä»£ç¢¼æœªæ›´æ–°ã€‚

**è§£æ±ºæ–¹æ³•**:
```bash
# ç¢ºä¿æ‹‰å–äº†æœ€æ–°ä»£ç¢¼
cd /opt/group-ai
git pull origin main

# é‡å•Ÿæœå‹™
sudo systemctl restart smart-tg-backend.service
```

### å•é¡Œ 3: èªè­‰å¤±æ•—

**æª¢æŸ¥é»˜èªæ†‘æ“š**:
```bash
# æª¢æŸ¥ç’°å¢ƒè®Šé‡
grep ADMIN_DEFAULT /opt/group-ai/admin-backend/.env

# æˆ–ç›´æ¥æŸ¥çœ‹é…ç½®
cat /opt/group-ai/admin-backend/.env | grep -E "ADMIN|EMAIL|PASSWORD"
```

---

## ğŸ“ ä¿®å¾©å…§å®¹å›é¡§

### ä¿®å¾©çš„æ–‡ä»¶

- **æ–‡ä»¶**: `admin-backend/app/api/group_ai/accounts.py`
- **ç«¯é»**: `GET /api/v1/group-ai/accounts/{account_id}/status`
- **è¡Œæ•¸**: 1709-1762

### ä¿®å¾©é‚è¼¯

**ä¿®å¾©å‰**:
- åªæª¢æŸ¥ AccountManager
- å¦‚æœä¸åœ¨ AccountManager ä¸­ï¼Œç›´æ¥è¿”å› 404

**ä¿®å¾©å¾Œ**:
1. å…ˆæª¢æŸ¥ AccountManagerï¼ˆç²å–å¯¦æ™‚ç‹€æ…‹ï¼‰
2. å†æª¢æŸ¥æ•¸æ“šåº«ï¼ˆæŒä¹…åŒ–è¨˜éŒ„ï¼‰
3. å¦‚æœè³¬è™Ÿåœ¨æ•¸æ“šåº«ä¸­ä½†ä¸åœ¨ AccountManager ä¸­ï¼Œè¿”å›é»˜èªçš„ offline ç‹€æ…‹
4. åªæœ‰ç•¶è³¬è™Ÿå®Œå…¨ä¸å­˜åœ¨æ™‚æ‰è¿”å› 404

---

**åŸ·è¡Œéƒ¨ç½²å’Œæ¸¬è©¦ï¼Œå‘Šè¨´æˆ‘çµæœï¼**
