# é ç«¯è³¬è™Ÿç®¡ç†åŠŸèƒ½å¯¦ç¾æ–¹æ¡ˆ

> **æ—¥æœŸ**: 2025-12-01  
> **éœ€æ±‚**: å¾Œå°ç®¡ç†é ç«¯æœå‹™å™¨å’Œå…¶ä»–é›»è…¦ä¸Šçš„ Telegram è³¬è™Ÿ

---

## ğŸ“‹ éœ€æ±‚èªªæ˜

### æ ¸å¿ƒéœ€æ±‚

1. **è®€å–é ç«¯è³¬è™Ÿé‹è¡Œä¿¡æ¯**
   - é ç«¯æœå‹™å™¨/å…¶ä»–é›»è…¦ä¸Šçš„ Telegram è³¬è™Ÿ
   - å¾Œå°è‡ªå‹•è®€å–è³¬è™Ÿé‹è¡Œç‹€æ…‹
   - é¡¯ç¤ºæ‰€æœ‰è³¬è™Ÿï¼ˆæœ¬åœ°+é ç«¯ï¼‰

2. **åŠ‡æœ¬å‚³é€**
   - å¾Œå°æ¨é€åŠ‡æœ¬åˆ°é ç«¯ç¯€é»
   - é ç«¯ç¯€é»è‡ªå‹•æ›´æ–°åŠ‡æœ¬
   - æ”¯æŒæ‰¹é‡æ¨é€

3. **æœƒè©±ç®¡ç†**
   - ä¸Šå‚³æœƒè©±æ–‡ä»¶åˆ°é ç«¯
   - åŒæ­¥æœƒè©±æ–‡ä»¶
   - æœƒè©±æ–‡ä»¶ç®¡ç†

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¾Œå°ç®¡ç†ç³»çµ±ï¼ˆä¸»ç¯€é»ï¼‰  â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Workers API     â”‚  â”‚ â† Worker ç¯€é»å¿ƒè·³ï¼ˆåŒ…å«è³¬è™Ÿåˆ—è¡¨ï¼‰
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Script API      â”‚  â”‚ â† åŠ‡æœ¬ç®¡ç†
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Session API     â”‚  â”‚ â† æœƒè©±ç®¡ç†
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ HTTP API + Redis/å‘½ä»¤éšŠåˆ—
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ Worker  â”‚    â”‚   Worker    â”‚
â”‚ ç¯€é» 1  â”‚    â”‚   ç¯€é» 2    â”‚
â”‚         â”‚    â”‚             â”‚
â”‚ è³¬è™Ÿ A  â”‚    â”‚  è³¬è™Ÿ B     â”‚
â”‚ è³¬è™Ÿ B  â”‚    â”‚  è³¬è™Ÿ C     â”‚
â”‚         â”‚    â”‚             â”‚
â”‚ åŠ‡æœ¬ X  â”‚    â”‚  åŠ‡æœ¬ Y     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ å¯¦ç¾æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: é ç«¯è³¬è™ŸåŒæ­¥ï¼ˆå·²å®ŒæˆåŸºç¤ï¼‰

#### å·¥ä½œåŸç†

1. **Worker ç¯€é»ç™¼é€å¿ƒè·³**
   ```python
   POST /api/v1/workers/heartbeat
   {
     "node_id": "computer_001",
     "status": "online",
     "account_count": 3,
     "accounts": [
       {
         "account_id": "+1234567890",
         "status": "online",
         "script_id": "script_001",
         "message_count": 150,
         "reply_count": 45,
         "last_activity": "2025-12-01T18:00:00",
         "session_file": "/path/to/session.session",
         "group_ids": [123456789]
       }
     ]
   }
   ```

2. **å¾Œå°è‡ªå‹•åŒæ­¥**
   - æ¥æ”¶å¿ƒè·³æ™‚è‡ªå‹•åŒæ­¥è³¬è™Ÿä¿¡æ¯
   - æ›´æ–°æ•¸æ“šåº«ä¸­çš„è³¬è™Ÿè¨˜éŒ„
   - æ–°å»ºæˆ–æ›´æ–°è³¬è™Ÿç‹€æ…‹

3. **å‰ç«¯é¡¯ç¤º**
   - é¡¯ç¤ºæ‰€æœ‰è³¬è™Ÿï¼ˆæœ¬åœ°+é ç«¯ï¼‰
   - æ¨™è¨˜è³¬è™Ÿä¾†æºç¯€é»
   - å¯¦æ™‚æ›´æ–°ç‹€æ…‹

#### å·²å¯¦ç¾

- âœ… `remote_account_sync.py` - è³¬è™ŸåŒæ­¥æ¨¡å¡Š
- âœ… `workers.py` - å¿ƒè·³è™•ç†å·²å¢å¼·

---

### æ–¹æ¡ˆ 2: åŠ‡æœ¬å‚³é€ï¼ˆå·²å®ŒæˆåŸºç¤ï¼‰

#### å·¥ä½œæµç¨‹

1. **å¾Œå°æ¨é€åŠ‡æœ¬**
   ```
   POST /api/v1/group-ai/scripts/deploy
   {
     "script_id": "script_001",
     "node_ids": ["computer_001", "computer_002"],
     "force_update": false
   }
   ```

2. **å‘½ä»¤ç™¼é€åˆ° Worker**
   - é€šéå‘½ä»¤éšŠåˆ—ç™¼é€ `update_script` å‘½ä»¤
   - Worker ç¯€é»å¾éšŠåˆ—ç²å–å‘½ä»¤

3. **Worker ç¯€é»åŸ·è¡Œ**
   - å¾å¾Œå°ä¸‹è¼‰åŠ‡æœ¬æ–‡ä»¶
   - æ›´æ–°æœ¬åœ°åŠ‡æœ¬
   - é‡è¼‰è³¬è™Ÿï¼ˆå¯é¸ï¼‰

#### å·²å¯¦ç¾

- âœ… `script_deployment.py` - åŠ‡æœ¬æ¨é€ API
- â³ åŠ‡æœ¬ä¸‹è¼‰ç«¯é»ï¼ˆå¾…å¯¦ç¾ï¼‰

---

### æ–¹æ¡ˆ 3: æœƒè©±ç®¡ç†ï¼ˆå¾…å¯¦ç¾ï¼‰

#### å·¥ä½œæµç¨‹

1. **ä¸Šå‚³æœƒè©±æ–‡ä»¶**
   - åœ¨å¾Œå°ä¸Šå‚³ `.session` æ–‡ä»¶
   - é¸æ“‡ç›®æ¨™ Worker ç¯€é»

2. **å‚³è¼¸æœƒè©±æ–‡ä»¶**
   - é€šéå‘½ä»¤éšŠåˆ—ç™¼é€å‚³è¼¸æŒ‡ä»¤
   - Worker ç¯€é»æ¥æ”¶ä¸¦ä¿å­˜

3. **æœƒè©±æ–‡ä»¶ç®¡ç†**
   - ä¸‹è¼‰æœƒè©±æ–‡ä»¶
   - å‚™ä»½æœƒè©±æ–‡ä»¶

---

## ğŸ“ Worker ç¯€é»å¯¦ç¾è¦æ±‚

### Worker ç¯€é»éœ€è¦å¯¦ç¾çš„åŠŸèƒ½

#### 1. å¿ƒè·³æ©Ÿåˆ¶

```python
# Worker ç¯€é»ä»£ç¢¼ç¤ºä¾‹
import requests
import time

def send_heartbeat():
    accounts = []
    # ç²å–æœ¬åœ°æ‰€æœ‰è³¬è™Ÿçš„é‹è¡Œä¿¡æ¯
    for account_id in local_accounts:
        account_info = {
            "account_id": account_id,
            "status": "online",  # æˆ– "offline"
            "script_id": get_account_script(account_id),
            "message_count": get_message_count(account_id),
            "reply_count": get_reply_count(account_id),
            "last_activity": get_last_activity(account_id),
            "session_file": get_session_file(account_id),
            "group_ids": get_group_ids(account_id)
        }
        accounts.append(account_info)
    
    response = requests.post(
        "http://å¾Œå°åœ°å€/api/v1/workers/heartbeat",
        json={
            "node_id": "computer_001",
            "status": "online",
            "account_count": len(accounts),
            "accounts": accounts
        }
    )

# æ¯ 30 ç§’ç™¼é€ä¸€æ¬¡
while True:
    send_heartbeat()
    time.sleep(30)
```

#### 2. å‘½ä»¤è™•ç†

```python
# Worker ç¯€é»å‘½ä»¤è™•ç†
def process_commands():
    response = requests.get(
        f"http://å¾Œå°åœ°å€/api/v1/workers/{node_id}/commands"
    )
    commands = response.json()["commands"]
    
    for command in commands:
        if command["action"] == "update_script":
            # ä¸‹è¼‰ä¸¦æ›´æ–°åŠ‡æœ¬
            download_script(command["params"])
        elif command["action"] == "upload_session":
            # ä¸‹è¼‰ä¸¦ä¿å­˜æœƒè©±æ–‡ä»¶
            download_session(command["params"])
    
    # æ¸…é™¤å·²è™•ç†çš„å‘½ä»¤
    requests.delete(f"http://å¾Œå°åœ°å€/api/v1/workers/{node_id}/commands")
```

---

## ğŸš€ ç«‹å³å¯¦ç¾çš„ä»»å‹™

### ä»»å‹™ 1: æ·»åŠ åŠ‡æœ¬ä¸‹è¼‰ç«¯é»

åœ¨ `scripts.py` ä¸­æ·»åŠ åŠ‡æœ¬ä¸‹è¼‰ç«¯é»ï¼Œè®“ Worker ç¯€é»å¯ä»¥ä¸‹è¼‰åŠ‡æœ¬æ–‡ä»¶ã€‚

### ä»»å‹™ 2: å®Œå–„è³¬è™ŸåŒæ­¥é‚è¼¯

ç¢ºä¿è³¬è™ŸåŒæ­¥é‚è¼¯å®Œæ•´ï¼ŒåŒ…æ‹¬ï¼š
- è³¬è™Ÿä¿¡æ¯å®Œæ•´åŒæ­¥
- ç‹€æ…‹æ›´æ–°
- éŒ¯èª¤è™•ç†

### ä»»å‹™ 3: å‰ç«¯é¡¯ç¤ºé ç«¯è³¬è™Ÿ

åœ¨å‰ç«¯è³¬è™Ÿç®¡ç†é é¢ï¼š
- é¡¯ç¤ºè³¬è™Ÿä¾†æºï¼ˆæœ¬åœ°/é ç«¯ï¼‰
- é¡¯ç¤ºæ‰€åœ¨ç¯€é»
- æ”¯æŒæŒ‰ç¯€é»éæ¿¾

---

## ğŸ“‹ ä½¿ç”¨å ´æ™¯

### å ´æ™¯ 1: æŸ¥çœ‹æ‰€æœ‰é ç«¯è³¬è™Ÿ

**æ­¥é©Ÿ**:
1. Worker ç¯€é»æ¯ 30 ç§’ç™¼é€å¿ƒè·³ï¼ˆåŒ…å«è³¬è™Ÿåˆ—è¡¨ï¼‰
2. å¾Œå°è‡ªå‹•åŒæ­¥è³¬è™Ÿåˆ°æ•¸æ“šåº«
3. å‰ç«¯é¡¯ç¤ºæ‰€æœ‰è³¬è™Ÿï¼Œæ¨™è¨˜ä¾†æºç¯€é»

**çµæœ**: å¾Œå°å¯ä»¥çœ‹åˆ°æ‰€æœ‰é ç«¯ç¯€é»çš„è³¬è™Ÿé‹è¡Œç‹€æ…‹

### å ´æ™¯ 2: æ¨é€åŠ‡æœ¬åˆ°é ç«¯

**æ­¥é©Ÿ**:
1. åœ¨å¾Œå°é¸æ“‡åŠ‡æœ¬
2. é¸æ“‡ç›®æ¨™ Worker ç¯€é»
3. é»æ“Šã€Œæ¨é€ã€
4. å¾Œå°ç™¼é€å‘½ä»¤åˆ° Worker ç¯€é»
5. Worker ç¯€é»ä¸‹è¼‰ä¸¦æ›´æ–°åŠ‡æœ¬

**çµæœ**: é ç«¯ç¯€é»è‡ªå‹•æ›´æ–°åŠ‡æœ¬ï¼Œç„¡éœ€æ‰‹å‹•æ“ä½œ

### å ´æ™¯ 3: ä¸Šå‚³æœƒè©±åˆ°é ç«¯

**æ­¥é©Ÿ**:
1. åœ¨å¾Œå°ä¸Šå‚³ `.session` æ–‡ä»¶
2. é¸æ“‡ç›®æ¨™ Worker ç¯€é»
3. å¾Œå°ç™¼é€å‚³è¼¸å‘½ä»¤
4. Worker ç¯€é»æ¥æ”¶ä¸¦ä¿å­˜æœƒè©±æ–‡ä»¶

**çµæœ**: æœƒè©±æ–‡ä»¶è‡ªå‹•å‚³è¼¸åˆ°é ç«¯ç¯€é»

---

**åŸºç¤æ¶æ§‹å·²å®Œæˆï¼Œå¯ä»¥é–‹å§‹å®Œæ•´å¯¦ç¾ï¼**
