# å‰ç«¯æ¬Šé™æ§åˆ¶é›†æˆæŒ‡å—

> **å®Œæˆæ—¥æœŸ**: 2025-01-17  
> **åŠŸèƒ½ç‹€æ…‹**: âœ… å·²å®Œæˆï¼ˆåŸºç¤ç‰ˆæœ¬ï¼‰

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å·²å¯¦ç¾å‰ç«¯æ¬Šé™æ§åˆ¶ç³»çµ±ï¼ŒåŒ…æ‹¬æ¬Šé™ç®¡ç†ç•Œé¢ã€æ¬Šé™æ§åˆ¶çµ„ä»¶å’Œæ¬Šé™æª¢æŸ¥ Hookã€‚

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ¬Šé™æ§åˆ¶çµ„ä»¶ âœ…

**æ–‡ä»¶**: 
- `saas-demo/src/components/permissions/permission-guard.tsx`
- `saas-demo/src/components/permissions/permission-button.tsx`

**çµ„ä»¶åŠŸèƒ½**:

#### PermissionGuard
- æ ¹æ“šæ¬Šé™é¡¯ç¤º/éš±è—å…§å®¹
- æ”¯æŒå–®ä¸€æ¬Šé™æˆ–å¤šå€‹æ¬Šé™æª¢æŸ¥
- æ”¯æŒ `requireAll` æ¨¡å¼ï¼ˆéœ€è¦æ‰€æœ‰æ¬Šé™ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```tsx
import { PermissionGuard } from "@/components/permissions/permission-guard"

<PermissionGuard permission="account:create">
  <Button>å‰µå»ºè³¬è™Ÿ</Button>
</PermissionGuard>

<PermissionGuard 
  permissions={["account:create", "account:update"]}
  requireAll={false}
>
  <Button>æ“ä½œæŒ‰éˆ•</Button>
</PermissionGuard>
```

#### PermissionButton
- æ ¹æ“šæ¬Šé™å•Ÿç”¨/ç¦ç”¨æŒ‰éˆ•
- ç„¡æ¬Šé™æ™‚é¡¯ç¤ºæç¤ºï¼ˆTooltipï¼‰
- æ”¯æŒæ‰€æœ‰ Button å±¬æ€§

**ä½¿ç”¨ç¤ºä¾‹**:
```tsx
import { PermissionButton } from "@/components/permissions/permission-button"

<PermissionButton 
  permission="account:create"
  onClick={handleCreate}
  tooltip="æ‚¨æ²’æœ‰æ¬Šé™å‰µå»ºè³¬è™Ÿ"
>
  å‰µå»ºè³¬è™Ÿ
</PermissionButton>
```

---

### 2. æ¬Šé™æª¢æŸ¥ Hook âœ…

**æ–‡ä»¶**: `saas-demo/src/hooks/use-permissions.ts`

**åŠŸèƒ½**:
- `hasPermission(code)` - æª¢æŸ¥æ˜¯å¦æœ‰æŒ‡å®šæ¬Šé™
- `hasAnyPermission(codes)` - æª¢æŸ¥æ˜¯å¦æœ‰ä»»æ„ä¸€å€‹æ¬Šé™
- `hasAllPermissions(codes)` - æª¢æŸ¥æ˜¯å¦æœ‰æ‰€æœ‰æ¬Šé™
- `checkPermission(code)` - ç•°æ­¥æª¢æŸ¥æ¬Šé™ï¼ˆèª¿ç”¨ APIï¼‰
- `refresh()` - åˆ·æ–°æ¬Šé™åˆ—è¡¨

**ä½¿ç”¨ç¤ºä¾‹**:
```tsx
import { usePermissions } from "@/hooks/use-permissions"

function MyComponent() {
  const { hasPermission, loading } = usePermissions()

  if (loading) return <div>åŠ è¼‰ä¸­...</div>

  return (
    <div>
      {hasPermission("account:create") && (
        <Button onClick={handleCreate}>å‰µå»º</Button>
      )}
    </div>
  )
}
```

---

### 3. æ¬Šé™ç®¡ç†ç•Œé¢ âœ…

**æ–‡ä»¶**: `saas-demo/src/app/permissions/page.tsx`

**åŠŸèƒ½**:
- æ¬Šé™åˆ—è¡¨å±•ç¤º
- å‰µå»ºæ¬Šé™
- ç·¨è¼¯æ¬Šé™
- åˆªé™¤æ¬Šé™
- åˆå§‹åŒ–ç³»çµ±æ¬Šé™ï¼ˆå‰µå»ºæ‰€æœ‰é å®šç¾©æ¬Šé™å’Œè§’è‰²ï¼‰

**æ¬Šé™è¦æ±‚**:
- æŸ¥çœ‹æ¬Šé™åˆ—è¡¨ï¼š`permission:view`
- å‰µå»ºæ¬Šé™ï¼š`permission:create`
- æ›´æ–°æ¬Šé™ï¼š`permission:update`
- åˆªé™¤æ¬Šé™ï¼š`permission:delete`
- åˆå§‹åŒ–æ¬Šé™ï¼šè¶…ç´šç®¡ç†å“¡

---

### 4. å°èˆªé›†æˆ âœ…

**æ–‡ä»¶**: `saas-demo/src/components/sidebar.tsx`

**è®Šæ›´**:
- æ·»åŠ "æ¬Šé™ç®¡ç†"å°èˆªé …
- ä½¿ç”¨ `Shield` åœ–æ¨™
- è·¯ç”±ï¼š`/permissions`

---

## ğŸ“ é›†æˆç¤ºä¾‹

### ç¤ºä¾‹ 1: åœ¨è³¬è™Ÿç®¡ç†é é¢é›†æˆæ¬Šé™æ§åˆ¶

```tsx
import { PermissionGuard } from "@/components/permissions/permission-guard"
import { PermissionButton } from "@/components/permissions/permission-button"

export default function AccountsPage() {
  return (
    <div>
      {/* ä½¿ç”¨ PermissionGuard éš±è—æ•´å€‹æŒ‰éˆ• */}
      <PermissionGuard permission="account:create">
        <Button onClick={handleCreate}>
          å‰µå»ºè³¬è™Ÿ
        </Button>
      </PermissionGuard>

      {/* ä½¿ç”¨ PermissionButton ç¦ç”¨æŒ‰éˆ• */}
      <PermissionButton 
        permission="account:delete"
        onClick={handleDelete}
        variant="destructive"
      >
        åˆªé™¤è³¬è™Ÿ
      </PermissionButton>

      {/* æ‰¹é‡æ“ä½œæŒ‰éˆ• */}
      <PermissionGuard permission="account:batch_operate">
        <Button onClick={handleBatchOperation}>
          æ‰¹é‡æ“ä½œ
        </Button>
      </PermissionGuard>
    </div>
  )
}
```

### ç¤ºä¾‹ 2: åœ¨åŠ‡æœ¬ç®¡ç†é é¢é›†æˆæ¬Šé™æ§åˆ¶

```tsx
import { PermissionGuard } from "@/components/permissions/permission-guard"

export default function ScriptsPage() {
  return (
    <div>
      <PermissionGuard permission="script:create">
        <Button onClick={handleCreate}>å‰µå»ºåŠ‡æœ¬</Button>
      </PermissionGuard>

      <PermissionGuard permission="script:test">
        <Button onClick={handleTest}>æ¸¬è©¦åŠ‡æœ¬</Button>
      </PermissionGuard>

      <PermissionGuard permission="script:publish">
        <Button onClick={handlePublish}>ç™¼å¸ƒåŠ‡æœ¬</Button>
      </PermissionGuard>
    </div>
  )
}
```

### ç¤ºä¾‹ 3: æ¢ä»¶æ¸²æŸ“

```tsx
import { usePermissions } from "@/hooks/use-permissions"

export default function MyPage() {
  const { hasPermission, hasAnyPermission } = usePermissions()

  return (
    <div>
      {hasPermission("account:view") && (
        <AccountList />
      )}

      {hasAnyPermission(["account:create", "account:update"]) && (
        <ActionButtons />
      )}
    </div>
  )
}
```

---

## ğŸ”§ æ¬Šé™ä»£ç¢¼åƒè€ƒ

### è³¬è™Ÿç®¡ç†
- `account:view` - æŸ¥çœ‹è³¬è™Ÿ
- `account:create` - å‰µå»ºè³¬è™Ÿ
- `account:update` - æ›´æ–°è³¬è™Ÿ
- `account:delete` - åˆªé™¤è³¬è™Ÿ
- `account:start` - å•Ÿå‹•è³¬è™Ÿ
- `account:stop` - åœæ­¢è³¬è™Ÿ
- `account:batch_operate` - æ‰¹é‡æ“ä½œ

### åŠ‡æœ¬ç®¡ç†
- `script:view` - æŸ¥çœ‹åŠ‡æœ¬
- `script:create` - å‰µå»ºåŠ‡æœ¬
- `script:update` - æ›´æ–°åŠ‡æœ¬
- `script:delete` - åˆªé™¤åŠ‡æœ¬
- `script:test` - æ¸¬è©¦åŠ‡æœ¬
- `script:review` - å¯©æ ¸åŠ‡æœ¬
- `script:publish` - ç™¼å¸ƒåŠ‡æœ¬
- `script:disable` - åœç”¨åŠ‡æœ¬

### è§’è‰²åˆ†é…
- `role_assignment_scheme:view` - æŸ¥çœ‹æ–¹æ¡ˆ
- `role_assignment_scheme:create` - å‰µå»ºæ–¹æ¡ˆ
- `role_assignment_scheme:update` - æ›´æ–°æ–¹æ¡ˆ
- `role_assignment_scheme:delete` - åˆªé™¤æ–¹æ¡ˆ
- `role_assignment_scheme:apply` - æ‡‰ç”¨æ–¹æ¡ˆ

### è‡ªå‹•åŒ–ä»»å‹™
- `automation_task:view` - æŸ¥çœ‹ä»»å‹™
- `automation_task:create` - å‰µå»ºä»»å‹™
- `automation_task:update` - æ›´æ–°ä»»å‹™
- `automation_task:delete` - åˆªé™¤ä»»å‹™
- `automation_task:run` - åŸ·è¡Œä»»å‹™
- `automation_task:log:view` - æŸ¥çœ‹æ—¥èªŒ

### æ¬Šé™ç®¡ç†
- `permission:view` - æŸ¥çœ‹æ¬Šé™
- `permission:create` - å‰µå»ºæ¬Šé™
- `permission:update` - æ›´æ–°æ¬Šé™
- `permission:delete` - åˆªé™¤æ¬Šé™
- `permission:assign` - åˆ†é…æ¬Šé™

---

## â³ å¾ŒçºŒå„ªåŒ–å»ºè­°

### é«˜å„ªå…ˆç´š

1. **åœ¨æ‰€æœ‰é é¢é›†æˆæ¬Šé™æ§åˆ¶**
   - è³¬è™Ÿç®¡ç†é é¢
   - åŠ‡æœ¬ç®¡ç†é é¢
   - è§’è‰²åˆ†é…é é¢
   - è‡ªå‹•åŒ–ä»»å‹™é é¢
   - ç›£æ§é é¢

2. **è§’è‰²æ¬Šé™åˆ†é…ç•Œé¢**
   - è§’è‰²åˆ—è¡¨
   - ç‚ºè§’è‰²åˆ†é…æ¬Šé™
   - å¾è§’è‰²æ’¤éŠ·æ¬Šé™
   - ç”¨æˆ¶è§’è‰²ç®¡ç†

### ä¸­å„ªå…ˆç´š

1. **æ¬Šé™ç·©å­˜**
   - ç·©å­˜ç”¨æˆ¶æ¬Šé™åˆ—è¡¨
   - æ¸›å°‘ API èª¿ç”¨

2. **æ¬Šé™å¯©è¨ˆ**
   - è¨˜éŒ„æ¬Šé™æª¢æŸ¥å¤±æ•—
   - è¨˜éŒ„æ¬Šé™ä½¿ç”¨æƒ…æ³

---

## âœ… å®Œæˆç‹€æ…‹

- âœ… æ¬Šé™æ§åˆ¶çµ„ä»¶ï¼ˆPermissionGuardã€PermissionButtonï¼‰
- âœ… æ¬Šé™æª¢æŸ¥ Hookï¼ˆusePermissionsï¼‰
- âœ… æ¬Šé™ç®¡ç†ç•Œé¢
- âœ… å°èˆªé›†æˆ
- â³ é é¢æ¬Šé™æ§åˆ¶é›†æˆï¼ˆå¾…å®Œæˆï¼‰
- â³ è§’è‰²æ¬Šé™åˆ†é…ç•Œé¢ï¼ˆå¾…å®Œæˆï¼‰

---

## ğŸ¯ ç¸½çµ

å‰ç«¯æ¬Šé™æ§åˆ¶ç³»çµ±å·²å®Œæ•´å¯¦ç¾ï¼ŒåŒ…æ‹¬ï¼š

1. **æ¬Šé™æ§åˆ¶çµ„ä»¶**: PermissionGuard å’Œ PermissionButton
2. **æ¬Šé™æª¢æŸ¥ Hook**: usePermissions
3. **æ¬Šé™ç®¡ç†ç•Œé¢**: å®Œæ•´çš„ CRUD æ“ä½œ
4. **å°èˆªé›†æˆ**: æ¬Šé™ç®¡ç†é é¢å·²æ·»åŠ åˆ°å´é‚Šæ¬„

**ä¸‹ä¸€æ­¥**: åœ¨æ‰€æœ‰åŠŸèƒ½é é¢é›†æˆæ¬Šé™æ§åˆ¶ï¼Œå¯¦ç¾è§’è‰²æ¬Šé™åˆ†é…ç•Œé¢ã€‚

---

**å ±å‘Šç”Ÿæˆæ™‚é–“**: 2025-01-17  
**åŠŸèƒ½ç‹€æ…‹**: âœ… åŸºç¤ç‰ˆæœ¬å®Œæˆ

